ë¦¬íŠ¼(litten) í¬ë¡œìŠ¤í”Œë«í¼ ë…¸íŠ¸ ì•±ê³¼ ì›¹ UI ì„¤ê³„ì„œ

================================================================================

1. ì„¤ê³„ ê¸°ë°˜ ë¶„ì„

1.1 ê¸°ì¡´ Flutter í”„ë¡œì íŠ¸ ë¶„ì„ ê²°ê³¼
ê¸°ì¡´ í”„ë¡œì íŠ¸ì—ì„œ ì¶”ì¶œí•œ í•µì‹¬ UI íŒ¨í„´:
- íƒ­ ê¸°ë°˜ ë„¤ë¹„ê²Œì´ì…˜: BottomNavigationBar 5ê°œ íƒ­ êµ¬ì¡°
- ì¹´ë“œ ë ˆì´ì•„ì›ƒ: ê¸°ëŠ¥ë³„ Card ìœ„ì ¯ìœ¼ë¡œ êµ¬ë¶„
- ë¦¬ìŠ¤íŠ¸ ë·°: ListView.builderë¥¼ í†µí•œ íš¨ìœ¨ì ì¸ ìŠ¤í¬ë¡¤
- ìƒíƒœ ê¸°ë°˜ UI: StatefulWidgetìœ¼ë¡œ ì‹¤ì‹œê°„ ìƒíƒœ ë°˜ì˜
- ë°˜ì‘í˜• ë””ìì¸: í”Œë«í¼ë³„ ì¡°ê±´ë¶€ ë Œë”ë§

1.2 ë¦¬íŠ¼ ì•± ì ìš© ë°©í–¥
ê¸°ì¡´ êµ¬ì¡°ë¥¼ í™•ì¥í•˜ì—¬ ë¦¬íŠ¼ì˜ ìš”êµ¬ì‚¬í•­ì— ë§ê²Œ ê°œì„ :
- 30ê°œ ì–¸ì–´ ì§€ì›ì„ ìœ„í•œ êµ­ì œí™” UI
- ë¬´ë£Œ/í”„ë¦¬ë¯¸ì—„ ì°¨ë³„í™” UI
- í¬ë¡œìŠ¤í”Œë«í¼ ìµœì í™”
- ì ‘ê·¼ì„± ê°•í™”

================================================================================

2. ì „ì²´ ì•± êµ¬ì¡°

2.1 ë©”ì¸ ì•± êµ¬ì¡° (MainApp)
MaterialApp
â”œâ”€â”€ Theme Configuration (5ê°€ì§€ í…Œë§ˆ ì‹œìŠ¤í…œ)
â”œâ”€â”€ Localization (30ê°œ ì–¸ì–´)
â”œâ”€â”€ Navigation Routes
â””â”€â”€ MainTabScreen (ë©”ì¸ í™”ë©´)

2.2 ë©”ì¸ íƒ­ í™”ë©´ (MainTabScreen)
Scaffold
â”œâ”€â”€ AdBanner (ë¬´ë£Œ ì‚¬ìš©ìë§Œ, ìµœìƒë‹¨ ê³ ì •)
â”œâ”€â”€ AppBar
â”‚   â”œâ”€â”€ Leading: ë¦¬íŠ¼ ë¡œê³  + ì•„ì´ì½˜ ì¡°í•©
â”‚   â”œâ”€â”€ Title: ì„ íƒëœ ë…¸íŠ¸ëª… ë˜ëŠ” ì•ˆë‚´ ë©”ì‹œì§€
â”‚   â””â”€â”€ Actions: íŒŒì¼ ìˆ˜ ì¹´ìš´í„° ë°°ì§€ë“¤
â”œâ”€â”€ Body: íƒ­ë³„ í™”ë©´ ìœ„ì ¯
â””â”€â”€ BottomNavigationBar (4ê°œ íƒ­)
    â”œâ”€â”€ í™ˆ (Icons.home)
    â”œâ”€â”€ ë“£ê¸° (Icons.mic) 
    â”œâ”€â”€ ì“°ê¸° (Icons.keyboard) - í…ìŠ¤íŠ¸ ì‘ì„± ë° í•„ê¸° í†µí•©
    â””â”€â”€ ì„¤ì • (Icons.settings)

================================================================================

3. í™”ë©´ë³„ ìƒì„¸ ì„¤ê³„

3.1 í™ˆ í™”ë©´ (HomeScreen)

3.1.1 ë ˆì´ì•„ì›ƒ êµ¬ì¡°
Column
â”œâ”€â”€ AdBanner (ë¬´ë£Œ ì‚¬ìš©ìë§Œ, height: 50)
â”œâ”€â”€ ë…¸íŠ¸ ëª©ë¡ ì˜ì—­ (Expanded)
â”‚   â”œâ”€â”€ ë¹ˆ ìƒíƒœ: ì¤‘ì•™ ì•ˆë‚´ ë©”ì‹œì§€
â”‚   â””â”€â”€ ë¦¬ìŠ¤íŠ¸ ìƒíƒœ: ListView.builder
â”‚       â””â”€â”€ ListTile ê° í•­ëª©
â”‚           â”œâ”€â”€ Leading: ë…¸íŠ¸ ì•„ì´ì½˜
â”‚           â”œâ”€â”€ Title: ë…¸íŠ¸ ì œëª© + íŒŒì¼ ìˆ˜ ë°°ì§€
â”‚           â”œâ”€â”€ Subtitle: ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°
â”‚           â””â”€â”€ Trailing: ë‚ ì§œ + ì‚­ì œ ë²„íŠ¼
â””â”€â”€ í•˜ë‹¨ ê³ ì • ë²„íŠ¼: "ë¦¬íŠ¼ ìƒì„±" FloatingActionButton
    â””â”€â”€ onPressed: ë¦¬íŠ¼ ìƒì„± ë‹¤ì´ì–¼ë¡œê·¸

3.1.2 ë…¸íŠ¸ ëª©ë¡ ì•„ì´í…œ UI
ListTile
â”œâ”€â”€ Leading: Icon(Icons.note) 
â”œâ”€â”€ Title: Row
â”‚   â”œâ”€â”€ Expanded: ë…¸íŠ¸ ì œëª©
â”‚   â””â”€â”€ íŒŒì¼ ìˆ˜ ë°°ì§€ Row
â”‚       â”œâ”€â”€ ë“£ê¸° ë°°ì§€: ğŸ¤ + ìˆ«ì
â”‚       â””â”€â”€ ì“°ê¸° ë°°ì§€: âœï¸ + ìˆ«ì
â”œâ”€â”€ Subtitle: ë‚´ìš© ë¯¸ë¦¬ë³´ê¸° (30ì ì œí•œ)
â””â”€â”€ Trailing: Row
    â”œâ”€â”€ ë‚ ì§œ (ì›”/ì¼ ì‹œ:ë¶„)
    â””â”€â”€ ì‚­ì œ IconButton

3.1.3 ë¹ˆ ìƒíƒœ UI
Center
â””â”€â”€ Column
    â”œâ”€â”€ Icon(Icons.sticky_note_2, size: 64, color: Colors.grey)
    â”œâ”€â”€ SizedBox(height: 16)
    â”œâ”€â”€ Text("ë…¸íŠ¸ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”")
    â”œâ”€â”€ SizedBox(height: 8)
    â””â”€â”€ Text("í•˜ë‹¨ì˜ 'ë¦¬íŠ¼ ìƒì„±' ë²„íŠ¼ì„...")

3.2 ë“£ê¸° í™”ë©´ (RecorderScreen)

3.2.1 ë ˆì´ì•„ì›ƒ êµ¬ì¡°
Column
â”œâ”€â”€ AdBanner (ë¬´ë£Œ ì‚¬ìš©ìë§Œ, height: 50)
â”œâ”€â”€ ë“£ê¸° íŒŒì¼ ëª©ë¡ (Expanded)
â”‚   â””â”€â”€ ListView.builder
â”‚       â””â”€â”€ ë“£ê¸° íŒŒì¼ ì¹´ë“œ
â””â”€â”€ í•˜ë‹¨ ë“£ê¸° ì»¨íŠ¸ë¡¤ íŒ¨ë„
    â”œâ”€â”€ ë“£ê¸° ì‹œì‘ ë²„íŠ¼ (onPressed: ë“£ê¸° ì‹œì‘)
    â”œâ”€â”€ ë“£ê¸° ì¤‘ì§€ ë²„íŠ¼
    â””â”€â”€ ë“£ê¸° ìƒíƒœ í‘œì‹œ

3.2.2 ë“£ê¸° íŒŒì¼ ì¹´ë“œ UI
Card
â””â”€â”€ Padding
    â””â”€â”€ Column
        â”œâ”€â”€ íŒŒì¼ëª… + ì¬ìƒ ì‹œê°„ Row
        â”‚   â”œâ”€â”€ Icon + íŒŒì¼ëª…
        â”‚   â”œâ”€â”€ ì¬ìƒ ì‹œê°„ ë°°ì§€
        â”‚   â””â”€â”€ ì‚­ì œ IconButton
        â”œâ”€â”€ í”„ë¡œê·¸ë ˆìŠ¤ ë°” (ì¬ìƒ ì¤‘ì¼ ë•Œ)
        â”‚   â”œâ”€â”€ ì‹œê°„ í‘œì‹œ Row (í˜„ì¬/ì „ì²´)
        â”‚   â””â”€â”€ Slider (íƒìƒ‰ ê°€ëŠ¥)
        â””â”€â”€ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ Row
            â”œâ”€â”€ ë°°ì† ë²„íŠ¼ ê·¸ë£¹ (1.0x, 1.2x, 1.5x, 2.0x)
            â””â”€â”€ ì¬ìƒ/ì¼ì‹œì •ì§€ ë²„íŠ¼

3.2.3 ë°°ì† ë²„íŠ¼ ê·¸ë£¹ UI
Container (í…Œë‘ë¦¬)
â””â”€â”€ Row
    â”œâ”€â”€ ë°°ì† ë²„íŠ¼ 1 (1.0x)
    â”œâ”€â”€ ë°°ì† ë²„íŠ¼ 2 (1.2x) 
    â”œâ”€â”€ ë°°ì† ë²„íŠ¼ 3 (1.5x)
    â””â”€â”€ ë°°ì† ë²„íŠ¼ 4 (2.0x)

ê° ë²„íŠ¼:
- ì„ íƒë¨: íŒŒë€ ë°°ê²½ + í° ê¸€ì
- ì„ íƒì•ˆë¨: íˆ¬ëª… ë°°ê²½ + ê²€ì • ê¸€ì

3.2.4 ë“£ê¸° ì»¨íŠ¸ë¡¤ UI
Row
â”œâ”€â”€ ë“£ê¸° ì‹œì‘ ë²„íŠ¼ (ë¹¨ê°„ìƒ‰)
â”œâ”€â”€ SizedBox(width: 8)
â”œâ”€â”€ ë“£ê¸° ì¤‘ì§€ ë²„íŠ¼ (íšŒìƒ‰)
â””â”€â”€ ë“£ê¸° ìƒíƒœ í‘œì‹œ (ì¡°ê±´ë¶€)
    â”œâ”€â”€ Icon(Icons.record_voice_over, color: Colors.red)
    â””â”€â”€ Text("ë“£ê¸° ì¤‘...", color: Colors.red)

3.3 ì“°ê¸° í™”ë©´ (WritingScreen) - í…ìŠ¤íŠ¸ ì‘ì„± ë° í•„ê¸° í†µí•©

3.3.1 ì „ì²´ ë ˆì´ì•„ì›ƒ êµ¬ì¡°
Column
â”œâ”€â”€ AdBanner (ë¬´ë£Œ ì‚¬ìš©ìë§Œ, height: 50)
â”œâ”€â”€ ìŒì„±-ì“°ê¸° ë™ê¸°í™” ìƒíƒœ í‘œì‹œ (AudioSyncIndicator)
â”œâ”€â”€ ëª¨ë“œ ì„ íƒ íƒ­ë°” (í…ìŠ¤íŠ¸ ì“°ê¸° / í•„ê¸°)
â”œâ”€â”€ í˜„ì¬ ëª¨ë“œì— ë”°ë¥¸ í™”ë©´ í‘œì‹œ
â”‚   â”œâ”€â”€ í…ìŠ¤íŠ¸ ì“°ê¸° ëª¨ë“œ â†’ 3.3.2
â”‚   â””â”€â”€ í•„ê¸° ëª¨ë“œ â†’ 3.3.3
â””â”€â”€ ì €ì¥ ë²„íŠ¼
    â””â”€â”€ onPressed: í…ìŠ¤íŠ¸ ì €ì¥

3.3.2 í…ìŠ¤íŠ¸ ì“°ê¸° ëª¨ë“œ (TextWritingMode)

3.3.2.1 ë ˆì´ì•„ì›ƒ êµ¬ì¡°
GestureDetector (í‚¤ë³´ë“œ ì œì–´ìš©)
â””â”€â”€ Column
    â”œâ”€â”€ íŒŒì¼ ëª©ë¡ Container (í¬ì»¤ìŠ¤ ì—†ì„ ë•Œë§Œ)
    â”‚   â””â”€â”€ ListView (í…ìŠ¤íŠ¸ íŒŒì¼ë“¤)
    â”œâ”€â”€ í¸ì§‘ ì¤‘ íŒŒì¼ ì •ë³´ (í¬ì»¤ìŠ¤ ìˆì„ ë•Œë§Œ)
    â””â”€â”€ í…ìŠ¤íŠ¸ ì…ë ¥ì°½ (Expanded)

3.3.2.2 íŒŒì¼ ëª©ë¡ UI (ì ‘íŒ ìƒíƒœ)
Container (height: 120)
â””â”€â”€ Column
    â””â”€â”€ ListView.builder
        â””â”€â”€ ListTile (dense: true)
            â”œâ”€â”€ Leading: Icon(Icons.keyboard, size: 16)
            â”œâ”€â”€ Title: Row
            â”‚   â”œâ”€â”€ Expanded: íŒŒì¼ëª…
            â”‚   â”œâ”€â”€ ë‚ ì§œ/ì‹œê°„
            â”‚   â””â”€â”€ ì‚­ì œ IconButton
            â””â”€â”€ ë°°ê²½ìƒ‰: ì„ íƒëœ íŒŒì¼ì€ ì—°í•œ ì´ˆë¡ìƒ‰

3.3.2.3 í¸ì§‘ ì¤‘ íŒŒì¼ ì •ë³´ UI
Container (íŒŒë€ìƒ‰ í…Œë‘ë¦¬)
â””â”€â”€ Row
    â”œâ”€â”€ Icon(Icons.edit_note, color: Colors.blue)
    â”œâ”€â”€ SizedBox(width: 8)
    â”œâ”€â”€ Expanded: íŒŒì¼ëª… (íŒŒë€ìƒ‰, êµµê²Œ)
    â”œâ”€â”€ ë‚ ì§œ/ì‹œê°„ (íšŒìƒ‰)
    â””â”€â”€ ì‚­ì œ IconButton (ì„ íƒëœ íŒŒì¼ë§Œ)

3.3.2.4 í…ìŠ¤íŠ¸ ì…ë ¥ì°½ UI
GestureDetector (íƒ­í•˜ë©´ í¬ì»¤ìŠ¤)
â””â”€â”€ AbsorbPointer(absorbing: false)
    â””â”€â”€ TextField
        â”œâ”€â”€ controller: _controller
        â”œâ”€â”€ focusNode: _focusNode
        â”œâ”€â”€ minLines: null, maxLines: null
        â”œâ”€â”€ expands: true
        â”œâ”€â”€ onChanged: _onTextChanged (ìë™ì €ì¥ íŠ¸ë¦¬ê±°)
        â””â”€â”€ decoration: í…Œë‘ë¦¬ + íŒíŠ¸

3.3.3 í•„ê¸° ëª¨ë“œ (HandwritingMode) - ì´ë¯¸ì§€ ì£¼ì„ ë° ìŠ¤ì¼€ì¹˜

3.3.4.1 ë ˆì´ì•„ì›ƒ êµ¬ì¡°  
Column
â”œâ”€â”€ AdBanner (ë¬´ë£Œ ì‚¬ìš©ìë§Œ, height: 50)
â””â”€â”€ Expanded
    â””â”€â”€ Scaffold
        â””â”€â”€ GestureDetector (onTapDown: ì£¼ì„ ì¶”ê°€)
            â””â”€â”€ Stack
                â”œâ”€â”€ ì´ë¯¸ì§€ ë·°ì–´ ì˜ì—­
                â”œâ”€â”€ íŒŒì¼ íƒ€ì… ì•„ì´ì½˜ë“¤ (ìƒë‹¨)
                â””â”€â”€ ì£¼ì„ ìœ„ì ¯ë“¤ (Positioned)

3.3.4.2 íŒŒì¼ íƒ€ì… ì•„ì´ì½˜ UI
Positioned(top: 20, left: 20)
â””â”€â”€ Container (ì¹´ë“œ ìŠ¤íƒ€ì¼)
    â””â”€â”€ Row
        â”œâ”€â”€ Icon(Icons.picture_as_image, color: Colors.red)
        â”œâ”€â”€ SizedBox(width: 8)
        â””â”€â”€ Text("IMAGE", color: Colors.red)

Positioned(top: 20, left: 100)  
â””â”€â”€ Container (ì¹´ë“œ ìŠ¤íƒ€ì¼)
    â””â”€â”€ Row
        â”œâ”€â”€ Icon(Icons.description, color: Colors.blue)
        â”œâ”€â”€ SizedBox(width: 8)
        â””â”€â”€ Text("DOC", color: Colors.blue)

3.3.4.3 í•„ê¸° ë„êµ¬ íŒ¨ë„ UI
Positioned(bottom: 0)
â””â”€â”€ Container
    â”œâ”€â”€ height: 120
    â”œâ”€â”€ decoration: BoxDecoration(color: Colors.white, boxShadow)
    â””â”€â”€ Column
        â”œâ”€â”€ HandwritingToolbar() // ìƒë‹¨ ë„êµ¬ë°”
        â”œâ”€â”€ AudioTimestampMarker() // ìŒì„± ì‹œê°„ ë§ˆì»¤ (ë™ê¸°í™” í™œì„± ì‹œ)
        â””â”€â”€ HandwritingColorPalette() // í•˜ë‹¨ ìƒ‰ìƒ íŒ”ë ˆíŠ¸

3.3.4.4 í•„ê¸° íŒŒì¼ ì¶”ê°€ UI
FloatingActionButton ("+" ë²„íŠ¼)
â””â”€â”€ onPressed: íŒŒì¼ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸

3.5 ì„¤ì • í™”ë©´ (SettingsScreen)

3.5.1 ë ˆì´ì•„ì›ƒ êµ¬ì¡°
Scaffold
â”œâ”€â”€ AdBanner (ë¬´ë£Œ ì‚¬ìš©ìë§Œ, height: 50)
â””â”€â”€ Padding
    â””â”€â”€ Column
        â”œâ”€â”€ ì œëª© ("ì„¤ì •")
        â”œâ”€â”€ SizedBox(height: 24)
        â”œâ”€â”€ ë“£ê¸° ì„¤ì • Card
        â”œâ”€â”€ SizedBox(height: 16)
        â”œâ”€â”€ ì“°ê¸° ì„¤ì • Card
        â”œâ”€â”€ SizedBox(height: 16)
        â”œâ”€â”€ í…Œë§ˆ ì„¤ì • Card
        â”œâ”€â”€ SizedBox(height: 16)
        â””â”€â”€ ì–¸ì–´ ì„¤ì • Card

3.5.2 ì„¤ì • ì¹´ë“œ UI
Card
â””â”€â”€ Padding
    â””â”€â”€ Column
        â”œâ”€â”€ ì„¹ì…˜ ì œëª© (ì˜ˆ: "ë“£ê¸° ì„¤ì •")
        â”œâ”€â”€ SizedBox(height: 16)
        â”œâ”€â”€ ì˜µì…˜ ì œëª© (ì˜ˆ: "ìµœëŒ€ ë“£ê¸° ì‹œê°„")
        â”œâ”€â”€ SizedBox(height: 8)
        â”œâ”€â”€ ë¼ë””ì˜¤ ë²„íŠ¼ ê·¸ë£¹
        â”‚   â””â”€â”€ Row Ã— Nê°œ
        â”‚       â”œâ”€â”€ Expanded: RadioListTile
        â”‚       â””â”€â”€ Expanded: RadioListTile
        â”œâ”€â”€ SizedBox(height: 8)
        â””â”€â”€ í˜„ì¬ ì„¤ì • í‘œì‹œ Container
            â””â”€â”€ Row
                â”œâ”€â”€ Icon(Icons.info_outline, color: Colors.blue)
                â”œâ”€â”€ SizedBox(width: 8)
                â””â”€â”€ Expanded: Text("í˜„ì¬ ì„¤ì •: XXë¶„")

================================================================================

4. ê³µí†µ UI ì»´í¬ë„ŒíŠ¸

4.1 AdBanner ì»´í¬ë„ŒíŠ¸ (ë¬´ë£Œ ì‚¬ìš©ì ì „ìš©)
Conditional Widget (isPremiumUser == false)
â”œâ”€â”€ Container
â”‚   â”œâ”€â”€ height: 50
â”‚   â”œâ”€â”€ width: double.infinity  
â”‚   â”œâ”€â”€ color: Colors.grey.shade50
â”‚   â”œâ”€â”€ padding: EdgeInsets.symmetric(horizontal: 12, vertical: 8)
â”‚   â””â”€â”€ decoration: BoxDecoration
â”‚       â””â”€â”€ border: Border(bottom: BorderSide(color: Colors.grey.shade200))
â”œâ”€â”€ ê´‘ê³  ìƒíƒœë³„ UI:
â”‚   â”œâ”€â”€ ë¡œë”©ì¤‘: Row
â”‚   â”‚   â”œâ”€â”€ SizedBox(16x16 CircularProgressIndicator)
â”‚   â”‚   â”œâ”€â”€ SizedBox(width: 8)
â”‚   â”‚   â””â”€â”€ Text("ê´‘ê³  ë¡œë”© ì¤‘...", style: caption)
â”‚   â”œâ”€â”€ ì—ëŸ¬: Row
â”‚   â”‚   â”œâ”€â”€ Icon(Icons.error_outline, size: 16, color: Colors.orange)
â”‚   â”‚   â”œâ”€â”€ SizedBox(width: 8)
â”‚   â”‚   â””â”€â”€ Text("ê´‘ê³ ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤", style: caption)
â”‚   â””â”€â”€ ì„±ê³µ: Row
â”‚       â”œâ”€â”€ Expanded: ê´‘ê³  ì»¨í…ì¸  (ì´ë¯¸ì§€ ë˜ëŠ” í…ìŠ¤íŠ¸)
â”‚       â”œâ”€â”€ SizedBox(width: 8)
â”‚       â””â”€â”€ ElevatedButton
â”‚           â”œâ”€â”€ text: "ê´‘ê³  ì œê±°"
â”‚           â”œâ”€â”€ style: ì‘ì€ ë²„íŠ¼ (height: 28)
â”‚           â””â”€â”€ onPressed: í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ ì•ˆë‚´
â””â”€â”€ onTap: ê´‘ê³  í´ë¦­ ì²˜ë¦¬ (ì™¸ë¶€ ë§í¬ ë˜ëŠ” ì•± ì„¤ì¹˜)

ê´‘ê³  í‘œì‹œ ì¡°ê±´:
- ë¬´ë£Œ ì‚¬ìš©ì (isPremiumUser == false)ì¼ ë•Œë§Œ í‘œì‹œ
- ìœ ë£Œ ì‚¬ìš©ìëŠ” í•´ë‹¹ ì˜ì—­ ìì²´ê°€ ë Œë”ë§ë˜ì§€ ì•ŠìŒ
- ê´‘ê³  ë¡œë”© ì‹¤íŒ¨ ì‹œì—ë„ ì˜ì—­ì€ ìœ ì§€ (ì¬ì‹œë„ ë²„íŠ¼ ì œê³µ)

4.2 AppBar ì»´í¬ë„ŒíŠ¸
AppBar
â”œâ”€â”€ leading: ì»¤ìŠ¤í…€ ë¡œê³  Container
â”‚   â””â”€â”€ Column
â”‚       â”œâ”€â”€ Icon(Icons.hearing, size: 28, color: Colors.redAccent)
â”‚       â””â”€â”€ Row
â”‚           â”œâ”€â”€ Icon(Icons.keyboard, size: 28, color: Colors.blueAccent)
â”‚           â””â”€â”€ Icon(Icons.draw, size: 28, color: Colors.greenAccent)
â”œâ”€â”€ title: ì¡°ê±´ë¶€ ë Œë”ë§
â”‚   â”œâ”€â”€ ë…¸íŠ¸ ì„ íƒë¨: ë…¸íŠ¸ ì œëª© (ì¤‘ì•™ ì •ë ¬, 2ì¤„)
â”‚   â””â”€â”€ ë…¸íŠ¸ ì—†ìŒ: "ë¦¬íŠ¼ì„ ìƒì„±í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”"
â””â”€â”€ actions: íŒŒì¼ ìˆ˜ ë°°ì§€ë“¤ (ë…¸íŠ¸ ì„ íƒ ì‹œì—ë§Œ)
    â””â”€â”€ Row
        â”œâ”€â”€ ë“£ê¸° íŒŒì¼ ìˆ˜ ë°°ì§€
        â””â”€â”€ ì“°ê¸° íŒŒì¼ ìˆ˜ ë°°ì§€

4.2 í”„ë¦¬ë¯¸ì—„ ê´€ë ¨ UI ì»´í¬ë„ŒíŠ¸

4.2.1 í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ ë‹¤ì´ì–¼ë¡œê·¸ (UpgradeDialog)
AlertDialog
â”œâ”€â”€ title: Row
â”‚   â”œâ”€â”€ Icon(Icons.star, color: Colors.amber)
â”‚   â”œâ”€â”€ SizedBox(width: 8)
â”‚   â””â”€â”€ Text("í”„ë¦¬ë¯¸ì—„ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ")
â”œâ”€â”€ content: Column
â”‚   â”œâ”€â”€ Text("í”„ë¦¬ë¯¸ì—„ í˜œíƒ:", style: êµµì€ ê¸€ì”¨)
â”‚   â”œâ”€â”€ SizedBox(height: 12)
â”‚   â”œâ”€â”€ í˜œíƒ ëª©ë¡: Column
â”‚   â”‚   â”œâ”€â”€ Row: "âœ“ ê´‘ê³  ì™„ì „ ì œê±°"
â”‚   â”‚   â”œâ”€â”€ Row: "âœ“ í´ë¼ìš°ë“œ ë™ê¸°í™”"
â”‚   â”‚   â””â”€â”€ Row: "âœ“ PC/ì›¹ì—ì„œ ì‚¬ìš© ê°€ëŠ¥"
â”‚   â”œâ”€â”€ SizedBox(height: 16)
â”‚   â”œâ”€â”€ ê°€ê²© í‘œì‹œ: Container
â”‚   â”‚   â”œâ”€â”€ decoration: í…Œë‘ë¦¬ + ë°°ê²½ìƒ‰
â”‚   â”‚   â””â”€â”€ Column
â”‚   â”‚       â”œâ”€â”€ Text("ì›” â‚©4,900", style: í° ê¸€ì”¨)
â”‚   â”‚       â””â”€â”€ Text("ì–¸ì œë“  í•´ì§€ ê°€ëŠ¥")
â”‚   â””â”€â”€ SizedBox(height: 8)
â””â”€â”€ actions: Row
    â”œâ”€â”€ TextButton("ë‚˜ì¤‘ì—")
    â”œâ”€â”€ SizedBox(width: 8)
    â””â”€â”€ ElevatedButton("ì§€ê¸ˆ ì—…ê·¸ë ˆì´ë“œ")


4.3 íŒŒì¼ ìˆ˜ ë°°ì§€ ì»´í¬ë„ŒíŠ¸
Container
â”œâ”€â”€ padding: EdgeInsets.symmetric(horizontal: 8, vertical: 4)
â”œâ”€â”€ decoration: BoxDecoration
â”‚   â”œâ”€â”€ color: [ê¸°ëŠ¥ìƒ‰ìƒ].withOpacity(0.1)
â”‚   â””â”€â”€ borderRadius: BorderRadius.circular(12)
â””â”€â”€ Row
    â”œâ”€â”€ Icon([ê¸°ëŠ¥ì•„ì´ì½˜], size: 11, color: [ê¸°ëŠ¥ìƒ‰ìƒ])
    â”œâ”€â”€ SizedBox(width: 4)
    â””â”€â”€ Text(íŒŒì¼ìˆ˜, style: ì‘ê³  êµµì€ ìŠ¤íƒ€ì¼)

ìƒ‰ìƒ ë§¤í•‘:
- ë“£ê¸°: Colors.red
- ì“°ê¸°: Colors.green

4.3 ìƒíƒœ í‘œì‹œ ì»´í¬ë„ŒíŠ¸

4.3.1 ìŒì„±-ì“°ê¸° ë™ê¸°í™” ìƒíƒœ í‘œì‹œ (AudioSyncIndicator)
Container
â”œâ”€â”€ padding: EdgeInsets.all(8)
â”œâ”€â”€ decoration: ì—°í•œ ë°°ê²½ìƒ‰ + í…Œë‘ë¦¬
â””â”€â”€ Row
    â”œâ”€â”€ Icon(Icons.sync, color: Colors.blue)
    â”œâ”€â”€ SizedBox(width: 8)
    â”œâ”€â”€ Text("ìŒì„± ë™ê¸°í™” í™œì„±", color: Colors.blue)
    â””â”€â”€ ì¡°ê±´ë¶€ í‘œì‹œ: í˜„ì¬ ì¬ìƒ ì‹œê°„ "02:34"

// ë“£ê¸° ì¤‘ ìƒíƒœ
Row
â”œâ”€â”€ Icon(Icons.record_voice_over, color: Colors.red)
â”œâ”€â”€ SizedBox(width: 8)
â””â”€â”€ Text("ë“£ê¸° ì¤‘...", color: Colors.red)

// ì¬ìƒ ì¤‘ ìƒíƒœ  
Row
â”œâ”€â”€ Icon(Icons.play_arrow, color: Colors.green)
â”œâ”€â”€ SizedBox(width: 8)
â””â”€â”€ Text("ì¬ìƒ ì¤‘...", color: Colors.green)

// ì €ì¥ ì¤‘ ìƒíƒœ
Row
â”œâ”€â”€ SizedBox(16x16 CircularProgressIndicator)
â”œâ”€â”€ SizedBox(width: 8)
â””â”€â”€ Text("ì €ì¥ ì¤‘...")

4.4 ë¹ˆ ìƒíƒœ ì»´í¬ë„ŒíŠ¸
Center
â””â”€â”€ Column
    â”œâ”€â”€ Icon([ìƒí™©ë³„ ì•„ì´ì½˜], size: 64, color: Colors.grey)
    â”œâ”€â”€ SizedBox(height: 16)
    â”œâ”€â”€ Text(ë©”ì¸ ë©”ì‹œì§€, style: ì œëª© ìŠ¤íƒ€ì¼)
    â”œâ”€â”€ SizedBox(height: 8)
    â””â”€â”€ Text(ì„¤ëª… ë©”ì‹œì§€, style: ë¶€ì œëª© ìŠ¤íƒ€ì¼)

================================================================================

5. í…Œë§ˆ ë° ë””ìì¸ ì‹œìŠ¤í…œ

5.1 5ê°€ì§€ í…Œë§ˆ ì‹œìŠ¤í…œ

5.1.1 í…Œë§ˆ 1: í´ë˜ì‹ ë¸”ë£¨ (ê¸°ë³¸)
// ê¸°ë³¸ ìƒ‰ìƒ
Primary: Colors.blue
Secondary: Colors.blueAccent
Background: Colors.white
Surface: Colors.grey.shade50
OnPrimary: Colors.white
OnSurface: Colors.black87

5.1.2 í…Œë§ˆ 2: ë‹¤í¬ ëª¨ë“œ
Primary: Colors.blue.shade300
Secondary: Colors.blueAccent.shade200
Background: Colors.grey.shade900
Surface: Colors.grey.shade800
OnPrimary: Colors.black
OnSurface: Colors.white

5.1.3 í…Œë§ˆ 3: ë„¤ì´ì²˜ ê·¸ë¦°
Primary: Colors.green.shade600
Secondary: Colors.lightGreen
Background: Colors.green.shade50
Surface: Colors.white
OnPrimary: Colors.white
OnSurface: Colors.green.shade900

5.1.4 í…Œë§ˆ 4: ì„ ì…‹ ì˜¤ë Œì§€
Primary: Colors.orange.shade600
Secondary: Colors.deepOrange
Background: Colors.orange.shade50
Surface: Colors.white
OnPrimary: Colors.white
OnSurface: Colors.orange.shade900

5.1.5 í…Œë§ˆ 5: ëª¨ë…¸í¬ë¡¬ ê·¸ë ˆì´
Primary: Colors.grey.shade700
Secondary: Colors.grey.shade500
Background: Colors.grey.shade100
Surface: Colors.white
OnPrimary: Colors.white
OnSurface: Colors.black87

5.2 ìƒ‰ìƒ íŒ”ë ˆíŠ¸ (ê³µí†µ)

// ê¸°ëŠ¥ë³„ ìƒ‰ìƒ (ëª¨ë“  í…Œë§ˆ ê³µí†µ)
Recording: Colors.red (ë“£ê¸°)
Writing: Colors.green (ì“°ê¸°)

// ìƒíƒœ ìƒ‰ìƒ
Success: Colors.green
Warning: Colors.orange
Error: Colors.red
Info: Colors.blue

// íšŒìƒ‰ ê³„ì—´
Grey50: Colors.grey.shade50
Grey100: Colors.grey.shade100
Grey300: Colors.grey.shade300
Grey600: Colors.grey.shade600

5.3 í…Œë§ˆ ì„ íƒ UI ì»´í¬ë„ŒíŠ¸

5.3.1 í…Œë§ˆ ì„ íƒ í™”ë©´ (ThemeSelectionScreen)
Scaffold
â”œâ”€â”€ AppBar
â”‚   â”œâ”€â”€ title: Text("í…Œë§ˆ ì„ íƒ")
â”‚   â””â”€â”€ leading: IconButton(ëŠ¥ê¸° ë²„íŠ¼)
â””â”€â”€ body: Padding
    â””â”€â”€ Column
        â”œâ”€â”€ Text("ì›í•˜ëŠ” í…Œë§ˆë¥¼ ì„ íƒí•˜ì„¸ìš”", style: headline2)
        â”œâ”€â”€ SizedBox(height: 24)
        â”œâ”€â”€ í…Œë§ˆ ë¦¬ìŠ¤íŠ¸: Expanded
        â”‚   â””â”€â”€ ListView
        â”‚       â”œâ”€â”€ ThemeCard(í´ë˜ì‹ ë¸”ë£¨)
        â”‚       â”œâ”€â”€ ThemeCard(ë‹¤í¬ ëª¨ë“œ)
        â”‚       â”œâ”€â”€ ThemeCard(ë„¤ì´ì²˜ ê·¸ë¦°)
        â”‚       â”œâ”€â”€ ThemeCard(ì„ ì…‹ ì˜¤ë Œì§€)
        â”‚       â””â”€â”€ ThemeCard(ëª¨ë…¸í¬ë¡¬ ê·¸ë ˆì´)
        â”œâ”€â”€ SizedBox(height: 24)
        â””â”€â”€ ElevatedButton("ì ìš©í•˜ê¸°", onPressed: _applyTheme)

5.3.2 í…Œë§ˆ ì¹´ë“œ (ThemeCard)
Container
â”œâ”€â”€ height: 120
â”œâ”€â”€ margin: EdgeInsets.symmetric(vertical: 8)
â”œâ”€â”€ decoration: BoxDecoration
â”‚   â”œâ”€â”€ borderRadius: BorderRadius.circular(12)
â”‚   â”œâ”€â”€ border: ì„ íƒëœ í…Œë§ˆì¼ ë•Œ 2px í…Œë‘ë¦¬
â”‚   â””â”€â”€ boxShadow: ì—°í•œ ê·¸ë¦¼ì
â””â”€â”€ child: InkWell
    â”œâ”€â”€ onTap: _selectTheme
    â””â”€â”€ child: Row
        â”œâ”€â”€ í…Œë§ˆ ë¯¸ë¦¬ë³´ê¸°: Container (width: 80)
        â”‚   â””â”€â”€ Column
        â”‚       â”œâ”€â”€ Container(ì£¼ìƒ‰ìƒ ë°•ìŠ¤, height: 30)
        â”‚       â”œâ”€â”€ Container(ë°°ê²½ìƒ‰ ë°•ìŠ¤, height: 60)
        â”‚       â””â”€â”€ Container(ì—°ë°˜ìƒ‰ ë°•ìŠ¤, height: 30)
        â”œâ”€â”€ SizedBox(width: 16)
        â”œâ”€â”€ í…Œë§ˆ ì •ë³´: Expanded
        â”‚   â””â”€â”€ Column
        â”‚       â”œâ”€â”€ Text(í…Œë§ˆëª…, style: êµµì€ ê¸€ì”¨)
        â”‚       â”œâ”€â”€ SizedBox(height: 4)
        â”‚       â””â”€â”€ Text(í…Œë§ˆ ì„¤ëª…, style: ì‘ì€ ê¸€ì”¨)
        â””â”€â”€ ì„ íƒ ìƒíƒœ: Container
            â””â”€â”€ Icon(Icons.check_circle, ì„ íƒëœ ê²½ìš°ë§Œ í‘œì‹œ)

5.3.3 í…Œë§ˆ ì„¤ì • ì¹´ë“œ (ThemeSettingsCard)
Card
â””â”€â”€ Padding
    â””â”€â”€ Column
        â”œâ”€â”€ ì„¬ì…˜ ì œëª©: Text("í…Œë§ˆ ì„¤ì •")
        â”œâ”€â”€ SizedBox(height: 16)
        â”œâ”€â”€ í˜„ì¬ í…Œë§ˆ í‘œì‹œ: ListTile
        â”‚   â”œâ”€â”€ leading: Icon(Icons.palette)
        â”‚   â”œâ”€â”€ title: Text("í˜„ì¬ í…Œë§ˆ")
        â”‚   â”œâ”€â”€ subtitle: Text(í˜„ì¬ í…Œë§ˆëª…)
        â”‚   â””â”€â”€ trailing: í…Œë§ˆ ë¯¸ë¦¬ë³´ê¸° ì„œí´
        â”œâ”€â”€ Divider()
        â””â”€â”€ ë³€ê²½ ë²„íŠ¼: ListTile
            â”œâ”€â”€ leading: Icon(Icons.edit)
            â”œâ”€â”€ title: Text("í…Œë§ˆ ë³€ê²½")
            â”œâ”€â”€ subtitle: Text("5ê°€ì§€ í…Œë§ˆ ì¤‘ ì„ íƒ")
            â””â”€â”€ onTap: ThemeSelectionScreenìœ¼ë¡œ ì´ë™

5.4 íƒ€ì´í¬ê·¸ë˜í”¼
// ì œëª©
headline1: TextStyle(fontSize: 24, fontWeight: FontWeight.bold)
headline2: TextStyle(fontSize: 18, fontWeight: FontWeight.w600)

// ë³¸ë¬¸
bodyText1: TextStyle(fontSize: 16, fontWeight: FontWeight.normal)
bodyText2: TextStyle(fontSize: 14, fontWeight: FontWeight.normal)

// ìº¡ì…˜
caption: TextStyle(fontSize: 12, color: Colors.grey)
caption2: TextStyle(fontSize: 10, color: Colors.grey)

// ë²„íŠ¼
button: TextStyle(fontSize: 16, fontWeight: FontWeight.w500)

5.5 ê°„ê²© ì‹œìŠ¤í…œ
// íŒ¨ë”©
padding4: EdgeInsets.all(4)
padding8: EdgeInsets.all(8)  
padding12: EdgeInsets.all(12)
padding16: EdgeInsets.all(16)

// ë§ˆì§„
margin4: EdgeInsets.all(4)
margin8: EdgeInsets.all(8)
margin16: EdgeInsets.all(16)

// ë†’ì´
height4: SizedBox(height: 4)
height8: SizedBox(height: 8)
height16: SizedBox(height: 16)
height24: SizedBox(height: 24)

5.6 í…Œë‘ë¦¬ ë° ê·¸ë¦¼ì
// í…Œë‘ë¦¬ ë°˜ê²½
borderRadius4: BorderRadius.circular(4)
borderRadius8: BorderRadius.circular(8)
borderRadius12: BorderRadius.circular(12)

// ê·¸ë¦¼ì
boxShadowLight: BoxShadow(
  color: Colors.black.withOpacity(0.1),
  blurRadius: 4,
  offset: Offset(0, 2)
)

boxShadowMedium: BoxShadow(
  color: Colors.black.withOpacity(0.2),
  blurRadius: 8,
  offset: Offset(0, 4)
)

================================================================================

6. ì‹¤ì œ UI í”„ë ˆì„ ì˜ˆì‹œ

6.1 í™ˆ í™”ë©´ ì™€ì´ì–´í”„ë ˆì„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤âœï¸ ë¦¬íŠ¼ì„ ìƒì„±í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”   [ğŸ¤3][âœï¸0] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ ğŸ“ íšŒì˜ë¡                           â”‚
â”‚    ì—…ë¬´ ê´€ë ¨ ë‚´ìš©ë“¤...    ğŸ¤2 âœï¸1 â”‚
â”‚                      ì›”/í™” 14:30 ğŸ—‘ï¸  â”‚
|  íšŒì˜ë¡_143027   12/01 14:30       |
| ğŸ¤ íŒŒì¼ëª…       [2:30] 12/02 14:30  |
| âœï¸ íšŒì˜ë¡             12/02 14:30   |
â”‚ ğŸ“ ê°•ì˜ë…¸íŠ¸                         â”‚
â”‚    ìˆ˜í•™ ë¯¸ì ë¶„ ê´€ë ¨...    ğŸ¤1 âœï¸0 â”‚
â”‚                      í™”/ìˆ˜ 09:15 ğŸ—‘ï¸  â”‚
â”‚                                     â”‚
â”‚ [+ ë¦¬íŠ¼ ìƒì„±]                       â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [í™ˆ] [ë“£ê¸°] [ì“°ê¸°] [ì„¤ì •]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6.2 ë“£ê¸° í™”ë©´ ì™€ì´ì–´í”„ë ˆì„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤âœï¸ íšŒì˜ë¡              [ğŸ¤3][âœï¸0] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ â”Œâ”€ 20241201_ì›”_143027.aac â”€â”€â”€â”€ ğŸ—‘ï¸ â”â”‚
â”‚ â”‚ ğŸ¤ íŒŒì¼ëª…                   [2:30] â”‚â”‚
â”‚ â”‚ â– â– â– â– â– â– â– â–‘â–‘â–‘ 1:45 / 2:30        â”‚â”‚
â”‚ â”‚ [1.0x][1.2x][1.5x][2.0x] [â–¶ï¸] [ğŸ”–] â”‚â”‚
â”‚ â”‚ ë¶ë§ˆí¬: [ğŸ“0:15] [ğŸ“1:23] [ğŸ“2:05] â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ 20241201_ì›”_142815.aac â”€â”€â”€â”€ ğŸ—‘ï¸ â”â”‚
â”‚ â”‚ ğŸ¤ íŒŒì¼ëª…                   [1:20] â”‚â”‚
â”‚ â”‚ [1.0x][1.2x][1.5x][2.0x] [â–¶ï¸] [ğŸ”–] â”‚â”‚
â”‚ â”‚ ë¶ë§ˆí¬: [ğŸ“0:32] [ğŸ“1:05]        â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ 20241201_ì›”_141203.aac â”€â”€â”€â”€ ğŸ—‘ï¸ â”â”‚
â”‚ â”‚ ğŸ¤ íŒŒì¼ëª… (ë“£ê¸° ì¤‘...)      [0:45] â”‚â”‚
â”‚ â”‚ [1.0x][1.2x][1.5x][2.0x] [ğŸ”´] [ğŸ”–+]â”‚â”‚
â”‚ â”‚ ë¶ë§ˆí¬: [ğŸ“0:12] [ğŸ“0:28]        â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚ [ğŸ¤ ë“£ê¸°] [â¹ï¸ ì •ì§€] ğŸ”´ ë“£ê¸° ì¤‘...     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [í™ˆ] [ë“£ê¸°] [ì“°ê¸°] [ì„¤ì •]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6.3 ì“°ê¸° í™”ë©´ ì™€ì´ì–´í”„ë ˆì„ (í¸ì§‘ ëª¨ë“œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤âœï¸ íšŒì˜ë¡              [ğŸ¤3][âœï¸0] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ ğŸ“ íšŒì˜ë¡_143027 12/01 14:30 ğŸ—‘ï¸ â”â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ë„êµ¬ë°” â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [B][I][U][S] [H1][H2][H3] [â€¢][1.] â”‚â”‚
â”‚ â”‚ [â¬…ï¸][â¡ï¸] [ğŸ”—][ğŸ¨] [Aa][Tt] [ğŸ“‹]    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ì˜¤ëŠ˜ íšŒì˜ì—ì„œ ë…¼ì˜ëœ ë‚´ìš©:      â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ 1. í”„ë¡œì íŠ¸ ì¼ì • ê²€í†            â”‚ â”‚
â”‚ â”‚ 2. ì˜ˆì‚° ë°°ì • ê´€ë ¨ ë…¼ì˜          â”‚ â”‚
â”‚ â”‚ 3. íŒ€ì› ì—­í•  ë¶„ë‹´               â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ ë‹¤ìŒ íšŒì˜ëŠ” ë‹¤ìŒ ì£¼ í™”ìš”ì¼ì—    â”‚ â”‚
â”‚ â”‚ ì§„í–‰í•˜ê¸°ë¡œ ê²°ì •...              â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ |                               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ [          ì €ì¥          ]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [í™ˆ] [ë“£ê¸°] [ì“°ê¸°] [ì„¤ì •]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6.4 ì“°ê¸° í™”ë©´ ì™€ì´ì–´í”„ë ˆì„ (ëª©ë¡ ëª¨ë“œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤âœï¸ íšŒì˜ë¡              [ğŸ¤3][âœï¸0] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ ì €ì¥ëœ í…ìŠ¤íŠ¸ ëª©ë¡ (120px) â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœï¸ íšŒì˜ë¡_143027   12/01 14:30 ğŸ—‘ï¸â”‚â”‚
â”‚ â”‚ âœï¸ì•„ì´ë””ì–´_142215 12/01 14:22 ğŸ—‘ï¸â”‚â”‚
â”‚ â”‚ âœï¸ ë©”ëª¨ì¥_141156   12/01 14:11 ğŸ—‘ï¸â”‚â”‚
â”‚ â”‚ âœï¸ í• ì¼ëª©ë¡_140945 12/01 14:09 ğŸ—‘ï¸â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ë„êµ¬ë°” â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [B][I][U][S] [H1][H2][H3] [â€¢][1.] â”‚â”‚
â”‚ â”‚ [â¬…ï¸][â¡ï¸] [ğŸ”—][ğŸ¨] [Aa][Tt] [ğŸ“‹]    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...            â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚                                     â”‚
â”‚ [          ì €ì¥          ]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [í™ˆ] [ë“£ê¸°] [ì“°ê¸°] [ì„¤ì •]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6.5 ì„¤ì • í™”ë©´ ì™€ì´ì–´í”„ë ˆì„ (ì™„ì „í•œ êµ¬ì„±)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤âœï¸ ì„¤ì •                     [ê²€ìƒ‰] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ â”Œâ”€ ê³„ì • ë° êµ¬ë… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘¤ ë¬´ë£Œ ì‚¬ìš©ì                  â”‚ â”‚
â”‚ â”‚    ğŸ“Š í†µê³„: 2ê°œ ë¦¬íŠ¼, 8ê°œ íŒŒì¼    â”‚ â”‚
â”‚ â”‚ [ğŸ í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ]        â”‚ â”‚
â”‚ â”‚ [ğŸ“œ ë³€í™˜ ì´ë ¥] [â˜ï¸ ë™ê¸°í™” ìƒíƒœ]  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ ì•± ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ¨ í…Œë§ˆ: Classic Blue     [ë³€ê²½] â”‚ â”‚
â”‚ â”‚ ğŸŒ ì–¸ì–´: í•œêµ­ì–´           [ë³€ê²½] â”‚ â”‚
â”‚ â”‚ ğŸ“± ì‹œì‘ í™”ë©´: í™ˆ         [ë³€ê²½] â”‚ â”‚
â”‚ â”‚ ğŸ”” ì•Œë¦¼ ì„¤ì •            [âš™ï¸]  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ ë“£ê¸° ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â±ï¸ ìµœëŒ€ ë“£ê¸° ì‹œê°„: 1ì‹œê°„   [ë³€ê²½] â”‚ â”‚
â”‚ â”‚ ğŸ§ ì˜¤ë””ì˜¤ í’ˆì§ˆ: ê³ í’ˆì§ˆ     [ë³€ê²½] â”‚ â”‚
â”‚ â”‚ ğŸ”„ ìë™ ì¬ìƒ: OFF         [í† ê¸€] â”‚ â”‚
â”‚ â”‚ ğŸ“‚ ì €ì¥ ìœ„ì¹˜              [ë³€ê²½] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ ì“°ê¸° ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ’¾ ìë™ ì €ì¥: 1ë¶„          [ë³€ê²½] â”‚ â”‚
â”‚ â”‚ ğŸ“ ê¸°ë³¸ í°íŠ¸: ì‹œìŠ¤í…œ       [ë³€ê²½] â”‚ â”‚
â”‚ â”‚ ğŸ“Š ê¸€ì ìˆ˜ í‘œì‹œ: ON       [í† ê¸€] â”‚ â”‚
â”‚ â”‚ ğŸ” ë§ì¶¤ë²• ê²€ì‚¬: ON        [í† ê¸€] â”‚ â”‚
â”‚ â”‚ âœï¸ ê¸°ë³¸ íœ ìƒ‰ìƒ: ê²€ì •      [ë³€ê²½] â”‚ â”‚
â”‚ â”‚ ğŸ“ íœ êµµê¸°: ì¤‘ê°„           [ë³€ê²½] â”‚ â”‚
â”‚ â”‚ ğŸ“‹ ìš©ì§€ íƒ€ì…: ë¬´ì§€         [ë³€ê²½] â”‚ â”‚
â”‚ â”‚ ğŸ–ï¸ ì†ë°”ë‹¥ ê±°ë¶€: ON        [í† ê¸€] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ ë°ì´í„° ë° ê°œì¸ì •ë³´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°         [ì‹¤í–‰] â”‚ â”‚
â”‚ â”‚ ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ       [ì‹¤í–‰] â”‚ â”‚
â”‚ â”‚ ğŸ”’ ê°œì¸ì •ë³´ ì •ì±…          [ë³´ê¸°] â”‚ â”‚
â”‚ â”‚ ğŸ“‹ ì´ìš©ì•½ê´€              [ë³´ê¸°] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€ ê³ ê¸‰ ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ› ë””ë²„ê·¸ ëª¨ë“œ: OFF       [í† ê¸€] â”‚ â”‚
â”‚ â”‚ ğŸ“± ì•± ì •ë³´ v1.0.0         [ë³´ê¸°] â”‚ â”‚
â”‚ â”‚ ğŸ“ ê³ ê° ì§€ì›              [ì—°ê²°] â”‚ â”‚
â”‚ â”‚ â­ ì•± í‰ê°€í•˜ê¸°           [ì‹¤í–‰] â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [í™ˆ] [ë“£ê¸°] [ì“°ê¸°] [ì„¤ì •]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================

7. ìƒíƒœ ê´€ë¦¬ ë° ë°˜ì‘í˜• ë””ìì¸

7.1 ìƒíƒœ ê´€ë¦¬ íŒ¨í„´
// StatefulWidget ê¸°ë°˜ ìƒíƒœ ê´€ë¦¬
class MainTabScreen extends StatefulWidget {
  // ì£¼ìš” ìƒíƒœ ë³€ìˆ˜ë“¤
  int _selectedIndex = 0;           // í˜„ì¬ íƒ­
  Note? _selectedNote;              // ì„ íƒëœ ë…¸íŠ¸
  bool _isRecording = false;        // ë“£ê¸° ìƒíƒœ
  bool _isPlaying = false;          // ì¬ìƒ ìƒíƒœ
  bool _isPremiumUser = false;      // í”„ë¦¬ë¯¸ì—„ ì‚¬ìš©ì ì—¬ë¶€ (ê´‘ê³  í‘œì‹œ ì œì–´)
  bool _adLoaded = false;           // ê´‘ê³  ë¡œë”© ìƒíƒœ
  String? _adError;                 // ê´‘ê³  ë¡œë”© ì—ëŸ¬ ë©”ì‹œì§€
  
  // í…Œë§ˆ ê´€ë¦¬ ë³€ìˆ˜ë“¤
  String _currentTheme = 'classic_blue';  // í˜„ì¬ ì„ íƒëœ í…Œë§ˆ
  List<String> _availableThemes = [       // ì‚¬ìš© ê°€ëŠ¥í•œ í…Œë§ˆ ëª©ë¡
    'classic_blue',
    'dark_mode', 
    'nature_green',
    'sunset_orange',
    'monochrome_grey'
  ];
  
  // ì‚¬ìš©ëŸ‰ í†µê³„ ë³€ìˆ˜ë“¤
  int _currentNoteCount = 0;        // í˜„ì¬ ë¦¬íŠ¼ ìˆ˜
  int _currentRecordingCount = 0;   // í˜„ì¬ ìŒì„± íŒŒì¼ ìˆ˜
  int _currentWritingCount = 0;     // í˜„ì¬ í…ìŠ¤íŠ¸ íŒŒì¼ ìˆ˜
}

// ìƒíƒœ ì—…ë°ì´íŠ¸ ë©”ì„œë“œë“¤
void _onNoteSelected(Note note) { setState(() {...}); }
void _startRecording() { setState(() {...}); }
void _stopRecording() { setState(() {...}); }
void _blinkWritingCount() { setState(() {...}); }
void _loadAd() { setState(() {...}); }          // ê´‘ê³  ë¡œë”©
void _onAdClicked() { }                         // ê´‘ê³  í´ë¦­ ì²˜ë¦¬
void _showUpgradeDialog() { }                   // í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ ì•ˆë‚´

// í†µê³„ ê´€ë¦¬ ë©”ì„œë“œë“¤
void _updateUsageStats() {                      // ì‚¬ìš©ëŸ‰ í†µê³„ ì—…ë°ì´íŠ¸
  setState(() {
    // ì‹¤ì œ íŒŒì¼ ìˆ˜ ê³„ì‚° ë¡œì§
  });
}

int _getCurrentFileCount(String fileType) {     // í˜„ì¬ íŒŒì¼ ìˆ˜ ë°˜í™˜
  switch (fileType) {
    case 'recording': return _currentRecordingCount;
    case 'writing': return _currentWritingCount;
    default: return 0;
  }
}

double _getUsagePercentage(String type) {       // ì‚¬ìš©ë¥  ê³„ì‚°
  if (_isPremiumUser) return 0.0;
  
  if (type == 'note') {
    return _currentNoteCount / _maxNotes;
  } else {
    return _getCurrentFileCount(type) / _maxFilesPerType;
  }
}

// í…Œë§ˆ ê´€ë¦¬ ë©”ì„œë“œë“¤
void _applyTheme(String themeName) {            // í…Œë§ˆ ì ìš©
  setState(() {
    _currentTheme = themeName;
  });
  // SharedPreferencesì— í…Œë§ˆ ì €ì¥
  _saveThemePreference(themeName);
}

void _saveThemePreference(String themeName) {   // í…Œë§ˆ ì„¤ì • ì €ì¥
  // SharedPreferences ë¡œì§
}

void _loadThemePreference() {                   // í…Œë§ˆ ì„¤ì • ë¡œë“œ
  // SharedPreferencesì—ì„œ í…Œë§ˆ ë¡œë“œ
}

ThemeData _getThemeData(String themeName) {     // í…Œë§ˆ ë°ì´í„° ë°˜í™˜
  switch (themeName) {
    case 'classic_blue': return _buildClassicBlueTheme();
    case 'dark_mode': return _buildDarkTheme();
    case 'nature_green': return _buildNatureGreenTheme();
    case 'sunset_orange': return _buildSunsetOrangeTheme();
    case 'monochrome_grey': return _buildMonochromeGreyTheme();
    default: return _buildClassicBlueTheme();
  }
}

void _showThemeSelectionScreen() {              // í…Œë§ˆ ì„ íƒ í™”ë©´ í‘œì‹œ
  Navigator.push(context, MaterialPageRoute(
    builder: (context) => ThemeSelectionScreen(
      currentTheme: _currentTheme,
      onThemeSelected: _applyTheme,
    )
  ));
}

7.2 ë°˜ì‘í˜• ë””ìì¸
// í™”ë©´ í¬ê¸°ë³„ ë¶„ê¸°
Widget build(BuildContext context) {
  final screenWidth = MediaQuery.of(context).size.width;
  final isTablet = screenWidth > 600;
  
  return isTablet 
    ? TabletLayout() 
    : MobileLayout();
}

// í”Œë«í¼ë³„ ë¶„ê¸°  
Widget buildPlatformSpecific() {
  if (kIsWeb) {
    return WebSpecificWidget();
  } else if (Platform.isIOS) {
    return IOSSpecificWidget();
  } else {
    return AndroidSpecificWidget();
  }
}

7.3 ì ‘ê·¼ì„± ê³ ë ¤ì‚¬í•­
// ì˜ë¯¸ ìˆëŠ” ë ˆì´ë¸”
Semantics(
  label: 'ë¦¬íŠ¼ ìƒì„± ë²„íŠ¼',
  hint: 'ìƒˆë¡œìš´ ë…¸íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤',
  child: FloatingActionButton(...)
)

// í¬ì»¤ìŠ¤ ê´€ë¦¬
FocusNode _focusNode = FocusNode();
_focusNode.requestFocus(); // ëª…ì‹œì  í¬ì»¤ìŠ¤

================================================================================

8. ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ì»´í¬ë„ŒíŠ¸

8.1 RichTextToolbar êµ¬ì„± ìš”ì†Œ

// ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ë„êµ¬ë°” í´ë˜ìŠ¤
class RichTextToolbar extends StatelessWidget {
  final TextEditingController controller;
  final Function(String) onFormatApplied;
  
  RichTextToolbar({required this.controller, required this.onFormatApplied});

  @override
  Widget build(BuildContext context) {
    return Container(
      height: 80,
      padding: EdgeInsets.symmetric(horizontal: 8, vertical: 4),
      decoration: BoxDecoration(
        color: Theme.of(context).primaryColor.withOpacity(0.1),
        border: Border(bottom: BorderSide(color: Colors.grey.shade300))
      ),
      child: Column(
        children: [
          // ì²« ë²ˆì§¸ ì¤„: ê¸°ë³¸ ì„œì‹
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceEvenly,
            children: [
              _buildToolbarButton(Icons.format_bold, 'bold', 'êµµê²Œ'),
              _buildToolbarButton(Icons.format_italic, 'italic', 'ê¸°ìš¸ì„'),
              _buildToolbarButton(Icons.format_underlined, 'underline', 'ë°‘ì¤„'),
              _buildToolbarButton(Icons.strikethrough_s, 'strikethrough', 'ì·¨ì†Œì„ '),
              VerticalDivider(width: 1),
              _buildHeaderButton('H1', 'header1', 'ì œëª©1'),
              _buildHeaderButton('H2', 'header2', 'ì œëª©2'),
              _buildHeaderButton('H3', 'header3', 'ì œëª©3'),
              VerticalDivider(width: 1),
              _buildToolbarButton(Icons.format_list_bulleted, 'bullet', 'ë¶ˆë¦¿'),
              _buildToolbarButton(Icons.format_list_numbered, 'number', 'ë²ˆí˜¸'),
            ],
          ),
          SizedBox(height: 4),
          // ë‘ ë²ˆì§¸ ì¤„: ê³ ê¸‰ ê¸°ëŠ¥
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceEvenly,
            children: [
              _buildToolbarButton(Icons.format_indent_decrease, 'outdent', 'ë‚´ì–´ì“°ê¸°'),
              _buildToolbarButton(Icons.format_indent_increase, 'indent', 'ë“¤ì—¬ì“°ê¸°'),
              _buildToolbarButton(Icons.link, 'link', 'ë§í¬'),
              _buildToolbarButton(Icons.palette, 'color', 'ê¸€ììƒ‰'),
              _buildFontSizeButton(),
              _buildToolbarButton(Icons.text_fields, 'font', 'ê¸€ê¼´'),
              _buildToolbarButton(Icons.content_paste, 'paste', 'ë¶™ì—¬ë„£ê¸°'),
            ],
          ),
        ],
      ),
    );
  }

  Widget _buildToolbarButton(IconData icon, String action, String tooltip) {
    return Tooltip(
      message: tooltip,
      child: InkWell(
        onTap: () => onFormatApplied(action),
        borderRadius: BorderRadius.circular(4),
        child: Container(
          padding: EdgeInsets.all(8),
          child: Icon(icon, size: 20, color: Colors.grey.shade700),
        ),
      ),
    );
  }

  Widget _buildHeaderButton(String text, String action, String tooltip) {
    return Tooltip(
      message: tooltip,
      child: InkWell(
        onTap: () => onFormatApplied(action),
        borderRadius: BorderRadius.circular(4),
        child: Container(
          padding: EdgeInsets.symmetric(horizontal: 8, vertical: 6),
          child: Text(text, style: TextStyle(
            fontWeight: FontWeight.bold,
            fontSize: 12,
            color: Colors.grey.shade700
          )),
        ),
      ),
    );
  }

  Widget _buildFontSizeButton() {
    return PopupMenuButton<String>(
      child: Container(
        padding: EdgeInsets.all(8),
        child: Text('Aa', style: TextStyle(
          fontWeight: FontWeight.bold,
          fontSize: 12,
          color: Colors.grey.shade700
        )),
      ),
      onSelected: (size) => onFormatApplied('fontsize_$size'),
      itemBuilder: (context) => [
        PopupMenuItem(value: '12', child: Text('12pt')),
        PopupMenuItem(value: '14', child: Text('14pt')),
        PopupMenuItem(value: '16', child: Text('16pt')),
        PopupMenuItem(value: '18', child: Text('18pt')),
        PopupMenuItem(value: '20', child: Text('20pt')),
        PopupMenuItem(value: '24', child: Text('24pt')),
      ],
    );
  }
}

8.2 ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° êµ¬í˜„

// ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ë©”ì¸ í´ë˜ìŠ¤
class RichTextEditor extends StatefulWidget {
  final String initialText;
  final Function(String) onTextChanged;
  
  RichTextEditor({this.initialText = '', required this.onTextChanged});

  @override
  _RichTextEditorState createState() => _RichTextEditorState();
}

class _RichTextEditorState extends State<RichTextEditor> {
  late TextEditingController _controller;
  String _currentFormat = '';
  Map<String, dynamic> _formatState = {
    'bold': false,
    'italic': false,
    'underline': false,
    'fontSize': 16,
    'textColor': Colors.black,
  };

  @override
  void initState() {
    super.initState();
    _controller = TextEditingController(text: widget.initialText);
    _controller.addListener(_onTextChanged);
  }

  void _onTextChanged() {
    widget.onTextChanged(_controller.text);
  }

  void _applyFormat(String action) {
    int start = _controller.selection.start;
    int end = _controller.selection.end;
    
    if (start == end) return; // ì„ íƒëœ í…ìŠ¤íŠ¸ê°€ ì—†ìœ¼ë©´ return
    
    String selectedText = _controller.text.substring(start, end);
    String formattedText = _formatText(selectedText, action);
    
    String newText = _controller.text.replaceRange(start, end, formattedText);
    
    setState(() {
      _controller.text = newText;
      _controller.selection = TextSelection.collapsed(
        offset: start + formattedText.length
      );
    });
  }

  String _formatText(String text, String action) {
    switch (action) {
      case 'bold':
        return '**$text**';
      case 'italic':
        return '*$text*';
      case 'underline':
        return '__${text}__';
      case 'strikethrough':
        return '~~$text~~';
      case 'header1':
        return '# $text';
      case 'header2':
        return '## $text';
      case 'header3':
        return '### $text';
      case 'bullet':
        return 'â€¢ $text';
      case 'number':
        return '1. $text';
      case 'link':
        return '[$text](https://)';
      default:
        return text;
    }
  }

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        // ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ë„êµ¬ë°”
        RichTextToolbar(
          controller: _controller,
          onFormatApplied: _applyFormat,
        ),
        // í…ìŠ¤íŠ¸ ì—ë””í„°
        Expanded(
          child: Container(
            padding: EdgeInsets.all(16),
            child: TextField(
              controller: _controller,
              maxLines: null,
              expands: true,
              style: TextStyle(
                fontSize: _formatState['fontSize'].toDouble(),
                color: _formatState['textColor'],
              ),
              decoration: InputDecoration(
                hintText: 'ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...',
                border: InputBorder.none,
                focusedBorder: InputBorder.none,
              ),
              textAlignVertical: TextAlignVertical.top,
            ),
          ),
        ),
      ],
    );
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }
}

8.3 ì“°ê¸° í™”ë©´ì—ì„œ ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ì‚¬ìš©

// ê¸°ì¡´ ì“°ê¸° í™”ë©´ ìˆ˜ì • (WritingScreen)
class WritingScreen extends StatefulWidget {
  // ... ê¸°ì¡´ ì½”ë“œ

  Widget _buildTextEditor() {
    return RichTextEditor(
      initialText: _currentText,
      onTextChanged: (text) {
        setState(() {
          _currentText = text;
        });
      },
    );
  }

  Widget _buildContent() {
    return Column(
      children: [
        // ê¸°ì¡´ ìƒë‹¨ UI...
        
        // ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ì˜ì—­
        Expanded(
          child: _buildTextEditor(),
        ),
        
        // ì €ì¥ ë²„íŠ¼
        Container(
          width: double.infinity,
          padding: EdgeInsets.all(16),
          child: ElevatedButton(
            onPressed: _saveText,
            child: Text('ì €ì¥'),
          ),
        ),
      ],
    );
  }
}

8.4 ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ ì§€ì›

// ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥
class MarkdownPreview extends StatelessWidget {
  final String markdown;
  
  MarkdownPreview({required this.markdown});

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: EdgeInsets.all(16),
      child: SingleChildScrollView(
        child: _renderMarkdown(markdown),
      ),
    );
  }

  Widget _renderMarkdown(String text) {
    // ê°„ë‹¨í•œ ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ êµ¬í˜„
    List<Widget> widgets = [];
    List<String> lines = text.split('\n');
    
    for (String line in lines) {
      if (line.startsWith('# ')) {
        widgets.add(_buildHeader1(line.substring(2)));
      } else if (line.startsWith('## ')) {
        widgets.add(_buildHeader2(line.substring(3)));
      } else if (line.startsWith('### ')) {
        widgets.add(_buildHeader3(line.substring(4)));
      } else {
        widgets.add(_buildParagraph(line));
      }
    }
    
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: widgets,
    );
  }

  Widget _buildHeader1(String text) {
    return Padding(
      padding: EdgeInsets.symmetric(vertical: 8),
      child: Text(text, style: TextStyle(
        fontSize: 24,
        fontWeight: FontWeight.bold,
      )),
    );
  }

  Widget _buildHeader2(String text) {
    return Padding(
      padding: EdgeInsets.symmetric(vertical: 6),
      child: Text(text, style: TextStyle(
        fontSize: 20,
        fontWeight: FontWeight.bold,
      )),
    );
  }

  Widget _buildHeader3(String text) {
    return Padding(
      padding: EdgeInsets.symmetric(vertical: 4),
      child: Text(text, style: TextStyle(
        fontSize: 18,
        fontWeight: FontWeight.bold,
      )),
    );
  }

  Widget _buildParagraph(String text) {
    return Padding(
      padding: EdgeInsets.symmetric(vertical: 2),
      child: _parseInlineFormatting(text),
    );
  }

  Widget _parseInlineFormatting(String text) {
    // **êµµê²Œ**, *ê¸°ìš¸ì„*, __ë°‘ì¤„__, ~~ì·¨ì†Œì„ __ íŒŒì‹±
    List<TextSpan> spans = [];
    
    // ê°„ë‹¨í•œ íŒŒì‹± ë¡œì§ (ì‹¤ì œë¡œëŠ” ë” ë³µì¡í•œ ì •ê·œì‹ í•„ìš”)
    if (text.contains('**')) {
      // êµµê²Œ ì²˜ë¦¬
    } else if (text.contains('*')) {
      // ê¸°ìš¸ì„ ì²˜ë¦¬
    } else {
      spans.add(TextSpan(text: text));
    }
    
    return RichText(text: TextSpan(children: spans));
  }
}

================================================================================

9. ìŒì„± ë¶ë§ˆí¬ ì»´í¬ë„ŒíŠ¸

9.1 VoiceBookmark ë°ì´í„° ëª¨ë¸

// ë¶ë§ˆí¬ ë°ì´í„° í´ë˜ìŠ¤
class VoiceBookmark {
  final String id;
  final String audioFileId;
  final Duration timestamp;
  final String? title;
  final String? description;
  final DateTime createdAt;

  VoiceBookmark({
    required this.id,
    required this.audioFileId,
    required this.timestamp,
    this.title,
    this.description,
    required this.createdAt,
  });

  String get formattedTime {
    int minutes = timestamp.inMinutes;
    int seconds = timestamp.inSeconds % 60;
    return '${minutes.toString().padLeft(2, '0')}:${seconds.toString().padLeft(2, '0')}';
  }

  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'audioFileId': audioFileId,
      'timestamp': timestamp.inSeconds,
      'title': title,
      'description': description,
      'createdAt': createdAt.toIso8601String(),
    };
  }

  factory VoiceBookmark.fromJson(Map<String, dynamic> json) {
    return VoiceBookmark(
      id: json['id'],
      audioFileId: json['audioFileId'],
      timestamp: Duration(seconds: json['timestamp']),
      title: json['title'],
      description: json['description'],
      createdAt: DateTime.parse(json['createdAt']),
    );
  }
}

9.2 BookmarkButton ì»´í¬ë„ŒíŠ¸

// ë¶ë§ˆí¬ ì¶”ê°€/ê´€ë¦¬ ë²„íŠ¼
class BookmarkButton extends StatefulWidget {
  final String audioFileId;
  final Duration currentPosition;
  final bool isRecording;
  final List<VoiceBookmark> bookmarks;
  final Function(VoiceBookmark) onBookmarkAdded;
  final Function(String) onBookmarkDeleted;
  final Function(Duration) onBookmarkTapped;

  BookmarkButton({
    required this.audioFileId,
    required this.currentPosition,
    this.isRecording = false,
    required this.bookmarks,
    required this.onBookmarkAdded,
    required this.onBookmarkDeleted,
    required this.onBookmarkTapped,
  });

  @override
  _BookmarkButtonState createState() => _BookmarkButtonState();
}

class _BookmarkButtonState extends State<BookmarkButton> {
  void _addBookmark() {
    final bookmark = VoiceBookmark(
      id: DateTime.now().millisecondsSinceEpoch.toString(),
      audioFileId: widget.audioFileId,
      timestamp: widget.currentPosition,
      createdAt: DateTime.now(),
    );
    
    widget.onBookmarkAdded(bookmark);
    
    // ë¶ë§ˆí¬ ì¶”ê°€ ì™„ë£Œ í”¼ë“œë°±
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text('ë¶ë§ˆí¬ê°€ ${bookmark.formattedTime}ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤'),
        duration: Duration(seconds: 2),
      ),
    );
  }

  void _showBookmarkDialog() {
    showDialog(
      context: context,
      builder: (context) => BookmarkListDialog(
        bookmarks: widget.bookmarks,
        onBookmarkSelected: widget.onBookmarkTapped,
        onBookmarkDeleted: widget.onBookmarkDeleted,
        onBookmarkEdited: _editBookmark,
      ),
    );
  }

  void _editBookmark(VoiceBookmark bookmark) {
    showDialog(
      context: context,
      builder: (context) => BookmarkEditDialog(
        bookmark: bookmark,
        onSaved: (editedBookmark) {
          // ë¶ë§ˆí¬ ìˆ˜ì • ë¡œì§
        },
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    return Row(
      mainAxisSize: MainAxisSize.min,
      children: [
        // ë¶ë§ˆí¬ ì¶”ê°€ ë²„íŠ¼
        if (widget.isRecording) ...[
          Tooltip(
            message: 'í˜„ì¬ ìœ„ì¹˜ì— ë¶ë§ˆí¬ ì¶”ê°€',
            child: InkWell(
              onTap: _addBookmark,
              borderRadius: BorderRadius.circular(4),
              child: Container(
                padding: EdgeInsets.all(4),
                child: Text('ğŸ”–+', style: TextStyle(fontSize: 16)),
              ),
            ),
          ),
        ] else ...[
          Tooltip(
            message: 'ë¶ë§ˆí¬ ê´€ë¦¬',
            child: InkWell(
              onTap: _showBookmarkDialog,
              borderRadius: BorderRadius.circular(4),
              child: Container(
                padding: EdgeInsets.all(4),
                child: Text('ğŸ”–', style: TextStyle(fontSize: 16)),
              ),
            ),
          ),
        ],
      ],
    );
  }
}

9.3 BookmarkChips ì»´í¬ë„ŒíŠ¸

// ë¶ë§ˆí¬ ì¹© ëª©ë¡ í‘œì‹œ
class BookmarkChips extends StatelessWidget {
  final List<VoiceBookmark> bookmarks;
  final Function(Duration) onBookmarkTapped;
  final Function(String) onBookmarkDeleted;

  BookmarkChips({
    required this.bookmarks,
    required this.onBookmarkTapped,
    required this.onBookmarkDeleted,
  });

  @override
  Widget build(BuildContext context) {
    if (bookmarks.isEmpty) {
      return SizedBox.shrink();
    }

    return Container(
      height: 32,
      child: ListView.builder(
        scrollDirection: Axis.horizontal,
        itemCount: bookmarks.length,
        itemBuilder: (context, index) {
          final bookmark = bookmarks[index];
          return Padding(
            padding: EdgeInsets.only(right: 4),
            child: GestureDetector(
              onTap: () => onBookmarkTapped(bookmark.timestamp),
              onLongPress: () => _showBookmarkMenu(context, bookmark),
              child: Container(
                padding: EdgeInsets.symmetric(horizontal: 6, vertical: 2),
                decoration: BoxDecoration(
                  color: Colors.blue.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(12),
                  border: Border.all(color: Colors.blue.withOpacity(0.3)),
                ),
                child: Row(
                  mainAxisSize: MainAxisSize.min,
                  children: [
                    Text('ğŸ“', style: TextStyle(fontSize: 12)),
                    SizedBox(width: 2),
                    Text(
                      bookmark.formattedTime,
                      style: TextStyle(
                        fontSize: 11,
                        color: Colors.blue.shade700,
                        fontWeight: FontWeight.w500,
                      ),
                    ),
                  ],
                ),
              ),
            ),
          );
        },
      ),
    );
  }

  void _showBookmarkMenu(BuildContext context, VoiceBookmark bookmark) {
    showModalBottomSheet(
      context: context,
      builder: (context) => Container(
        padding: EdgeInsets.all(16),
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            Text(
              'ë¶ë§ˆí¬ ${bookmark.formattedTime}',
              style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
            ),
            SizedBox(height: 16),
            ListTile(
              leading: Icon(Icons.play_arrow),
              title: Text('í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™'),
              onTap: () {
                Navigator.pop(context);
                onBookmarkTapped(bookmark.timestamp);
              },
            ),
            ListTile(
              leading: Icon(Icons.edit),
              title: Text('ë¶ë§ˆí¬ í¸ì§‘'),
              onTap: () {
                Navigator.pop(context);
                // í¸ì§‘ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
              },
            ),
            ListTile(
              leading: Icon(Icons.delete, color: Colors.red),
              title: Text('ë¶ë§ˆí¬ ì‚­ì œ', style: TextStyle(color: Colors.red)),
              onTap: () {
                Navigator.pop(context);
                onBookmarkDeleted(bookmark.id);
              },
            ),
          ],
        ),
      ),
    );
  }
}

9.4 BookmarkListDialog ëŒ€í™”ìƒì

// ë¶ë§ˆí¬ ëª©ë¡ í‘œì‹œ ë‹¤ì´ì–¼ë¡œê·¸
class BookmarkListDialog extends StatelessWidget {
  final List<VoiceBookmark> bookmarks;
  final Function(Duration) onBookmarkSelected;
  final Function(String) onBookmarkDeleted;
  final Function(VoiceBookmark) onBookmarkEdited;

  BookmarkListDialog({
    required this.bookmarks,
    required this.onBookmarkSelected,
    required this.onBookmarkDeleted,
    required this.onBookmarkEdited,
  });

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: Text('ë¶ë§ˆí¬ ëª©ë¡ (${bookmarks.length}ê°œ)'),
      content: Container(
        width: double.maxFinite,
        height: 300,
        child: bookmarks.isEmpty
            ? Center(child: Text('ì €ì¥ëœ ë¶ë§ˆí¬ê°€ ì—†ìŠµë‹ˆë‹¤'))
            : ListView.builder(
                itemCount: bookmarks.length,
                itemBuilder: (context, index) {
                  final bookmark = bookmarks[index];
                  return ListTile(
                    leading: Text('ğŸ“', style: TextStyle(fontSize: 16)),
                    title: Text(bookmark.formattedTime),
                    subtitle: bookmark.title != null 
                        ? Text(bookmark.title!) 
                        : Text('ë¶ë§ˆí¬ ${index + 1}'),
                    trailing: Row(
                      mainAxisSize: MainAxisSize.min,
                      children: [
                        IconButton(
                          icon: Icon(Icons.edit, size: 18),
                          onPressed: () => onBookmarkEdited(bookmark),
                        ),
                        IconButton(
                          icon: Icon(Icons.delete, size: 18, color: Colors.red),
                          onPressed: () => onBookmarkDeleted(bookmark.id),
                        ),
                      ],
                    ),
                    onTap: () {
                      Navigator.pop(context);
                      onBookmarkSelected(bookmark.timestamp);
                    },
                  );
                },
              ),
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: Text('ë‹«ê¸°'),
        ),
      ],
    );
  }
}

9.5 BookmarkEditDialog í¸ì§‘ ëŒ€í™”ìƒì

// ë¶ë§ˆí¬ í¸ì§‘ ë‹¤ì´ì–¼ë¡œê·¸
class BookmarkEditDialog extends StatefulWidget {
  final VoiceBookmark bookmark;
  final Function(VoiceBookmark) onSaved;

  BookmarkEditDialog({required this.bookmark, required this.onSaved});

  @override
  _BookmarkEditDialogState createState() => _BookmarkEditDialogState();
}

class _BookmarkEditDialogState extends State<BookmarkEditDialog> {
  late TextEditingController _titleController;
  late TextEditingController _descriptionController;

  @override
  void initState() {
    super.initState();
    _titleController = TextEditingController(text: widget.bookmark.title ?? '');
    _descriptionController = TextEditingController(text: widget.bookmark.description ?? '');
  }

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: Text('ë¶ë§ˆí¬ í¸ì§‘ (${widget.bookmark.formattedTime})'),
      content: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          TextField(
            controller: _titleController,
            decoration: InputDecoration(
              labelText: 'ì œëª©',
              hintText: 'ë¶ë§ˆí¬ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”',
            ),
          ),
          SizedBox(height: 16),
          TextField(
            controller: _descriptionController,
            decoration: InputDecoration(
              labelText: 'ì„¤ëª…',
              hintText: 'ë¶ë§ˆí¬ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”',
            ),
            maxLines: 3,
          ),
        ],
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: Text('ì·¨ì†Œ'),
        ),
        ElevatedButton(
          onPressed: () {
            final editedBookmark = VoiceBookmark(
              id: widget.bookmark.id,
              audioFileId: widget.bookmark.audioFileId,
              timestamp: widget.bookmark.timestamp,
              title: _titleController.text.trim().isEmpty 
                  ? null 
                  : _titleController.text.trim(),
              description: _descriptionController.text.trim().isEmpty 
                  ? null 
                  : _descriptionController.text.trim(),
              createdAt: widget.bookmark.createdAt,
            );
            
            widget.onSaved(editedBookmark);
            Navigator.pop(context);
          },
          child: Text('ì €ì¥'),
        ),
      ],
    );
  }

  @override
  void dispose() {
    _titleController.dispose();
    _descriptionController.dispose();
    super.dispose();
  }
}

9.6 ë“£ê¸° í™”ë©´ì—ì„œ ë¶ë§ˆí¬ ê¸°ëŠ¥ ì‚¬ìš©

// ê¸°ì¡´ ë“£ê¸° í™”ë©´ ìˆ˜ì • (ListeningScreen)
class ListeningScreen extends StatefulWidget {
  // ... ê¸°ì¡´ ì½”ë“œ

  List<VoiceBookmark> _bookmarks = []; // ë¶ë§ˆí¬ ëª©ë¡
  Duration _currentPosition = Duration.zero; // í˜„ì¬ ì¬ìƒ ìœ„ì¹˜

  Widget _buildAudioItem(AudioFile audioFile) {
    final audioBookmarks = _bookmarks
        .where((bookmark) => bookmark.audioFileId == audioFile.id)
        .toList();

    return Container(
      margin: EdgeInsets.all(8),
      padding: EdgeInsets.all(12),
      decoration: BoxDecoration(
        border: Border.all(color: Colors.grey.shade300),
        borderRadius: BorderRadius.circular(8),
      ),
      child: Column(
        children: [
          // íŒŒì¼ ì •ë³´ ë° ì»¨íŠ¸ë¡¤
          Row(
            children: [
              Text('ğŸ¤ ${audioFile.name}'),
              Spacer(),
              Text('[${audioFile.duration}]'),
              SizedBox(width: 8),
              Icon(Icons.delete_outline),
            ],
          ),
          
          // í”„ë¡œê·¸ë ˆìŠ¤ ë°”
          SizedBox(height: 8),
          _buildProgressBar(audioFile),
          
          // ì¬ìƒ ì»¨íŠ¸ë¡¤ ë° ë¶ë§ˆí¬ ë²„íŠ¼
          SizedBox(height: 8),
          Row(
            children: [
              _buildSpeedButtons(),
              Spacer(),
              _buildPlayButton(audioFile),
              SizedBox(width: 8),
              BookmarkButton(
                audioFileId: audioFile.id,
                currentPosition: _currentPosition,
                isRecording: audioFile.isRecording,
                bookmarks: audioBookmarks,
                onBookmarkAdded: _addBookmark,
                onBookmarkDeleted: _deleteBookmark,
                onBookmarkTapped: _jumpToBookmark,
              ),
            ],
          ),
          
          // ë¶ë§ˆí¬ ì¹© ëª©ë¡
          if (audioBookmarks.isNotEmpty) ...[
            SizedBox(height: 8),
            Row(
              children: [
                Text('ë¶ë§ˆí¬: ', style: TextStyle(fontSize: 12)),
                Expanded(
                  child: BookmarkChips(
                    bookmarks: audioBookmarks,
                    onBookmarkTapped: _jumpToBookmark,
                    onBookmarkDeleted: _deleteBookmark,
                  ),
                ),
              ],
            ),
          ],
        ],
      ),
    );
  }

  void _addBookmark(VoiceBookmark bookmark) {
    setState(() {
      _bookmarks.add(bookmark);
    });
    _saveBookmarks(); // ë¡œì»¬ ì €ì¥
  }

  void _deleteBookmark(String bookmarkId) {
    setState(() {
      _bookmarks.removeWhere((bookmark) => bookmark.id == bookmarkId);
    });
    _saveBookmarks(); // ë¡œì»¬ ì €ì¥
  }

  void _jumpToBookmark(Duration timestamp) {
    // ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ì—ì„œ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™
    _audioPlayer.seek(timestamp);
    setState(() {
      _currentPosition = timestamp;
    });
  }

  void _saveBookmarks() {
    // SharedPreferences ë˜ëŠ” ë¡œì»¬ DBì— ë¶ë§ˆí¬ ì €ì¥
  }

  void _loadBookmarks() {
    // SharedPreferences ë˜ëŠ” ë¡œì»¬ DBì—ì„œ ë¶ë§ˆí¬ ë¡œë“œ
  }
}

================================================================================

10. êµ­ì œí™” ì§€ì› UI ì»´í¬ë„ŒíŠ¸

10.1 ì§€ì› ì–¸ì–´ ë°ì´í„° ëª¨ë¸

// ì–¸ì–´ ë°ì´í„° í´ë˜ìŠ¤
class SupportedLanguage {
  final String code;
  final String name;
  final String nativeName;
  final String flag;
  final bool isRTL;

  const SupportedLanguage({
    required this.code,
    required this.name,
    required this.nativeName,
    required this.flag,
    this.isRTL = false,
  });
}

// ì§€ì›í•˜ëŠ” 30ê°œ ì–¸ì–´ ëª©ë¡ (ì‚¬ìš©ì ì œê³µ ìˆœì„œ)
class LanguageData {
  static const List<SupportedLanguage> supportedLanguages = [
    // 1. ì˜ì–´ (ê¸°ë³¸ê°’)
    SupportedLanguage(code: 'en', name: 'English', nativeName: 'English', flag: 'ğŸ‡ºğŸ‡¸'),
    // 2. ì¤‘êµ­ì–´
    SupportedLanguage(code: 'zh', name: 'Chinese', nativeName: 'ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³'),
    // 3. íŒë””ì–´
    SupportedLanguage(code: 'hi', name: 'Hindi', nativeName: 'à¤¹à¤¿à¤¨à¥à¤¦à¥€', flag: 'ğŸ‡®ğŸ‡³'),
    // 4. ìŠ¤í˜ì¸ì–´
    SupportedLanguage(code: 'es', name: 'Spanish', nativeName: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸'),
    // 5. í”„ë‘ìŠ¤ì–´
    SupportedLanguage(code: 'fr', name: 'French', nativeName: 'FranÃ§ais', flag: 'ğŸ‡«ğŸ‡·'),
    // 6. ì•„ëì–´
    SupportedLanguage(code: 'ar', name: 'Arabic', nativeName: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', flag: 'ğŸ‡¸ğŸ‡¦', isRTL: true),
    // 7. ë²µê³¨ì–´
    SupportedLanguage(code: 'bn', name: 'Bengali', nativeName: 'à¦¬à¦¾à¦‚à¦²à¦¾', flag: 'ğŸ‡§ğŸ‡©'),
    // 8. ëŸ¬ì‹œì•„ì–´
    SupportedLanguage(code: 'ru', name: 'Russian', nativeName: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹', flag: 'ğŸ‡·ğŸ‡º'),
    // 9. í¬ë¥´íˆ¬ê°ˆì–´
    SupportedLanguage(code: 'pt', name: 'Portuguese', nativeName: 'PortuguÃªs', flag: 'ğŸ‡µğŸ‡¹'),
    // 10. ìš°ë¥´ë‘ì–´
    SupportedLanguage(code: 'ur', name: 'Urdu', nativeName: 'Ø§Ø±Ø¯Ùˆ', flag: 'ğŸ‡µğŸ‡°', isRTL: true),
    // 11. ì¸ë„ë„¤ì‹œì•„ì–´
    SupportedLanguage(code: 'id', name: 'Indonesian', nativeName: 'Bahasa Indonesia', flag: 'ğŸ‡®ğŸ‡©'),
    // 12. ë…ì¼ì–´
    SupportedLanguage(code: 'de', name: 'German', nativeName: 'Deutsch', flag: 'ğŸ‡©ğŸ‡ª'),
    // 13. ì¼ë³¸ì–´
    SupportedLanguage(code: 'ja', name: 'Japanese', nativeName: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ'),
    // 14. ìŠ¤ì™€íë¦¬ì–´
    SupportedLanguage(code: 'sw', name: 'Swahili', nativeName: 'Kiswahili', flag: 'ğŸ‡°ğŸ‡ª'),
    // 15. ë§ˆë¼í‹°ì–´
    SupportedLanguage(code: 'mr', name: 'Marathi', nativeName: 'à¤®à¤°à¤¾à¤ à¥€', flag: 'ğŸ‡®ğŸ‡³'),
    // 16. í…”ë£¨êµ¬ì–´
    SupportedLanguage(code: 'te', name: 'Telugu', nativeName: 'à°¤à±†à°²à±à°—à±', flag: 'ğŸ‡®ğŸ‡³'),
    // 17. í„°í‚¤ì–´
    SupportedLanguage(code: 'tr', name: 'Turkish', nativeName: 'TÃ¼rkÃ§e', flag: 'ğŸ‡¹ğŸ‡·'),
    // 18. íƒ€ë°€ì–´
    SupportedLanguage(code: 'ta', name: 'Tamil', nativeName: 'à®¤à®®à®¿à®´à¯', flag: 'ğŸ‡®ğŸ‡³'),
    // 19. í˜ë¥´ì‹œì•„ì–´
    SupportedLanguage(code: 'fa', name: 'Farsi', nativeName: 'ÙØ§Ø±Ø³ÛŒ', flag: 'ğŸ‡®ğŸ‡·', isRTL: true),
    // 20. í•œêµ­ì–´
    SupportedLanguage(code: 'ko', name: 'Korean', nativeName: 'í•œêµ­ì–´', flag: 'ğŸ‡°ğŸ‡·'),
    // 21. ìš°í¬ë¼ì´ë‚˜ì–´
    SupportedLanguage(code: 'uk', name: 'Ukrainian', nativeName: 'Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°', flag: 'ğŸ‡ºğŸ‡¦'),
    // 22. ì´íƒˆë¦¬ì•„ì–´
    SupportedLanguage(code: 'it', name: 'Italian', nativeName: 'Italiano', flag: 'ğŸ‡®ğŸ‡¹'),
    // 23. íƒ€ê°ˆë¡œê·¸ì–´ (Filipino)
    SupportedLanguage(code: 'tl', name: 'Filipino', nativeName: 'Filipino', flag: 'ğŸ‡µğŸ‡­'),
    // 24. í´ë€ë“œì–´
    SupportedLanguage(code: 'pl', name: 'Polish', nativeName: 'Polski', flag: 'ğŸ‡µğŸ‡±'),
    // 25. íŒŒìŠˆí† ì–´
    SupportedLanguage(code: 'ps', name: 'Pashto', nativeName: 'Ù¾ÚšØªÙˆ', flag: 'ğŸ‡¦ğŸ‡«', isRTL: true),
    // 26. ë§ë ˆì´ì–´
    SupportedLanguage(code: 'ms', name: 'Malay', nativeName: 'Bahasa Melayu', flag: 'ğŸ‡²ğŸ‡¾'),
    // 27. ë¡œë§ˆë‹ˆì•„ì–´
    SupportedLanguage(code: 'ro', name: 'Romanian', nativeName: 'RomÃ¢nÄƒ', flag: 'ğŸ‡·ğŸ‡´'),
    // 28. ë„¤ëœë€ë“œì–´
    SupportedLanguage(code: 'nl', name: 'Dutch', nativeName: 'Nederlands', flag: 'ğŸ‡³ğŸ‡±'),
    // 29. í•˜ìš°ì‚¬ì–´
    SupportedLanguage(code: 'ha', name: 'Hausa', nativeName: 'Hausa', flag: 'ğŸ‡³ğŸ‡¬'),
    // 30. íƒ€ì´ì–´ (Thai)
    SupportedLanguage(code: 'th', name: 'Thai', nativeName: 'à¹„à¸—à¸¢', flag: 'ğŸ‡¹ğŸ‡­'),
  ];

  static SupportedLanguage getLanguageByCode(String code) {
    return supportedLanguages.firstWhere(
      (lang) => lang.code == code,
      orElse: () => supportedLanguages.first, // ê¸°ë³¸ê°’: ì˜ì–´
    );
  }

  static String getDisplayName(String code) {
    final language = getLanguageByCode(code);
    return '${language.flag} ${language.nativeName}';
  }
}

10.2 LanguageSelectionScreen í™”ë©´

// ì–¸ì–´ ì„ íƒ í™”ë©´
class LanguageSelectionScreen extends StatefulWidget {
  final String currentLanguage;
  final Function(String) onLanguageSelected;

  LanguageSelectionScreen({
    required this.currentLanguage,
    required this.onLanguageSelected,
  });

  @override
  _LanguageSelectionScreenState createState() => _LanguageSelectionScreenState();
}

class _LanguageSelectionScreenState extends State<LanguageSelectionScreen> {
  String _selectedLanguage = '';

  @override
  void initState() {
    super.initState();
    _selectedLanguage = widget.currentLanguage;
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('ì–¸ì–´ ì„ íƒ'),
        elevation: 0,
        backgroundColor: Theme.of(context).primaryColor,
        foregroundColor: Colors.white,
      ),
      body: Column(
        children: [
          // í—¤ë” ì„¹ì…˜
          Container(
            width: double.infinity,
            padding: EdgeInsets.all(24),
            color: Theme.of(context).primaryColor.withOpacity(0.1),
            child: Column(
              children: [
                Icon(
                  Icons.language,
                  size: 48,
                  color: Theme.of(context).primaryColor,
                ),
                SizedBox(height: 16),
                Text(
                  'ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”',
                  style: TextStyle(
                    fontSize: 18,
                    fontWeight: FontWeight.w600,
                    color: Theme.of(context).primaryColor,
                  ),
                ),
                SizedBox(height: 8),
                Text(
                  'ì•± ì „ì²´ ì–¸ì–´ê°€ ë³€ê²½ë©ë‹ˆë‹¤',
                  style: TextStyle(
                    fontSize: 14,
                    color: Colors.grey.shade600,
                  ),
                ),
              ],
            ),
          ),

          // ì–¸ì–´ ëª©ë¡
          Expanded(
            child: ListView.builder(
              padding: EdgeInsets.symmetric(vertical: 8),
              itemCount: LanguageData.supportedLanguages.length,
              itemBuilder: (context, index) {
                final language = LanguageData.supportedLanguages[index];
                return LanguageCard(
                  language: language,
                  isSelected: _selectedLanguage == language.code,
                  onTap: () => _selectLanguage(language.code),
                );
              },
            ),
          ),

          // ì ìš© ë²„íŠ¼
          Container(
            width: double.infinity,
            padding: EdgeInsets.all(16),
            child: ElevatedButton(
              onPressed: _selectedLanguage == widget.currentLanguage 
                  ? null 
                  : _applyLanguage,
              style: ElevatedButton.styleFrom(
                padding: EdgeInsets.symmetric(vertical: 16),
                shape: RoundedRectangleBorder(
                  borderRadius: BorderRadius.circular(12),
                ),
              ),
              child: Text(
                'ì ìš©í•˜ê¸°',
                style: TextStyle(fontSize: 16, fontWeight: FontWeight.w600),
              ),
            ),
          ),
        ],
      ),
    );
  }

  void _selectLanguage(String languageCode) {
    setState(() {
      _selectedLanguage = languageCode;
    });
  }

  void _applyLanguage() {
    widget.onLanguageSelected(_selectedLanguage);
    Navigator.pop(context);
    
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text('ì–¸ì–´ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤'),
        duration: Duration(seconds: 2),
      ),
    );
  }
}

10.3 LanguageCard ì»´í¬ë„ŒíŠ¸

// ì–¸ì–´ ì„ íƒ ì¹´ë“œ
class LanguageCard extends StatelessWidget {
  final SupportedLanguage language;
  final bool isSelected;
  final VoidCallback onTap;

  LanguageCard({
    required this.language,
    required this.isSelected,
    required this.onTap,
  });

  @override
  Widget build(BuildContext context) {
    return Container(
      margin: EdgeInsets.symmetric(horizontal: 16, vertical: 4),
      decoration: BoxDecoration(
        borderRadius: BorderRadius.circular(12),
        border: Border.all(
          color: isSelected 
              ? Theme.of(context).primaryColor 
              : Colors.grey.shade300,
          width: isSelected ? 2 : 1,
        ),
        color: isSelected 
            ? Theme.of(context).primaryColor.withOpacity(0.1)
            : Colors.white,
      ),
      child: InkWell(
        onTap: onTap,
        borderRadius: BorderRadius.circular(12),
        child: Padding(
          padding: EdgeInsets.all(16),
          child: Row(
            children: [
              // êµ­ê¸° ì´ëª¨ì§€
              Text(
                language.flag,
                style: TextStyle(fontSize: 24),
              ),
              SizedBox(width: 16),
              
              // ì–¸ì–´ ì •ë³´
              Expanded(
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      language.nativeName,
                      style: TextStyle(
                        fontSize: 16,
                        fontWeight: FontWeight.w600,
                        color: isSelected 
                            ? Theme.of(context).primaryColor
                            : Colors.black87,
                      ),
                    ),
                    SizedBox(height: 2),
                    Text(
                      language.name,
                      style: TextStyle(
                        fontSize: 14,
                        color: Colors.grey.shade600,
                      ),
                    ),
                  ],
                ),
              ),
              
              // ì„ íƒ í‘œì‹œ
              if (isSelected) ...[
                Icon(
                  Icons.check_circle,
                  color: Theme.of(context).primaryColor,
                  size: 24,
                ),
              ],
            ],
          ),
        ),
      ),
    );
  }
}

10.4 LanguageSettingsCard ì„¤ì • ì¹´ë“œ

// ì„¤ì • í™”ë©´ì˜ ì–¸ì–´ ì„¤ì • ì¹´ë“œ
class LanguageSettingsCard extends StatelessWidget {
  final String currentLanguage;
  final Function(String) onLanguageChanged;

  LanguageSettingsCard({
    required this.currentLanguage,
    required this.onLanguageChanged,
  });

  @override
  Widget build(BuildContext context) {
    final currentLang = LanguageData.getLanguageByCode(currentLanguage);
    
    return Card(
      margin: EdgeInsets.symmetric(horizontal: 16, vertical: 8),
      elevation: 2,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(12),
      ),
      child: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // ì„¹ì…˜ ì œëª©
            Row(
              children: [
                Icon(
                  Icons.language,
                  color: Theme.of(context).primaryColor,
                  size: 20,
                ),
                SizedBox(width: 8),
                Text(
                  'ì–¸ì–´ ì„¤ì •',
                  style: TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.w600,
                  ),
                ),
              ],
            ),
            SizedBox(height: 16),
            
            // í˜„ì¬ ì–¸ì–´ í‘œì‹œ
            Container(
              padding: EdgeInsets.all(12),
              decoration: BoxDecoration(
                color: Theme.of(context).primaryColor.withOpacity(0.1),
                borderRadius: BorderRadius.circular(8),
              ),
              child: Row(
                children: [
                  Text(
                    currentLang.flag,
                    style: TextStyle(fontSize: 20),
                  ),
                  SizedBox(width: 12),
                  Expanded(
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        Text(
                          'í˜„ì¬ ì–¸ì–´',
                          style: TextStyle(
                            fontSize: 12,
                            color: Colors.grey.shade600,
                          ),
                        ),
                        Text(
                          currentLang.nativeName,
                          style: TextStyle(
                            fontSize: 16,
                            fontWeight: FontWeight.w500,
                          ),
                        ),
                      ],
                    ),
                  ),
                  Icon(
                    Icons.check_circle,
                    color: Theme.of(context).primaryColor,
                    size: 20,
                  ),
                ],
              ),
            ),
            
            SizedBox(height: 12),
            Divider(),
            
            // ì–¸ì–´ ë³€ê²½ ë²„íŠ¼
            ListTile(
              contentPadding: EdgeInsets.zero,
              leading: Icon(
                Icons.edit,
                color: Theme.of(context).primaryColor,
              ),
              title: Text('ì–¸ì–´ ë³€ê²½'),
              subtitle: Text('30ê°œ ì–¸ì–´ ì¤‘ ì„ íƒ'),
              trailing: Icon(Icons.arrow_forward_ios, size: 16),
              onTap: () => _showLanguageSelection(context),
            ),
          ],
        ),
      ),
    );
  }

  void _showLanguageSelection(BuildContext context) {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => LanguageSelectionScreen(
          currentLanguage: currentLanguage,
          onLanguageSelected: onLanguageChanged,
        ),
      ),
    );
  }
}

10.5 FirstTimeLanguageSelector ìµœì´ˆ ì‹¤í–‰ ì–¸ì–´ ì„ íƒ

// ì•± ìµœì´ˆ ì‹¤í–‰ ì‹œ ì–¸ì–´ ì„ íƒ í™”ë©´
class FirstTimeLanguageSelector extends StatefulWidget {
  final Function(String) onLanguageSelected;

  FirstTimeLanguageSelector({required this.onLanguageSelected});

  @override
  _FirstTimeLanguageSelectorState createState() => _FirstTimeLanguageSelectorState();
}

class _FirstTimeLanguageSelectorState extends State<FirstTimeLanguageSelector>
    with SingleTickerProviderStateMixin {
  String _selectedLanguage = 'ko'; // ê¸°ë³¸ê°’: í•œêµ­ì–´
  late AnimationController _animationController;
  late Animation<double> _fadeAnimation;

  @override
  void initState() {
    super.initState();
    _animationController = AnimationController(
      duration: Duration(milliseconds: 800),
      vsync: this,
    );
    _fadeAnimation = Tween<double>(begin: 0.0, end: 1.0).animate(
      CurvedAnimation(parent: _animationController, curve: Curves.easeIn),
    );
    _animationController.forward();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: FadeTransition(
        opacity: _fadeAnimation,
        child: Container(
          decoration: BoxDecoration(
            gradient: LinearGradient(
              begin: Alignment.topCenter,
              end: Alignment.bottomCenter,
              colors: [
                Theme.of(context).primaryColor.withOpacity(0.1),
                Colors.white,
              ],
            ),
          ),
          child: SafeArea(
            child: Column(
              children: [
                SizedBox(height: 40),
                
                // ì›°ì»´ í—¤ë”
                Container(
                  padding: EdgeInsets.symmetric(horizontal: 32),
                  child: Column(
                    children: [
                      Icon(
                        Icons.language,
                        size: 64,
                        color: Theme.of(context).primaryColor,
                      ),
                      SizedBox(height: 24),
                      Text(
                        'ë¦¬íŠ¼ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!',
                        style: TextStyle(
                          fontSize: 24,
                          fontWeight: FontWeight.bold,
                          color: Theme.of(context).primaryColor,
                        ),
                        textAlign: TextAlign.center,
                      ),
                      SizedBox(height: 16),
                      Text(
                        'ì‚¬ìš©í•  ì–¸ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”\nì–¸ì œë“ ì§€ ì„¤ì •ì—ì„œ ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤',
                        style: TextStyle(
                          fontSize: 16,
                          color: Colors.grey.shade600,
                          height: 1.5,
                        ),
                        textAlign: TextAlign.center,
                      ),
                    ],
                  ),
                ),
                
                SizedBox(height: 32),
                
                // ì–¸ì–´ ì„ íƒ ê·¸ë¦¬ë“œ
                Expanded(
                  child: Container(
                    padding: EdgeInsets.symmetric(horizontal: 24),
                    child: GridView.builder(
                      gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
                        crossAxisCount: 2,
                        childAspectRatio: 2.5,
                        crossAxisSpacing: 16,
                        mainAxisSpacing: 16,
                      ),
                      itemCount: LanguageData.supportedLanguages.length,
                      itemBuilder: (context, index) {
                        final language = LanguageData.supportedLanguages[index];
                        return _buildLanguageGridItem(language);
                      },
                    ),
                  ),
                ),
                
                // ì‹œì‘í•˜ê¸° ë²„íŠ¼
                Container(
                  width: double.infinity,
                  padding: EdgeInsets.all(24),
                  child: ElevatedButton(
                    onPressed: _startApp,
                    style: ElevatedButton.styleFrom(
                      padding: EdgeInsets.symmetric(vertical: 18),
                      shape: RoundedRectangleBorder(
                        borderRadius: BorderRadius.circular(12),
                      ),
                      elevation: 4,
                    ),
                    child: Text(
                      'ì‹œì‘í•˜ê¸°',
                      style: TextStyle(
                        fontSize: 18,
                        fontWeight: FontWeight.w600,
                      ),
                    ),
                  ),
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }

  Widget _buildLanguageGridItem(SupportedLanguage language) {
    final isSelected = _selectedLanguage == language.code;
    
    return GestureDetector(
      onTap: () => setState(() => _selectedLanguage = language.code),
      child: AnimatedContainer(
        duration: Duration(milliseconds: 200),
        decoration: BoxDecoration(
          borderRadius: BorderRadius.circular(12),
          border: Border.all(
            color: isSelected 
                ? Theme.of(context).primaryColor 
                : Colors.grey.shade300,
            width: isSelected ? 2 : 1,
          ),
          color: isSelected 
              ? Theme.of(context).primaryColor.withOpacity(0.1)
              : Colors.white,
          boxShadow: isSelected 
              ? [BoxShadow(
                  color: Theme.of(context).primaryColor.withOpacity(0.3),
                  blurRadius: 8,
                  offset: Offset(0, 2),
                )]
              : [BoxShadow(
                  color: Colors.grey.withOpacity(0.1),
                  blurRadius: 4,
                  offset: Offset(0, 2),
                )],
        ),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Text(
              language.flag,
              style: TextStyle(fontSize: 24),
            ),
            SizedBox(height: 4),
            Text(
              language.nativeName,
              style: TextStyle(
                fontSize: 12,
                fontWeight: isSelected ? FontWeight.w600 : FontWeight.normal,
                color: isSelected 
                    ? Theme.of(context).primaryColor
                    : Colors.black87,
              ),
              textAlign: TextAlign.center,
            ),
          ],
        ),
      ),
    );
  }

  void _startApp() {
    widget.onLanguageSelected(_selectedLanguage);
  }

  @override
  void dispose() {
    _animationController.dispose();
    super.dispose();
  }
}

10.6 ì„¤ì • í™”ë©´ì—ì„œ êµ­ì œí™” UI ì‚¬ìš©

// ê¸°ì¡´ ì„¤ì • í™”ë©´ì— ì–¸ì–´ ì„¤ì • ì¶”ê°€
class SettingsScreen extends StatefulWidget {
  // ... ê¸°ì¡´ ì½”ë“œ

  String _currentLanguage = 'ko'; // í˜„ì¬ ì–¸ì–´

  Widget _buildSettingsContent() {
    return Column(
      children: [
        // ê¸°ì¡´ ì„¤ì •ë“¤...
        
        // í…Œë§ˆ ì„¤ì • ì¹´ë“œ
        ThemeSettingsCard(
          currentTheme: _currentTheme,
          onThemeChanged: _applyTheme,
        ),
        
        // ì–¸ì–´ ì„¤ì • ì¹´ë“œ
        LanguageSettingsCard(
          currentLanguage: _currentLanguage,
          onLanguageChanged: _changeLanguage,
        ),
        
        // ê¸°íƒ€ ì„¤ì •ë“¤...
      ],
    );
  }

  void _changeLanguage(String languageCode) {
    setState(() {
      _currentLanguage = languageCode;
    });
    
    // ì•± ì „ì²´ ì–¸ì–´ ë³€ê²½
    _applyLanguageChange(languageCode);
    
    // SharedPreferencesì— ì €ì¥
    _saveLanguagePreference(languageCode);
  }

  void _applyLanguageChange(String languageCode) {
    // Locale ë³€ê²½ ë¡œì§
    final newLocale = Locale(languageCode);
    // Providerë‚˜ ë‹¤ë¥¸ ìƒíƒœ ê´€ë¦¬ë¥¼ í†µí•´ ì•± ì „ì²´ì— ë°˜ì˜
  }

  void _saveLanguagePreference(String languageCode) async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.setString('selected_language', languageCode);
  }
}

================================================================================

11. íŒŒì¼ ë³€í™˜ í”„ë¡œì„¸ìŠ¤ UI ì»´í¬ë„ŒíŠ¸

11.1 íŒŒì¼ ë³€í™˜ ë°ì´í„° ëª¨ë¸

// ë³€í™˜ ì‘ì—… ìƒíƒœ ì—´ê±°í˜•
enum ConversionStatus {
  pending,      // ëŒ€ê¸° ì¤‘
  processing,   // ë³€í™˜ ì¤‘
  completed,    // ì™„ë£Œ
  failed,       // ì‹¤íŒ¨
  cancelled,    // ì·¨ì†Œë¨
}

// ì§€ì›í•˜ëŠ” íŒŒì¼ í˜•ì‹
enum FileFormat {
  // ì˜¤ë””ì˜¤ í˜•ì‹
  mp3, m4a, wav, aac, flac,
  
  // í…ìŠ¤íŠ¸ í˜•ì‹
  txt, md, docx, pdf,
  
  // ì´ë¯¸ì§€ í˜•ì‹
  png, jpg, jpeg, pdf_image,
}

// íŒŒì¼ ë³€í™˜ ì‘ì—… í´ë˜ìŠ¤
class ConversionTask {
  final String id;
  final String sourceFilePath;
  final String sourceFileName;
  final FileFormat sourceFormat;
  final FileFormat targetFormat;
  final ConversionStatus status;
  final double progress;
  final String? errorMessage;
  final DateTime createdAt;
  final DateTime? completedAt;
  final String? outputFilePath;

  ConversionTask({
    required this.id,
    required this.sourceFilePath,
    required this.sourceFileName,
    required this.sourceFormat,
    required this.targetFormat,
    this.status = ConversionStatus.pending,
    this.progress = 0.0,
    this.errorMessage,
    required this.createdAt,
    this.completedAt,
    this.outputFilePath,
  });

  String get statusText {
    switch (status) {
      case ConversionStatus.pending:
        return 'ëŒ€ê¸° ì¤‘';
      case ConversionStatus.processing:
        return 'ë³€í™˜ ì¤‘';
      case ConversionStatus.completed:
        return 'ì™„ë£Œ';
      case ConversionStatus.failed:
        return 'ì‹¤íŒ¨';
      case ConversionStatus.cancelled:
        return 'ì·¨ì†Œë¨';
    }
  }

  Color get statusColor {
    switch (status) {
      case ConversionStatus.pending:
        return Colors.orange;
      case ConversionStatus.processing:
        return Colors.blue;
      case ConversionStatus.completed:
        return Colors.green;
      case ConversionStatus.failed:
        return Colors.red;
      case ConversionStatus.cancelled:
        return Colors.grey;
    }
  }

  IconData get statusIcon {
    switch (status) {
      case ConversionStatus.pending:
        return Icons.schedule;
      case ConversionStatus.processing:
        return Icons.sync;
      case ConversionStatus.completed:
        return Icons.check_circle;
      case ConversionStatus.failed:
        return Icons.error;
      case ConversionStatus.cancelled:
        return Icons.cancel;
    }
  }
}

11.2 FileConversionDialog ë³€í™˜ ì„ íƒ ëŒ€í™”ìƒì

// íŒŒì¼ ë³€í™˜ í˜•ì‹ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸
class FileConversionDialog extends StatefulWidget {
  final String filePath;
  final FileFormat currentFormat;
  final Function(FileFormat) onFormatSelected;

  FileConversionDialog({
    required this.filePath,
    required this.currentFormat,
    required this.onFormatSelected,
  });

  @override
  _FileConversionDialogState createState() => _FileConversionDialogState();
}

class _FileConversionDialogState extends State<FileConversionDialog> {
  FileFormat? _selectedFormat;
  List<FileFormat> _availableFormats = [];

  @override
  void initState() {
    super.initState();
    _availableFormats = _getAvailableFormats(widget.currentFormat);
    if (_availableFormats.isNotEmpty) {
      _selectedFormat = _availableFormats.first;
    }
  }

  List<FileFormat> _getAvailableFormats(FileFormat currentFormat) {
    switch (currentFormat) {
      case FileFormat.m4a:
      case FileFormat.wav:
      case FileFormat.aac:
        return [FileFormat.mp3, FileFormat.wav, FileFormat.m4a, FileFormat.flac];
      case FileFormat.txt:
      case FileFormat.md:
        return [FileFormat.txt, FileFormat.md, FileFormat.docx, FileFormat.pdf];
      case FileFormat.png:
      case FileFormat.jpg:
        return [FileFormat.png, FileFormat.jpg, FileFormat.jpeg, FileFormat.pdf_image];
      default:
        return [];
    }
  }

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: Row(
        children: [
          Icon(Icons.transform, color: Theme.of(context).primaryColor),
          SizedBox(width: 8),
          Text('íŒŒì¼ ë³€í™˜'),
        ],
      ),
      content: Container(
        width: double.maxFinite,
        child: Column(
          mainAxisSize: MainAxisSize.min,
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // ì›ë³¸ íŒŒì¼ ì •ë³´
            Container(
              padding: EdgeInsets.all(12),
              decoration: BoxDecoration(
                color: Colors.grey.shade100,
                borderRadius: BorderRadius.circular(8),
              ),
              child: Row(
                children: [
                  Icon(_getFileIcon(widget.currentFormat), size: 20),
                  SizedBox(width: 8),
                  Expanded(
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        Text(
                          'ì›ë³¸ íŒŒì¼',
                          style: TextStyle(fontSize: 12, color: Colors.grey.shade600),
                        ),
                        Text(
                          path.basename(widget.filePath),
                          style: TextStyle(fontWeight: FontWeight.w500),
                        ),
                      ],
                    ),
                  ),
                ],
              ),
            ),
            
            SizedBox(height: 16),
            
            // ë³€í™˜ í™”ì‚´í‘œ
            Center(
              child: Icon(
                Icons.arrow_downward,
                color: Theme.of(context).primaryColor,
                size: 24,
              ),
            ),
            
            SizedBox(height: 16),
            
            // ë³€í™˜ í˜•ì‹ ì„ íƒ
            Text(
              'ë³€í™˜í•  í˜•ì‹ì„ ì„ íƒí•˜ì„¸ìš”',
              style: TextStyle(fontWeight: FontWeight.w500),
            ),
            SizedBox(height: 12),
            
            Container(
              height: 200,
              child: ListView.builder(
                itemCount: _availableFormats.length,
                itemBuilder: (context, index) {
                  final format = _availableFormats[index];
                  final isSelected = _selectedFormat == format;
                  
                  return Container(
                    margin: EdgeInsets.symmetric(vertical: 2),
                    decoration: BoxDecoration(
                      borderRadius: BorderRadius.circular(8),
                      border: Border.all(
                        color: isSelected 
                            ? Theme.of(context).primaryColor 
                            : Colors.grey.shade300,
                      ),
                      color: isSelected 
                          ? Theme.of(context).primaryColor.withOpacity(0.1)
                          : Colors.white,
                    ),
                    child: ListTile(
                      leading: Icon(
                        _getFileIcon(format),
                        color: isSelected 
                            ? Theme.of(context).primaryColor 
                            : Colors.grey.shade600,
                      ),
                      title: Text(
                        _getFormatName(format),
                        style: TextStyle(
                          fontWeight: isSelected ? FontWeight.w600 : FontWeight.normal,
                          color: isSelected 
                              ? Theme.of(context).primaryColor 
                              : Colors.black87,
                        ),
                      ),
                      subtitle: Text(_getFormatDescription(format)),
                      trailing: isSelected 
                          ? Icon(
                              Icons.check_circle,
                              color: Theme.of(context).primaryColor,
                            )
                          : null,
                      onTap: () => setState(() => _selectedFormat = format),
                    ),
                  );
                },
              ),
            ),
          ],
        ),
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: Text('ì·¨ì†Œ'),
        ),
        ElevatedButton(
          onPressed: _selectedFormat != null ? _startConversion : null,
          child: Text('ë³€í™˜ ì‹œì‘'),
        ),
      ],
    );
  }

  void _startConversion() {
    if (_selectedFormat != null) {
      widget.onFormatSelected(_selectedFormat!);
      Navigator.pop(context);
    }
  }

  IconData _getFileIcon(FileFormat format) {
    switch (format) {
      case FileFormat.mp3:
      case FileFormat.m4a:
      case FileFormat.wav:
      case FileFormat.aac:
      case FileFormat.flac:
        return Icons.audiotrack;
      case FileFormat.txt:
      case FileFormat.md:
        return Icons.description;
      case FileFormat.docx:
      case FileFormat.pdf:
        return Icons.picture_as_pdf;
      case FileFormat.png:
      case FileFormat.jpg:
      case FileFormat.jpeg:
      case FileFormat.pdf_image:
        return Icons.image;
    }
  }

  String _getFormatName(FileFormat format) {
    return format.toString().split('.').last.toUpperCase();
  }

  String _getFormatDescription(FileFormat format) {
    switch (format) {
      case FileFormat.mp3:
        return 'ì¼ë°˜ì ì¸ ì˜¤ë””ì˜¤ í˜•ì‹ (ì••ì¶•)';
      case FileFormat.m4a:
        return 'Apple ì˜¤ë””ì˜¤ í˜•ì‹ (ê³ í’ˆì§ˆ)';
      case FileFormat.wav:
        return 'ë¬´ì†ì‹¤ ì˜¤ë””ì˜¤ í˜•ì‹ (í° ìš©ëŸ‰)';
      case FileFormat.flac:
        return 'ë¬´ì†ì‹¤ ì••ì¶• ì˜¤ë””ì˜¤';
      case FileFormat.txt:
        return 'ì¼ë°˜ í…ìŠ¤íŠ¸ íŒŒì¼';
      case FileFormat.md:
        return 'ë§ˆí¬ë‹¤ìš´ í˜•ì‹';
      case FileFormat.docx:
        return 'Word ë¬¸ì„œ í˜•ì‹';
      case FileFormat.pdf:
        return 'PDF ë¬¸ì„œ í˜•ì‹';
      case FileFormat.png:
        return 'ë¬´ì†ì‹¤ ì´ë¯¸ì§€ (íˆ¬ëª…ë„ ì§€ì›)';
      case FileFormat.jpg:
        return 'ì¼ë°˜ì ì¸ ì´ë¯¸ì§€ í˜•ì‹';
      default:
        return '';
    }
  }
}

11.3 ConversionProgressDialog ì§„í–‰ë¥  ëŒ€í™”ìƒì

// ë³€í™˜ ì§„í–‰ë¥  í‘œì‹œ ë‹¤ì´ì–¼ë¡œê·¸
class ConversionProgressDialog extends StatefulWidget {
  final ConversionTask task;
  final VoidCallback? onCancel;

  ConversionProgressDialog({
    required this.task,
    this.onCancel,
  });

  @override
  _ConversionProgressDialogState createState() => _ConversionProgressDialogState();
}

class _ConversionProgressDialogState extends State<ConversionProgressDialog>
    with SingleTickerProviderStateMixin {
  late AnimationController _animationController;
  late Animation<double> _rotationAnimation;

  @override
  void initState() {
    super.initState();
    _animationController = AnimationController(
      duration: Duration(seconds: 2),
      vsync: this,
    )..repeat();
    _rotationAnimation = Tween<double>(begin: 0, end: 1).animate(_animationController);
  }

  @override
  Widget build(BuildContext context) {
    return WillPopScope(
      onWillPop: () async => false, // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
      child: AlertDialog(
        title: Text('íŒŒì¼ ë³€í™˜ ì¤‘'),
        content: Container(
          width: double.maxFinite,
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              // íŒŒì¼ ì •ë³´
              Container(
                padding: EdgeInsets.all(16),
                decoration: BoxDecoration(
                  color: Colors.grey.shade50,
                  borderRadius: BorderRadius.circular(12),
                ),
                child: Column(
                  children: [
                    Row(
                      children: [
                        Icon(Icons.folder_open, color: Colors.grey.shade600),
                        SizedBox(width: 8),
                        Expanded(
                          child: Text(
                            widget.task.sourceFileName,
                            style: TextStyle(fontWeight: FontWeight.w500),
                          ),
                        ),
                      ],
                    ),
                    SizedBox(height: 8),
                    Row(
                      mainAxisAlignment: MainAxisAlignment.center,
                      children: [
                        Text(
                          _getFormatName(widget.task.sourceFormat),
                          style: TextStyle(
                            fontSize: 12,
                            color: Colors.grey.shade600,
                          ),
                        ),
                        SizedBox(width: 8),
                        AnimatedBuilder(
                          animation: _rotationAnimation,
                          builder: (context, child) {
                            return Transform.rotate(
                              angle: _rotationAnimation.value * 2 * math.pi,
                              child: Icon(
                                Icons.sync,
                                size: 16,
                                color: Theme.of(context).primaryColor,
                              ),
                            );
                          },
                        ),
                        SizedBox(width: 8),
                        Text(
                          _getFormatName(widget.task.targetFormat),
                          style: TextStyle(
                            fontSize: 12,
                            color: Colors.grey.shade600,
                          ),
                        ),
                      ],
                    ),
                  ],
                ),
              ),
              
              SizedBox(height: 24),
              
              // ì§„í–‰ë¥  í‘œì‹œ
              Column(
                children: [
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      Text(
                        'ì§„í–‰ë¥ ',
                        style: TextStyle(fontWeight: FontWeight.w500),
                      ),
                      Text(
                        '${(widget.task.progress * 100).toInt()}%',
                        style: TextStyle(
                          fontWeight: FontWeight.w600,
                          color: Theme.of(context).primaryColor,
                        ),
                      ),
                    ],
                  ),
                  SizedBox(height: 8),
                  LinearProgressIndicator(
                    value: widget.task.progress,
                    backgroundColor: Colors.grey.shade300,
                    valueColor: AlwaysStoppedAnimation<Color>(
                      Theme.of(context).primaryColor,
                    ),
                  ),
                ],
              ),
              
              SizedBox(height: 16),
              
              // ìƒíƒœ ë©”ì‹œì§€
              Row(
                children: [
                  Icon(
                    widget.task.statusIcon,
                    size: 16,
                    color: widget.task.statusColor,
                  ),
                  SizedBox(width: 8),
                  Text(
                    widget.task.statusText,
                    style: TextStyle(
                      color: widget.task.statusColor,
                      fontWeight: FontWeight.w500,
                    ),
                  ),
                ],
              ),
            ],
          ),
        ),
        actions: [
          if (widget.task.status == ConversionStatus.processing && widget.onCancel != null)
            TextButton(
              onPressed: widget.onCancel,
              child: Text('ì·¨ì†Œ'),
            ),
          if (widget.task.status == ConversionStatus.completed ||
              widget.task.status == ConversionStatus.failed)
            ElevatedButton(
              onPressed: () => Navigator.pop(context),
              child: Text('í™•ì¸'),
            ),
        ],
      ),
    );
  }

  String _getFormatName(FileFormat format) {
    return format.toString().split('.').last.toUpperCase();
  }

  @override
  void dispose() {
    _animationController.dispose();
    super.dispose();
  }
}

11.4 ConversionHistoryScreen ë³€í™˜ ì´ë ¥ í™”ë©´

// íŒŒì¼ ë³€í™˜ ì´ë ¥ í™”ë©´
class ConversionHistoryScreen extends StatefulWidget {
  @override
  _ConversionHistoryScreenState createState() => _ConversionHistoryScreenState();
}

class _ConversionHistoryScreenState extends State<ConversionHistoryScreen> {
  List<ConversionTask> _conversionHistory = [];
  bool _isLoading = true;

  @override
  void initState() {
    super.initState();
    _loadConversionHistory();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('ë³€í™˜ ì´ë ¥'),
        backgroundColor: Theme.of(context).primaryColor,
        foregroundColor: Colors.white,
        actions: [
          IconButton(
            icon: Icon(Icons.clear_all),
            onPressed: _showClearHistoryDialog,
            tooltip: 'ì´ë ¥ ì‚­ì œ',
          ),
        ],
      ),
      body: _isLoading
          ? Center(child: CircularProgressIndicator())
          : _conversionHistory.isEmpty
              ? _buildEmptyState()
              : _buildHistoryList(),
    );
  }

  Widget _buildEmptyState() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.history,
            size: 64,
            color: Colors.grey.shade400,
          ),
          SizedBox(height: 16),
          Text(
            'ë³€í™˜ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤',
            style: TextStyle(
              fontSize: 18,
              color: Colors.grey.shade600,
            ),
          ),
          SizedBox(height: 8),
          Text(
            'íŒŒì¼ì„ ë³€í™˜í•˜ë©´ ì´ê³³ì— ê¸°ë¡ë©ë‹ˆë‹¤',
            style: TextStyle(
              fontSize: 14,
              color: Colors.grey.shade500,
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildHistoryList() {
    return ListView.builder(
      padding: EdgeInsets.all(16),
      itemCount: _conversionHistory.length,
      itemBuilder: (context, index) {
        final task = _conversionHistory[index];
        return ConversionHistoryCard(
          task: task,
          onRetry: () => _retryConversion(task),
          onDelete: () => _deleteConversionRecord(task),
          onShare: () => _shareConvertedFile(task),
        );
      },
    );
  }

  void _loadConversionHistory() {
    // SharedPreferences ë˜ëŠ” ë¡œì»¬ DBì—ì„œ ë³€í™˜ ì´ë ¥ ë¡œë“œ
    setState(() {
      _isLoading = false;
    });
  }

  void _retryConversion(ConversionTask task) {
    // ë³€í™˜ ì¬ì‹œë„ ë¡œì§
  }

  void _deleteConversionRecord(ConversionTask task) {
    setState(() {
      _conversionHistory.removeWhere((t) => t.id == task.id);
    });
  }

  void _shareConvertedFile(ConversionTask task) {
    if (task.status == ConversionStatus.completed && task.outputFilePath != null) {
      // íŒŒì¼ ê³µìœ  ë¡œì§
    }
  }

  void _showClearHistoryDialog() {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: Text('ì´ë ¥ ì‚­ì œ'),
        content: Text('ëª¨ë“  ë³€í™˜ ì´ë ¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: Text('ì·¨ì†Œ'),
          ),
          ElevatedButton(
            onPressed: () {
              setState(() {
                _conversionHistory.clear();
              });
              Navigator.pop(context);
            },
            style: ElevatedButton.styleFrom(backgroundColor: Colors.red),
            child: Text('ì‚­ì œ'),
          ),
        ],
      ),
    );
  }
}

11.5 ConversionHistoryCard ì´ë ¥ ì¹´ë“œ

// ë³€í™˜ ì´ë ¥ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
class ConversionHistoryCard extends StatelessWidget {
  final ConversionTask task;
  final VoidCallback? onRetry;
  final VoidCallback? onDelete;
  final VoidCallback? onShare;

  ConversionHistoryCard({
    required this.task,
    this.onRetry,
    this.onDelete,
    this.onShare,
  });

  @override
  Widget build(BuildContext context) {
    return Card(
      margin: EdgeInsets.only(bottom: 12),
      elevation: 2,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(12),
      ),
      child: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // í—¤ë”: íŒŒì¼ëª…ê³¼ ìƒíƒœ
            Row(
              children: [
                Expanded(
                  child: Text(
                    task.sourceFileName,
                    style: TextStyle(
                      fontSize: 16,
                      fontWeight: FontWeight.w600,
                    ),
                  ),
                ),
                Container(
                  padding: EdgeInsets.symmetric(horizontal: 8, vertical: 4),
                  decoration: BoxDecoration(
                    color: task.statusColor.withOpacity(0.1),
                    borderRadius: BorderRadius.circular(12),
                  ),
                  child: Row(
                    mainAxisSize: MainAxisSize.min,
                    children: [
                      Icon(
                        task.statusIcon,
                        size: 12,
                        color: task.statusColor,
                      ),
                      SizedBox(width: 4),
                      Text(
                        task.statusText,
                        style: TextStyle(
                          fontSize: 12,
                          color: task.statusColor,
                          fontWeight: FontWeight.w500,
                        ),
                      ),
                    ],
                  ),
                ),
              ],
            ),
            
            SizedBox(height: 12),
            
            // ë³€í™˜ ì •ë³´
            Row(
              children: [
                Icon(
                  _getFileIcon(task.sourceFormat),
                  size: 16,
                  color: Colors.grey.shade600,
                ),
                SizedBox(width: 4),
                Text(
                  _getFormatName(task.sourceFormat),
                  style: TextStyle(
                    fontSize: 12,
                    color: Colors.grey.shade600,
                  ),
                ),
                SizedBox(width: 8),
                Icon(
                  Icons.arrow_forward,
                  size: 12,
                  color: Colors.grey.shade600,
                ),
                SizedBox(width: 8),
                Icon(
                  _getFileIcon(task.targetFormat),
                  size: 16,
                  color: Colors.grey.shade600,
                ),
                SizedBox(width: 4),
                Text(
                  _getFormatName(task.targetFormat),
                  style: TextStyle(
                    fontSize: 12,
                    color: Colors.grey.shade600,
                  ),
                ),
                Spacer(),
                Text(
                  _formatDateTime(task.createdAt),
                  style: TextStyle(
                    fontSize: 12,
                    color: Colors.grey.shade500,
                  ),
                ),
              ],
            ),
            
            // ì§„í–‰ë¥  (ì§„í–‰ ì¤‘ì¸ ê²½ìš°)
            if (task.status == ConversionStatus.processing) ...[
              SizedBox(height: 12),
              Row(
                children: [
                  Expanded(
                    child: LinearProgressIndicator(
                      value: task.progress,
                      backgroundColor: Colors.grey.shade300,
                    ),
                  ),
                  SizedBox(width: 8),
                  Text(
                    '${(task.progress * 100).toInt()}%',
                    style: TextStyle(
                      fontSize: 12,
                      fontWeight: FontWeight.w500,
                    ),
                  ),
                ],
              ),
            ],
            
            // ì—ëŸ¬ ë©”ì‹œì§€ (ì‹¤íŒ¨í•œ ê²½ìš°)
            if (task.status == ConversionStatus.failed && task.errorMessage != null) ...[
              SizedBox(height: 8),
              Container(
                padding: EdgeInsets.all(8),
                decoration: BoxDecoration(
                  color: Colors.red.withOpacity(0.1),
                  borderRadius: BorderRadius.circular(8),
                ),
                child: Row(
                  children: [
                    Icon(
                      Icons.error_outline,
                      size: 16,
                      color: Colors.red,
                    ),
                    SizedBox(width: 8),
                    Expanded(
                      child: Text(
                        task.errorMessage!,
                        style: TextStyle(
                          fontSize: 12,
                          color: Colors.red.shade700,
                        ),
                      ),
                    ),
                  ],
                ),
              ),
            ],
            
            // ì•¡ì…˜ ë²„íŠ¼ë“¤
            SizedBox(height: 12),
            Row(
              children: [
                if (task.status == ConversionStatus.failed && onRetry != null)
                  OutlinedButton.icon(
                    onPressed: onRetry,
                    icon: Icon(Icons.refresh, size: 16),
                    label: Text('ì¬ì‹œë„'),
                    style: OutlinedButton.styleFrom(
                      minimumSize: Size(0, 32),
                    ),
                  ),
                if (task.status == ConversionStatus.completed && onShare != null) ...[
                  ElevatedButton.icon(
                    onPressed: onShare,
                    icon: Icon(Icons.share, size: 16),
                    label: Text('ê³µìœ '),
                    style: ElevatedButton.styleFrom(
                      minimumSize: Size(0, 32),
                    ),
                  ),
                  SizedBox(width: 8),
                ],
                Spacer(),
                if (onDelete != null)
                  IconButton(
                    onPressed: onDelete,
                    icon: Icon(Icons.delete_outline),
                    iconSize: 20,
                    color: Colors.grey.shade600,
                    tooltip: 'ì‚­ì œ',
                  ),
              ],
            ),
          ],
        ),
      ),
    );
  }

  IconData _getFileIcon(FileFormat format) {
    switch (format) {
      case FileFormat.mp3:
      case FileFormat.m4a:
      case FileFormat.wav:
      case FileFormat.aac:
      case FileFormat.flac:
        return Icons.audiotrack;
      case FileFormat.txt:
      case FileFormat.md:
        return Icons.description;
      case FileFormat.docx:
      case FileFormat.pdf:
        return Icons.picture_as_pdf;
      case FileFormat.png:
      case FileFormat.jpg:
      case FileFormat.jpeg:
      case FileFormat.pdf_image:
        return Icons.image;
    }
  }

  String _getFormatName(FileFormat format) {
    return format.toString().split('.').last.toUpperCase();
  }

  String _formatDateTime(DateTime dateTime) {
    return '${dateTime.month}/${dateTime.day} ${dateTime.hour}:${dateTime.minute.toString().padLeft(2, '0')}';
  }
}

11.6 íŒŒì¼ í•­ëª©ì— ë³€í™˜ ë²„íŠ¼ ì¶”ê°€

// ê¸°ì¡´ íŒŒì¼ í•­ëª©ì— ë³€í™˜ ê¸°ëŠ¥ ì¶”ê°€
class FileItemWidget extends StatelessWidget {
  final String filePath;
  final String fileName;
  final FileFormat fileFormat;
  final VoidCallback? onConvert;

  FileItemWidget({
    required this.filePath,
    required this.fileName,
    required this.fileFormat,
    this.onConvert,
  });

  @override
  Widget build(BuildContext context) {
    return ListTile(
      leading: Icon(_getFileIcon(fileFormat)),
      title: Text(fileName),
      subtitle: Text(_getFormatName(fileFormat)),
      trailing: Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          IconButton(
            icon: Icon(Icons.transform),
            onPressed: onConvert,
            tooltip: 'íŒŒì¼ ë³€í™˜',
          ),
          IconButton(
            icon: Icon(Icons.more_vert),
            onPressed: () => _showFileMenu(context),
          ),
        ],
      ),
    );
  }

  void _showFileMenu(BuildContext context) {
    showModalBottomSheet(
      context: context,
      builder: (context) => Container(
        padding: EdgeInsets.all(16),
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            ListTile(
              leading: Icon(Icons.transform),
              title: Text('íŒŒì¼ ë³€í™˜'),
              onTap: () {
                Navigator.pop(context);
                if (onConvert != null) onConvert!();
              },
            ),
            ListTile(
              leading: Icon(Icons.share),
              title: Text('ê³µìœ '),
              onTap: () => Navigator.pop(context),
            ),
            ListTile(
              leading: Icon(Icons.delete, color: Colors.red),
              title: Text('ì‚­ì œ', style: TextStyle(color: Colors.red)),
              onTap: () => Navigator.pop(context),
            ),
          ],
        ),
      ),
    );
  }

  IconData _getFileIcon(FileFormat format) {
    switch (format) {
      case FileFormat.mp3:
      case FileFormat.m4a:
      case FileFormat.wav:
      case FileFormat.aac:
      case FileFormat.flac:
        return Icons.audiotrack;
      case FileFormat.txt:
      case FileFormat.md:
        return Icons.description;
      case FileFormat.docx:
      case FileFormat.pdf:
        return Icons.picture_as_pdf;
      case FileFormat.png:
      case FileFormat.jpg:
      case FileFormat.jpeg:
      case FileFormat.pdf_image:
        return Icons.image;
    }
  }

  String _getFormatName(FileFormat format) {
    return format.toString().split('.').last.toUpperCase();
  }
}

================================================================================

12. ì™„ì „í•œ ì„¤ì • í™”ë©´ UI ì»´í¬ë„ŒíŠ¸

12.1 SettingsScreen ë©”ì¸ í™”ë©´

// ì™„ì „í•œ ì„¤ì • í™”ë©´
class SettingsScreen extends StatefulWidget {
  @override
  _SettingsScreenState createState() => _SettingsScreenState();
}

class _SettingsScreenState extends State<SettingsScreen> {
  // ì„¤ì • ìƒíƒœ ë³€ìˆ˜ë“¤
  String _currentTheme = 'classic_blue';
  String _currentLanguage = 'ko';
  String _startScreen = 'home';
  bool _notificationsEnabled = true;
  String _maxRecordingTime = '1hour';
  String _audioQuality = 'high';
  bool _autoPlay = false;
  String _storagePath = 'default';
  String _autoSaveInterval = '1min';
  String _defaultFont = 'system';
  bool _showWordCount = true;
  bool _spellCheck = true;
  String _penColor = 'black';
  String _penWidth = 'medium';
  String _paperType = 'plain';
  bool _palmRejection = true;
  bool _debugMode = false;
  
  // ì‚¬ìš©ëŸ‰ ë°ì´í„°
  int _currentNotes = 2;
  int _maxNotes = 3;
  int _currentFiles = 8;
  int _maxFiles = 15;
  bool _isPremiumUser = false;

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('ì„¤ì •'),
        backgroundColor: Theme.of(context).primaryColor,
        foregroundColor: Colors.white,
        actions: [
          IconButton(
            icon: Icon(Icons.search),
            onPressed: _showSettingsSearch,
            tooltip: 'ì„¤ì • ê²€ìƒ‰',
          ),
        ],
      ),
      body: SingleChildScrollView(
        padding: EdgeInsets.all(16),
        child: Column(
          children: [
            // ê³„ì • ë° êµ¬ë… ì„¹ì…˜
            AccountSubscriptionCard(
              isPremium: _isPremiumUser,
              currentNotes: _currentNotes,
              maxNotes: _maxNotes,
              currentFiles: _currentFiles,
              maxFiles: _maxFiles,
              onUpgrade: _showUpgradeDialog,
              onViewHistory: _showConversionHistory,
              onSyncStatus: _showSyncStatus,
            ),
            
            SizedBox(height: 16),
            
            // ì•± ì„¤ì • ì„¹ì…˜
            AppSettingsCard(
              currentTheme: _currentTheme,
              currentLanguage: _currentLanguage,
              startScreen: _startScreen,
              notificationsEnabled: _notificationsEnabled,
              onThemeChanged: (theme) => setState(() => _currentTheme = theme),
              onLanguageChanged: (language) => setState(() => _currentLanguage = language),
              onStartScreenChanged: (screen) => setState(() => _startScreen = screen),
              onNotificationsToggled: (enabled) => setState(() => _notificationsEnabled = enabled),
            ),
            
            SizedBox(height: 16),
            
            // ë“£ê¸° ì„¤ì • ì„¹ì…˜
            ListeningSettingsCard(
              maxRecordingTime: _maxRecordingTime,
              audioQuality: _audioQuality,
              autoPlay: _autoPlay,
              storagePath: _storagePath,
              onMaxTimeChanged: (time) => setState(() => _maxRecordingTime = time),
              onQualityChanged: (quality) => setState(() => _audioQuality = quality),
              onAutoPlayToggled: (enabled) => setState(() => _autoPlay = enabled),
              onStoragePathChanged: (path) => setState(() => _storagePath = path),
            ),
            
            SizedBox(height: 16),
            
            // ì“°ê¸° ì„¤ì • ì„¹ì…˜
            WritingSettingsCard(
              autoSaveInterval: _autoSaveInterval,
              defaultFont: _defaultFont,
              showWordCount: _showWordCount,
              spellCheck: _spellCheck,
              onAutoSaveChanged: (interval) => setState(() => _autoSaveInterval = interval),
              onFontChanged: (font) => setState(() => _defaultFont = font),
              onWordCountToggled: (enabled) => setState(() => _showWordCount = enabled),
              onSpellCheckToggled: (enabled) => setState(() => _spellCheck = enabled),
            ),
            
            SizedBox(height: 16),
            
            // í•„ê¸° ì„¤ì • ì„¹ì…˜
            HandwritingSettingsCard(
              penColor: _penColor,
              penWidth: _penWidth,
              paperType: _paperType,
              palmRejection: _palmRejection,
              onPenColorChanged: (color) => setState(() => _penColor = color),
              onPenWidthChanged: (width) => setState(() => _penWidth = width),
              onPaperTypeChanged: (type) => setState(() => _paperType = type),
              onPalmRejectionToggled: (enabled) => setState(() => _palmRejection = enabled),
            ),
            
            SizedBox(height: 16),
            
            // ë°ì´í„° ë° ê°œì¸ì •ë³´ ì„¹ì…˜
            DataPrivacyCard(
              onExportData: _exportUserData,
              onDeleteAllData: _showDeleteAllDataDialog,
              onShowPrivacyPolicy: _showPrivacyPolicy,
              onShowTerms: _showTermsOfService,
            ),
            
            SizedBox(height: 16),
            
            // ê³ ê¸‰ ì„¤ì • ì„¹ì…˜
            AdvancedSettingsCard(
              debugMode: _debugMode,
              appVersion: '1.0.0',
              onDebugModeToggled: (enabled) => setState(() => _debugMode = enabled),
              onShowAppInfo: _showAppInfo,
              onContactSupport: _contactSupport,
              onRateApp: _rateApp,
            ),
            
            SizedBox(height: 32),
          ],
        ),
      ),
    );
  }

  void _showSettingsSearch() {
    showSearch(
      context: context,
      delegate: SettingsSearchDelegate(),
    );
  }

  void _showUpgradeDialog() {
    showDialog(
      context: context,
      builder: (context) => PremiumUpgradeDialog(),
    );
  }

  void _showConversionHistory() {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => ConversionHistoryScreen()),
    );
  }

  void _showSyncStatus() {
    showDialog(
      context: context,
      builder: (context) => SyncStatusDialog(),
    );
  }

  void _exportUserData() async {
    // ì‚¬ìš©ì ë°ì´í„° ë‚´ë³´ë‚´ê¸° ë¡œì§
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('ë°ì´í„° ë‚´ë³´ë‚´ê¸°ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤')),
    );
  }

  void _showDeleteAllDataDialog() {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: Text('ëª¨ë“  ë°ì´í„° ì‚­ì œ'),
        content: Text('ëª¨ë“  ë¦¬íŠ¼, íŒŒì¼, ì„¤ì •ì´ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤.\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: Text('ì·¨ì†Œ'),
          ),
          ElevatedButton(
            onPressed: () {
              Navigator.pop(context);
              _deleteAllUserData();
            },
            style: ElevatedButton.styleFrom(backgroundColor: Colors.red),
            child: Text('ì‚­ì œ'),
          ),
        ],
      ),
    );
  }

  void _deleteAllUserData() {
    // ëª¨ë“  ë°ì´í„° ì‚­ì œ ë¡œì§
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤')),
    );
  }

  void _showPrivacyPolicy() {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => PrivacyPolicyScreen()),
    );
  }

  void _showTermsOfService() {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => TermsOfServiceScreen()),
    );
  }

  void _showAppInfo() {
    showDialog(
      context: context,
      builder: (context) => AppInfoDialog(),
    );
  }

  void _contactSupport() {
    // ê³ ê° ì§€ì› ì—°ê²° ë¡œì§
  }

  void _rateApp() {
    // ì•± í‰ê°€ ë¡œì§
  }
}

12.2 AccountSubscriptionCard ê³„ì • ë° êµ¬ë… ì¹´ë“œ

// ê³„ì • ë° êµ¬ë… ì •ë³´ ì¹´ë“œ
class AccountSubscriptionCard extends StatelessWidget {
  final bool isPremium;
  final int currentNotes;
  final int maxNotes;
  final int currentFiles;
  final int maxFiles;
  final VoidCallback onUpgrade;
  final VoidCallback onViewHistory;
  final VoidCallback onSyncStatus;

  AccountSubscriptionCard({
    required this.isPremium,
    required this.currentNotes,
    required this.maxNotes,
    required this.currentFiles,
    required this.maxFiles,
    required this.onUpgrade,
    required this.onViewHistory,
    required this.onSyncStatus,
  });

  @override
  Widget build(BuildContext context) {
    return Card(
      elevation: 2,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
      child: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // ì„¹ì…˜ ì œëª©
            Row(
              children: [
                Icon(Icons.account_circle, color: Theme.of(context).primaryColor),
                SizedBox(width: 8),
                Text(
                  'ê³„ì • ë° êµ¬ë…',
                  style: TextStyle(fontSize: 16, fontWeight: FontWeight.w600),
                ),
              ],
            ),
            SizedBox(height: 16),
            
            // ì‚¬ìš©ì íƒ€ì… í‘œì‹œ
            Container(
              padding: EdgeInsets.all(12),
              decoration: BoxDecoration(
                color: isPremium 
                    ? Colors.amber.withOpacity(0.1)
                    : Colors.grey.withOpacity(0.1),
                borderRadius: BorderRadius.circular(8),
              ),
              child: Row(
                children: [
                  Icon(
                    isPremium ? Icons.star : Icons.person,
                    color: isPremium ? Colors.amber : Colors.grey.shade600,
                  ),
                  SizedBox(width: 8),
                  Text(
                    isPremium ? 'í”„ë¦¬ë¯¸ì—„ ì‚¬ìš©ì' : 'ë¬´ë£Œ ì‚¬ìš©ì',
                    style: TextStyle(
                      fontSize: 16,
                      fontWeight: FontWeight.w600,
                      color: isPremium ? Colors.amber.shade700 : Colors.grey.shade700,
                    ),
                  ),
                ],
              ),
            ),
            
            SizedBox(height: 12),
            
            // ì‚¬ìš©ëŸ‰ í‘œì‹œ (ë¬´ë£Œ ì‚¬ìš©ìë§Œ)
            if (!isPremium) ...[
              Row(
                children: [
                  Icon(Icons.bar_chart, size: 16, color: Colors.grey.shade600),
                  SizedBox(width: 4),
                  Text(
                    'í†µê³„: $currentNotesê°œ ë¦¬íŠ¼, $currentFilesê°œ íŒŒì¼',
                    style: TextStyle(fontSize: 14, color: Colors.grey.shade600),
                  ),
                ],
              ),
              SizedBox(height: 8),
              
              // ì‚¬ìš©ëŸ‰ í”„ë¡œê·¸ë ˆìŠ¤ ë°”
              Column(
                children: [
                  Row(
                    children: [
                      Text('ë¦¬íŠ¼: ', style: TextStyle(fontSize: 12)),
                      Expanded(
                        child: LinearProgressIndicator(
                          value: currentNotes > 0 ? 1.0 : 0.0,
                          backgroundColor: Colors.grey.shade300,
                        ),
                      ),
                      SizedBox(width: 8),
                      Text('$currentNotesê°œ', style: TextStyle(fontSize: 12)),
                    ],
                  ),
                  SizedBox(height: 4),
                  Row(
                    children: [
                      Text('íŒŒì¼: ', style: TextStyle(fontSize: 12)),
                      Expanded(
                        child: LinearProgressIndicator(
                          value: currentFiles > 0 ? 1.0 : 0.0,
                          backgroundColor: Colors.grey.shade300,
                        ),
                      ),
                      SizedBox(width: 8),
                      Text('$currentFilesê°œ', style: TextStyle(fontSize: 12)),
                    ],
                  ),
                ],
              ),
              
              SizedBox(height: 12),
            ],
            
            // ì•¡ì…˜ ë²„íŠ¼ë“¤
            Row(
              children: [
                if (!isPremium)
                  Expanded(
                    child: ElevatedButton.icon(
                      onPressed: onUpgrade,
                      icon: Icon(Icons.star, size: 16),
                      label: Text('í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ'),
                      style: ElevatedButton.styleFrom(
                        backgroundColor: Colors.amber,
                        foregroundColor: Colors.white,
                      ),
                    ),
                  ),
                if (!isPremium) SizedBox(width: 8),
                Expanded(
                  child: OutlinedButton.icon(
                    onPressed: onViewHistory,
                    icon: Icon(Icons.history, size: 16),
                    label: Text('ë³€í™˜ ì´ë ¥'),
                  ),
                ),
                SizedBox(width: 8),
                Expanded(
                  child: OutlinedButton.icon(
                    onPressed: onSyncStatus,
                    icon: Icon(Icons.cloud_sync, size: 16),
                    label: Text('ë™ê¸°í™”'),
                  ),
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }
}

12.3 AppSettingsCard ì•± ì„¤ì • ì¹´ë“œ

// ì•± ì„¤ì • ì¹´ë“œ
class AppSettingsCard extends StatelessWidget {
  final String currentTheme;
  final String currentLanguage;
  final String startScreen;
  final bool notificationsEnabled;
  final Function(String) onThemeChanged;
  final Function(String) onLanguageChanged;
  final Function(String) onStartScreenChanged;
  final Function(bool) onNotificationsToggled;

  AppSettingsCard({
    required this.currentTheme,
    required this.currentLanguage,
    required this.startScreen,
    required this.notificationsEnabled,
    required this.onThemeChanged,
    required this.onLanguageChanged,
    required this.onStartScreenChanged,
    required this.onNotificationsToggled,
  });

  @override
  Widget build(BuildContext context) {
    return Card(
      elevation: 2,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
      child: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // ì„¹ì…˜ ì œëª©
            Row(
              children: [
                Icon(Icons.settings, color: Theme.of(context).primaryColor),
                SizedBox(width: 8),
                Text(
                  'ì•± ì„¤ì •',
                  style: TextStyle(fontSize: 16, fontWeight: FontWeight.w600),
                ),
              ],
            ),
            SizedBox(height: 16),
            
            // í…Œë§ˆ ì„¤ì •
            SettingsListTile(
              leading: Icon(Icons.palette),
              title: 'í…Œë§ˆ',
              subtitle: _getThemeName(currentTheme),
              trailing: Icon(Icons.arrow_forward_ios, size: 16),
              onTap: () => _showThemeSelection(context),
            ),
            
            Divider(),
            
            // ì–¸ì–´ ì„¤ì •
            SettingsListTile(
              leading: Icon(Icons.language),
              title: 'ì–¸ì–´',
              subtitle: _getLanguageName(currentLanguage),
              trailing: Icon(Icons.arrow_forward_ios, size: 16),
              onTap: () => _showLanguageSelection(context),
            ),
            
            Divider(),
            
            // ì‹œì‘ í™”ë©´ ì„¤ì •
            SettingsListTile(
              leading: Icon(Icons.home),
              title: 'ì‹œì‘ í™”ë©´',
              subtitle: _getStartScreenName(startScreen),
              trailing: Icon(Icons.arrow_forward_ios, size: 16),
              onTap: () => _showStartScreenSelection(context),
            ),
            
            Divider(),
            
            // ì•Œë¦¼ ì„¤ì •
            SettingsListTile(
              leading: Icon(Icons.notifications),
              title: 'ì•Œë¦¼ ì„¤ì •',
              subtitle: notificationsEnabled ? 'ì‚¬ìš©í•¨' : 'ì‚¬ìš© ì•ˆí•¨',
              trailing: Switch(
                value: notificationsEnabled,
                onChanged: onNotificationsToggled,
              ),
              onTap: () => _showNotificationSettings(context),
            ),
          ],
        ),
      ),
    );
  }

  String _getThemeName(String theme) {
    switch (theme) {
      case 'classic_blue': return 'Classic Blue';
      case 'dark_mode': return 'Dark Mode';
      case 'nature_green': return 'Nature Green';
      case 'sunset_orange': return 'Sunset Orange';
      case 'monochrome_grey': return 'Monochrome Grey';
      default: return 'Classic Blue';
    }
  }

  String _getLanguageName(String language) {
    return LanguageData.getDisplayName(language);
  }

  String _getStartScreenName(String screen) {
    switch (screen) {
      case 'home': return 'í™ˆ';
      case 'listening': return 'ë“£ê¸°';
      case 'writing': return 'ì“°ê¸°';
      default: return 'í™ˆ';
    }
  }

  void _showThemeSelection(BuildContext context) {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => ThemeSelectionScreen(
          currentTheme: currentTheme,
          onThemeSelected: onThemeChanged,
        ),
      ),
    );
  }

  void _showLanguageSelection(BuildContext context) {
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => LanguageSelectionScreen(
          currentLanguage: currentLanguage,
          onLanguageSelected: onLanguageChanged,
        ),
      ),
    );
  }

  void _showStartScreenSelection(BuildContext context) {
    showDialog(
      context: context,
      builder: (context) => StartScreenSelectionDialog(
        currentScreen: startScreen,
        onScreenSelected: onStartScreenChanged,
      ),
    );
  }

  void _showNotificationSettings(BuildContext context) {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => NotificationSettingsScreen()),
    );
  }
}

12.4 SettingsListTile ê³µí†µ ì„¤ì • í•­ëª©

// ì„¤ì • ë¦¬ìŠ¤íŠ¸ íƒ€ì¼ ê³µí†µ ì»´í¬ë„ŒíŠ¸
class SettingsListTile extends StatelessWidget {
  final Widget leading;
  final String title;
  final String? subtitle;
  final Widget? trailing;
  final VoidCallback? onTap;

  SettingsListTile({
    required this.leading,
    required this.title,
    this.subtitle,
    this.trailing,
    this.onTap,
  });

  @override
  Widget build(BuildContext context) {
    return ListTile(
      contentPadding: EdgeInsets.zero,
      leading: leading,
      title: Text(
        title,
        style: TextStyle(fontWeight: FontWeight.w500),
      ),
      subtitle: subtitle != null
          ? Text(
              subtitle!,
              style: TextStyle(color: Colors.grey.shade600),
            )
          : null,
      trailing: trailing,
      onTap: onTap,
    );
  }
}

12.5 ì „ë¬¸í™”ëœ ì„¤ì • ì¹´ë“œë“¤

// ë“£ê¸° ì„¤ì • ì¹´ë“œ
class ListeningSettingsCard extends StatelessWidget {
  final String maxRecordingTime;
  final String audioQuality;
  final bool autoPlay;
  final String storagePath;
  final Function(String) onMaxTimeChanged;
  final Function(String) onQualityChanged;
  final Function(bool) onAutoPlayToggled;
  final Function(String) onStoragePathChanged;

  ListeningSettingsCard({
    required this.maxRecordingTime,
    required this.audioQuality,
    required this.autoPlay,
    required this.storagePath,
    required this.onMaxTimeChanged,
    required this.onQualityChanged,
    required this.onAutoPlayToggled,
    required this.onStoragePathChanged,
  });

  @override
  Widget build(BuildContext context) {
    return SettingsCard(
      title: 'ë“£ê¸° ì„¤ì •',
      icon: Icons.mic,
      children: [
        SettingsListTile(
          leading: Icon(Icons.timer),
          title: 'ìµœëŒ€ ë“£ê¸° ì‹œê°„',
          subtitle: _getMaxTimeText(maxRecordingTime),
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
          onTap: () => _showMaxTimeSelection(context),
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.high_quality),
          title: 'ì˜¤ë””ì˜¤ í’ˆì§ˆ',
          subtitle: _getQualityText(audioQuality),
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
          onTap: () => _showQualitySelection(context),
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.autorenew),
          title: 'ìë™ ì¬ìƒ',
          subtitle: autoPlay ? 'ì‚¬ìš©í•¨' : 'ì‚¬ìš© ì•ˆí•¨',
          trailing: Switch(
            value: autoPlay,
            onChanged: onAutoPlayToggled,
          ),
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.folder),
          title: 'ì €ì¥ ìœ„ì¹˜',
          subtitle: _getStoragePathText(storagePath),
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
          onTap: () => _showStoragePathSelection(context),
        ),
      ],
    );
  }

  String _getMaxTimeText(String time) {
    switch (time) {
      case '30min': return '30ë¶„';
      case '1hour': return '1ì‹œê°„';
      case '2hour': return '2ì‹œê°„';
      case '3hour': return '3ì‹œê°„';
      default: return '1ì‹œê°„';
    }
  }

  String _getQualityText(String quality) {
    switch (quality) {
      case 'low': return 'ì €í’ˆì§ˆ (ë” ì‘ì€ íŒŒì¼)';
      case 'medium': return 'ì¤‘í’ˆì§ˆ';
      case 'high': return 'ê³ í’ˆì§ˆ (ë” í° íŒŒì¼)';
      default: return 'ê³ í’ˆì§ˆ';
    }
  }

  String _getStoragePathText(String path) {
    switch (path) {
      case 'default': return 'ê¸°ë³¸ ìœ„ì¹˜';
      case 'external': return 'ì™¸ë¶€ ì €ì¥ì†Œ';
      case 'custom': return 'ì‚¬ìš©ì ì§€ì •';
      default: return 'ê¸°ë³¸ ìœ„ì¹˜';
    }
  }

  void _showMaxTimeSelection(BuildContext context) {
    // ìµœëŒ€ ë“£ê¸° ì‹œê°„ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸
  }

  void _showQualitySelection(BuildContext context) {
    // ì˜¤ë””ì˜¤ í’ˆì§ˆ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸
  }

  void _showStoragePathSelection(BuildContext context) {
    // ì €ì¥ ìœ„ì¹˜ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸
  }
}

// ì„¤ì • ì¹´ë“œ ê¸°ë³¸ í…œí”Œë¦¿
class SettingsCard extends StatelessWidget {
  final String title;
  final IconData icon;
  final List<Widget> children;

  SettingsCard({
    required this.title,
    required this.icon,
    required this.children,
  });

  @override
  Widget build(BuildContext context) {
    return Card(
      elevation: 2,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
      child: Padding(
        padding: EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // ì„¹ì…˜ ì œëª©
            Row(
              children: [
                Icon(icon, color: Theme.of(context).primaryColor),
                SizedBox(width: 8),
                Text(
                  title,
                  style: TextStyle(fontSize: 16, fontWeight: FontWeight.w600),
                ),
              ],
            ),
            SizedBox(height: 16),
            ...children,
          ],
        ),
      ),
    );
  }
}

12.6 ì¶”ê°€ ì„¤ì • ì»´í¬ë„ŒíŠ¸ë“¤

// ì“°ê¸° ì„¤ì • ì¹´ë“œ
class WritingSettingsCard extends StatelessWidget {
  final String autoSaveInterval;
  final String defaultFont;
  final bool showWordCount;
  final bool spellCheck;
  final Function(String) onAutoSaveChanged;
  final Function(String) onFontChanged;
  final Function(bool) onWordCountToggled;
  final Function(bool) onSpellCheckToggled;

  WritingSettingsCard({
    required this.autoSaveInterval,
    required this.defaultFont,
    required this.showWordCount,
    required this.spellCheck,
    required this.onAutoSaveChanged,
    required this.onFontChanged,
    required this.onWordCountToggled,
    required this.onSpellCheckToggled,
  });

  @override
  Widget build(BuildContext context) {
    return SettingsCard(
      title: 'ì“°ê¸° ì„¤ì •',
      icon: Icons.edit,
      children: [
        SettingsListTile(
          leading: Icon(Icons.save),
          title: 'ìë™ ì €ì¥',
          subtitle: _getAutoSaveText(autoSaveInterval),
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.font_download),
          title: 'ê¸°ë³¸ í°íŠ¸',
          subtitle: _getFontText(defaultFont),
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.text_fields),
          title: 'ê¸€ì ìˆ˜ í‘œì‹œ',
          subtitle: showWordCount ? 'ì‚¬ìš©í•¨' : 'ì‚¬ìš© ì•ˆí•¨',
          trailing: Switch(
            value: showWordCount,
            onChanged: onWordCountToggled,
          ),
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.spellcheck),
          title: 'ë§ì¶¤ë²• ê²€ì‚¬',
          subtitle: spellCheck ? 'ì‚¬ìš©í•¨' : 'ì‚¬ìš© ì•ˆí•¨',
          trailing: Switch(
            value: spellCheck,
            onChanged: onSpellCheckToggled,
          ),
        ),
      ],
    );
  }

  String _getAutoSaveText(String interval) {
    switch (interval) {
      case '30sec': return '30ì´ˆë§ˆë‹¤';
      case '1min': return '1ë¶„ë§ˆë‹¤';
      case '3min': return '3ë¶„ë§ˆë‹¤';
      case '5min': return '5ë¶„ë§ˆë‹¤';
      case '10min': return '10ë¶„ë§ˆë‹¤';
      default: return '1ë¶„ë§ˆë‹¤';
    }
  }

  String _getFontText(String font) {
    switch (font) {
      case 'system': return 'ì‹œìŠ¤í…œ ê¸°ë³¸';
      case 'serif': return 'Serif';
      case 'sans': return 'Sans-serif';
      case 'mono': return 'Monospace';
      default: return 'ì‹œìŠ¤í…œ ê¸°ë³¸';
    }
  }
}

// í•„ê¸° ê¸°ëŠ¥ ì„¤ì • (ì“°ê¸° ì„¤ì • ì¹´ë“œì— í†µí•©ë¨)
class HandwritingSettingsCard extends StatelessWidget {
  final String penColor;
  final String penWidth;
  final String paperType;
  final bool palmRejection;
  final Function(String) onPenColorChanged;
  final Function(String) onPenWidthChanged;
  final Function(String) onPaperTypeChanged;
  final Function(bool) onPalmRejectionToggled;

  HandwritingSettingsCard({
    required this.penColor,
    required this.penWidth,
    required this.paperType,
    required this.palmRejection,
    required this.onPenColorChanged,
    required this.onPenWidthChanged,
    required this.onPaperTypeChanged,
    required this.onPalmRejectionToggled,
  });

  @override
  Widget build(BuildContext context) {
    return SettingsCard(
      title: 'í•„ê¸° ê¸°ëŠ¥ ì„¤ì •',
      icon: Icons.edit_note,
      children: [
        SettingsListTile(
          leading: Icon(Icons.color_lens),
          title: 'ê¸°ë³¸ íœ ìƒ‰ìƒ',
          subtitle: _getPenColorText(penColor),
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.line_weight),
          title: 'íœ êµµê¸°',
          subtitle: _getPenWidthText(penWidth),
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.grid_on),
          title: 'ìš©ì§€ íƒ€ì…',
          subtitle: _getPaperTypeText(paperType),
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.pan_tool),
          title: 'ì†ë°”ë‹¥ ê±°ë¶€',
          subtitle: palmRejection ? 'ì‚¬ìš©í•¨' : 'ì‚¬ìš© ì•ˆí•¨',
          trailing: Switch(
            value: palmRejection,
            onChanged: onPalmRejectionToggled,
          ),
        ),
      ],
    );
  }

  String _getPenColorText(String color) {
    switch (color) {
      case 'black': return 'ê²€ì •';
      case 'blue': return 'íŒŒë‘';
      case 'red': return 'ë¹¨ê°•';
      case 'green': return 'ì´ˆë¡';
      default: return 'ê²€ì •';
    }
  }

  String _getPenWidthText(String width) {
    switch (width) {
      case 'thin': return 'ì–‡ê²Œ';
      case 'medium': return 'ì¤‘ê°„';
      case 'thick': return 'êµµê²Œ';
      default: return 'ì¤‘ê°„';
    }
  }

  String _getPaperTypeText(String type) {
    switch (type) {
      case 'plain': return 'ë¬´ì§€';
      case 'lined': return 'ì¤„ë…¸íŠ¸';
      case 'grid': return 'ê²©ì';
      case 'dot': return 'ì ì„ ';
      default: return 'ë¬´ì§€';
    }
  }
}

// ë°ì´í„° ë° ê°œì¸ì •ë³´ ì¹´ë“œ
class DataPrivacyCard extends StatelessWidget {
  final VoidCallback onExportData;
  final VoidCallback onDeleteAllData;
  final VoidCallback onShowPrivacyPolicy;
  final VoidCallback onShowTerms;

  DataPrivacyCard({
    required this.onExportData,
    required this.onDeleteAllData,
    required this.onShowPrivacyPolicy,
    required this.onShowTerms,
  });

  @override
  Widget build(BuildContext context) {
    return SettingsCard(
      title: 'ë°ì´í„° ë° ê°œì¸ì •ë³´',
      icon: Icons.security,
      children: [
        SettingsListTile(
          leading: Icon(Icons.upload),
          title: 'ë°ì´í„° ë‚´ë³´ë‚´ê¸°',
          subtitle: 'ëª¨ë“  ë°ì´í„°ë¥¼ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°',
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
          onTap: onExportData,
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.delete_forever, color: Colors.red),
          title: 'ëª¨ë“  ë°ì´í„° ì‚­ì œ',
          subtitle: 'ë¦¬íŠ¼, íŒŒì¼, ì„¤ì • ì˜êµ¬ ì‚­ì œ',
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
          onTap: onDeleteAllData,
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.privacy_tip),
          title: 'ê°œì¸ì •ë³´ ì •ì±…',
          subtitle: 'ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ë³´ê¸°',
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
          onTap: onShowPrivacyPolicy,
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.description),
          title: 'ì´ìš©ì•½ê´€',
          subtitle: 'ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë³´ê¸°',
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
          onTap: onShowTerms,
        ),
      ],
    );
  }
}

// ê³ ê¸‰ ì„¤ì • ì¹´ë“œ
class AdvancedSettingsCard extends StatelessWidget {
  final bool debugMode;
  final String appVersion;
  final Function(bool) onDebugModeToggled;
  final VoidCallback onShowAppInfo;
  final VoidCallback onContactSupport;
  final VoidCallback onRateApp;

  AdvancedSettingsCard({
    required this.debugMode,
    required this.appVersion,
    required this.onDebugModeToggled,
    required this.onShowAppInfo,
    required this.onContactSupport,
    required this.onRateApp,
  });

  @override
  Widget build(BuildContext context) {
    return SettingsCard(
      title: 'ê³ ê¸‰ ì„¤ì •',
      icon: Icons.build,
      children: [
        SettingsListTile(
          leading: Icon(Icons.bug_report),
          title: 'ë””ë²„ê·¸ ëª¨ë“œ',
          subtitle: debugMode ? 'ì‚¬ìš©í•¨ (ê°œë°œììš©)' : 'ì‚¬ìš© ì•ˆí•¨',
          trailing: Switch(
            value: debugMode,
            onChanged: onDebugModeToggled,
          ),
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.info),
          title: 'ì•± ì •ë³´',
          subtitle: 'ë²„ì „ $appVersion',
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
          onTap: onShowAppInfo,
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.support),
          title: 'ê³ ê° ì§€ì›',
          subtitle: 'ë¬¸ì˜ ë° ê¸°ìˆ  ì§€ì›',
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
          onTap: onContactSupport,
        ),
        Divider(),
        SettingsListTile(
          leading: Icon(Icons.star_rate),
          title: 'ì•± í‰ê°€í•˜ê¸°',
          subtitle: 'ìŠ¤í† ì–´ì—ì„œ ë¦¬ë·° ì‘ì„±',
          trailing: Icon(Icons.arrow_forward_ios, size: 16),
          onTap: onRateApp,
        ),
      ],
    );
  }
}

================================================================================

## 14. í•„ê¸° ë„êµ¬ ìƒì„¸ UI êµ¬ì„± ìš”ì†Œ

### 14.1 í•„ê¸° ë„êµ¬ ê°œì„  ì‚¬í•­

**í•„ê¸° íƒ­ ë„êµ¬ ìƒì„¸ UI ë¯¸í¡ ë¬¸ì œ í•´ê²°:**

1. **ë‹¤ì–‘í•œ í•„ê¸° ë„êµ¬ ì§€ì›**
   - íœ, ë¸ŒëŸ¬ì‹œ, í•˜ì´ë¼ì´í„°, ì§ì„ , ì‚¬ê°í˜•, ì›, í…ìŠ¤íŠ¸, ì„ íƒ, ì§€ìš°ê°œ
   - ê° ë„êµ¬ë³„ íŠ¹í™”ëœ ì„¤ì • ë° ë™ì‘

2. **ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ì‹œìŠ¤í…œ**
   - ê¸°ë³¸ 10ìƒ‰ + ì‚¬ìš©ì ì •ì˜ ìƒ‰ìƒ ì„ íƒê¸°
   - HSV ìƒ‰ìƒ íœ  ì§€ì›

3. **êµµê¸° ì¡°ì ˆ ì‹œìŠ¤í…œ**
   - 1px~20px ìŠ¬ë¼ì´ë” ì¡°ì ˆ
   - ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°

4. **ê³ ê¸‰ í•„ê¸° ê¸°ëŠ¥**
   - ì†ë°”ë‹¥ ê±°ë¶€ ëª¨ë“œ
   - í•„ì•• ê°ì§€
   - ì„  ë§¤ë„í™”
   - ì‹¤í–‰ì·¨ì†Œ/ë‹¤ì‹œí•˜ê¸°
   - ì„ íƒ/ì´ë™/ì‚­ì œ

5. **ê²©ì ë° ê°€ì´ë“œ**
   - ì , ì„ , ê·¸ë˜í”„ ê²©ì
   - í¬ê¸° ì¡°ì ˆ ê°€ëŠ¥

### 14.2 HandwritingToolbar ìƒë‹¨ ë„êµ¬ë°”

ë„êµ¬ë°” êµ¬ì„±:
- íœ, ë¸ŒëŸ¬ì‹œ, í•˜ì´ë¼ì´í„°, ì§ì„ , ì‚¬ê°í˜•, ì›, í…ìŠ¤íŠ¸, ì„ íƒ, ì§€ìš°ê°œ
- ì‹¤í–‰ì·¨ì†Œ, ë‹¤ì‹œí•˜ê¸°, ì „ì²´ì§€ìš°ê¸° ë²„íŠ¼
- ì„ íƒëœ ë„êµ¬ í•˜ì´ë¼ì´íŠ¸ í‘œì‹œ

### 14.3 HandwritingColorPalette ìƒ‰ìƒ íŒ”ë ˆíŠ¸

ìƒ‰ìƒ ì„ íƒ ê¸°ëŠ¥:
- ê¸°ë³¸ 10ìƒ‰ íŒ”ë ˆíŠ¸ (ê²€ì€ìƒ‰, ë¹¨ê°„ìƒ‰, íŒŒë€ìƒ‰, ë…¹ìƒ‰, ì£¼í™©ìƒ‰, ë³´ë¼ìƒ‰, ë…¸ë€ìƒ‰, íšŒìƒ‰, ë¶„í™ìƒ‰, ì—°ì²­ìƒ‰)
- ì‚¬ìš©ì ì •ì˜ ìƒ‰ìƒ ì„ íƒê¸° (HSV ìƒ‰ìƒ íœ )
- êµµê¸° ìŠ¬ë¼ì´ë” (1px~20px)
- ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°

### 14.4 HandwritingCanvas ê·¸ë¦¬ê¸° ìº”ë²„ìŠ¤

ê·¸ë¦¬ê¸° ê¸°ëŠ¥:
- ììœ  ê·¸ë¦¬ê¸° (íœ, ë¸ŒëŸ¬ì‹œ, í•˜ì´ë¼ì´í„°)
- ë„í˜• ê·¸ë¦¬ê¸° (ì§ì„ , ì‚¬ê°í˜•, ì›)
- í…ìŠ¤íŠ¸ ì…ë ¥
- ì„ íƒ ë° ì´ë™/ì‚­ì œ
- ì§€ìš°ê°œ ë„êµ¬
- ë°°ê²½ ì´ë¯¸ì§€ ì§€ì›

### 14.5 DrawnPath ë°ì´í„° ëª¨ë¸

ê²½ë¡œ ì €ì¥ ì •ë³´:
- ì  ì¢Œí‘œ ë°°ì—´
- ìƒ‰ìƒ, êµµê¸°, ë„êµ¬ íƒ€ì…
- íƒ€ì„ìŠ¤íƒ¬í”„
- JSON ì§ë ¬í™”/ì—­ì§ë ¬í™”

### 14.6 ì„¤ì • í™”ë©´ í•„ê¸° ë„êµ¬ ì„¤ì • ê°•í™”

ê³ ê¸‰ ì„¤ì • ì˜µì…˜:
- ê¸°ë³¸ ë„êµ¬, ìƒ‰ìƒ, êµµê¸° ì„¤ì •
- ìë™ ì €ì¥ ê¸°ëŠ¥
- ì†ë°”ë‹¥ ê±°ë¶€ ëª¨ë“œ
- í•„ì•• ê°ì§€ (ì••ë ¥ì— ë”°ë¥¸ ì„  ë‘ê»˜ ì¡°ì ˆ)
- ì„  ë§¤ë„í™” (ë² ì§€ì–´ ê³¡ì„  ì ìš©)
- ê²©ì í‘œì‹œ (ì , ì„ , ê·¸ë˜í”„ ê²©ì)
- ê²©ì í¬ê¸° ì¡°ì ˆ

### 14.7 í•„ê¸° ë„êµ¬ ìƒí˜¸ì‘ìš©

**ë„êµ¬ë³„ ë™ì‘:**
- **íœ**: ê¸°ë³¸ ììœ  ê·¸ë¦¬ê¸°
- **ë¸ŒëŸ¬ì‹œ**: êµµì€ ì„ , ê·¸ë¼ë°ì´ì…˜ íš¨ê³¼
- **í•˜ì´ë¼ì´í„°**: ë°˜íˆ¬ëª… ìƒ‰ìƒ, ë„“ì€ ì„ 
- **ì§ì„ **: ë‘ ì ì„ ì—°ê²°í•œ ì§ì„ 
- **ì‚¬ê°í˜•**: ë“œë˜ê·¸ë¡œ ì‚¬ê°í˜• ê·¸ë¦¬ê¸°
- **ì›**: ì¤‘ì‹¬ì ì—ì„œ ë°˜ì§€ë¦„ìœ¼ë¡œ ì› ê·¸ë¦¬ê¸°
- **í…ìŠ¤íŠ¸**: í´ë¦­ ìœ„ì¹˜ì— í…ìŠ¤íŠ¸ ì…ë ¥
- **ì„ íƒ**: ê²½ë¡œ ì„ íƒ/ì´ë™/ì‚­ì œ
- **ì§€ìš°ê°œ**: í„°ì¹˜ ìœ„ì¹˜ì˜ ê²½ë¡œ ì‚­ì œ

**ê³ ê¸‰ ê¸°ëŠ¥:**
- ì‹¤í–‰ì·¨ì†Œ/ë‹¤ì‹œí•˜ê¸° (ë¬´ì œí•œ)
- ì „ì²´ ì§€ìš°ê¸°
- ë² ì§€ì–´ ê³¡ì„  ë§¤ë„í™”
- ë©€í‹°í„°ì¹˜ ì œìŠ¤ì²˜ ì§€ì›
- ì••ë ¥ ê°ì§€ (ì§€ì› ë””ë°”ì´ìŠ¤)

ì´ì œ í•„ê¸° ë„êµ¬ ìƒì„¸ UIê°€ ì™„ì „íˆ êµ¬ì„±ë˜ì–´ ì „ë¬¸ì ì¸ í•„ê¸° ì•± ìˆ˜ì¤€ì˜ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

================================================================================

## 15. ê²€ìƒ‰ ë° ì˜¨ë³´ë”© UI êµ¬ì„± ìš”ì†Œ

### 15.1 ê²€ìƒ‰ ê¸°ëŠ¥ UI ì„¤ê³„

**ê²€ìƒ‰ ë° ì˜¨ë³´ë”© UI ëˆ„ë½ ë¬¸ì œ í•´ê²°:**

1. **í†µí•© ê²€ìƒ‰ ì‹œìŠ¤í…œ**
   - ì „ì—­ ê²€ìƒ‰ë°” + ê³ ê¸‰ ê²€ìƒ‰ í™”ë©´
   - ì‹¤ì‹œê°„ ê²€ìƒ‰ ì œì•ˆ
   - ê²€ìƒ‰ ê²°ê³¼ í•˜ì´ë¼ì´íŠ¸

2. **ì˜¨ë³´ë”© í”Œë¡œìš°**
   - ì–¸ì–´ ì„ íƒ â†’ ê¶Œí•œ ìš”ì²­ â†’ íŠœí† ë¦¬ì–¼ â†’ ì²« ë…¸íŠ¸ ìƒì„±
   - ë‹¨ê³„ë³„ ê°€ì´ë“œ ë° íˆ´íŒ

3. **ì²« ì‹¤í–‰ ê²½í—˜**
   - ìŠ¤í”Œë˜ì‹œ í™”ë©´
   - í™˜ì˜ ë©”ì‹œì§€
   - ì£¼ìš” ê¸°ëŠ¥ ì†Œê°œ

### 15.2 SearchScreen í†µí•© ê²€ìƒ‰ í™”ë©´

```dart
class SearchScreen extends StatefulWidget {
  @override
  _SearchScreenState createState() => _SearchScreenState();
}

class _SearchScreenState extends State<SearchScreen> {
  final TextEditingController _searchController = TextEditingController();
  final FocusNode _searchFocusNode = FocusNode();
  
  List<SearchResult> _searchResults = [];
  List<String> _recentSearches = [];
  List<String> _searchSuggestions = [];
  bool _isLoading = false;
  String _selectedFilter = 'all'; // 'all', 'recordings', 'writings', 'handwritings'
  DateTime? _dateFrom;
  DateTime? _dateTo;
  
  @override
  void initState() {
    super.initState();
    _loadRecentSearches();
    _searchFocusNode.requestFocus();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        backgroundColor: Theme.of(context).scaffoldBackgroundColor,
        elevation: 0,
        title: SearchBar(
          controller: _searchController,
          focusNode: _searchFocusNode,
          hintText: 'ë…¸íŠ¸, ìŒì„±, í…ìŠ¤íŠ¸, í•„ê¸°ì—ì„œ ê²€ìƒ‰...',
          onChanged: _onSearchChanged,
          onSubmitted: _performSearch,
          trailing: [
            IconButton(
              icon: Icon(Icons.tune),
              onPressed: _showAdvancedSearchOptions,
            ),
          ],
        ),
      ),
      body: Column(
        children: [
          // ê²€ìƒ‰ í•„í„° íƒ­
          SearchFilterTabs(
            selectedFilter: _selectedFilter,
            onFilterChanged: (filter) {
              setState(() => _selectedFilter = filter);
              if (_searchController.text.isNotEmpty) {
                _performSearch(_searchController.text);
              }
            },
          ),
          
          // ê²€ìƒ‰ ê²°ê³¼ ë˜ëŠ” ì œì•ˆ
          Expanded(
            child: _buildSearchContent(),
          ),
        ],
      ),
    );
  }
  
  Widget _buildSearchContent() {
    if (_searchController.text.isEmpty) {
      return _buildSearchSuggestions();
    } else if (_isLoading) {
      return _buildLoadingIndicator();
    } else if (_searchResults.isEmpty) {
      return _buildNoResults();
    } else {
      return _buildSearchResults();
    }
  }
  
  Widget _buildSearchSuggestions() {
    return SingleChildScrollView(
      padding: EdgeInsets.all(16),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          // ìµœê·¼ ê²€ìƒ‰ì–´
          if (_recentSearches.isNotEmpty) ...[
            _buildSectionHeader('ìµœê·¼ ê²€ìƒ‰ì–´', onClear: _clearRecentSearches),
            SizedBox(height: 8),
            Wrap(
              spacing: 8,
              runSpacing: 8,
              children: _recentSearches.map((search) => 
                RecentSearchChip(
                  text: search,
                  onTap: () => _applyRecentSearch(search),
                  onDelete: () => _removeRecentSearch(search),
                )
              ).toList(),
            ),
            SizedBox(height: 24),
          ],
          
          // ë¹ ë¥¸ ê²€ìƒ‰ ì œì•ˆ
          _buildSectionHeader('ë¹ ë¥¸ ê²€ìƒ‰'),
          SizedBox(height: 8),
          QuickSearchGrid(
            suggestions: [
              QuickSearchItem(icon: Icons.today, label: 'ì˜¤ëŠ˜ ì‘ì„±', query: 'date:today'),
              QuickSearchItem(icon: Icons.star, label: 'ì¦ê²¨ì°¾ê¸°', query: 'favorite:true'),
              QuickSearchItem(icon: Icons.mic, label: 'ìŒì„± ë…¸íŠ¸', query: 'type:recording'),
              QuickSearchItem(icon: Icons.edit, label: 'í…ìŠ¤íŠ¸ ë…¸íŠ¸', query: 'type:writing'),
              QuickSearchItem(icon: Icons.draw, label: 'í•„ê¸° ë…¸íŠ¸', query: 'type:handwriting'),
              QuickSearchItem(icon: Icons.image, label: 'ì´ë¯¸ì§€ í¬í•¨', query: 'has:image'),
            ],
            onItemTap: _applyQuickSearch,
          ),
          
          SizedBox(height: 24),
          
          // ê²€ìƒ‰ íŒ
          _buildSearchTips(),
        ],
      ),
    );
  }
  
  Widget _buildSearchResults() {
    return ListView.builder(
      padding: EdgeInsets.all(16),
      itemCount: _searchResults.length + 1,
      itemBuilder: (context, index) {
        if (index == 0) {
          return SearchResultHeader(
            resultCount: _searchResults.length,
            searchQuery: _searchController.text,
            selectedFilter: _selectedFilter,
          );
        }
        
        final result = _searchResults[index - 1];
        return SearchResultCard(
          result: result,
          searchQuery: _searchController.text,
          onTap: () => _openSearchResult(result),
        );
      },
    );
  }
  
  Widget _buildNoResults() {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(Icons.search_off, size: 80, color: Colors.grey.shade400),
          SizedBox(height: 16),
          Text(
            'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤',
            style: TextStyle(fontSize: 18, fontWeight: FontWeight.w500),
          ),
          SizedBox(height: 8),
          Text(
            '"${_searchController.text}"ì— ëŒ€í•œ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
            style: TextStyle(color: Colors.grey.shade600),
            textAlign: TextAlign.center,
          ),
          SizedBox(height: 24),
          _buildSearchSuggestionButtons(),
        ],
      ),
    );
  }
  
  void _onSearchChanged(String query) {
    setState(() {
      _searchSuggestions = _generateSearchSuggestions(query);
    });
  }
  
  void _performSearch(String query) {
    if (query.trim().isEmpty) return;
    
    setState(() => _isLoading = true);
    
    _addToRecentSearches(query);
    
    // ì‹¤ì œ ê²€ìƒ‰ ë¡œì§
    SearchService.searchAll(
      query: query,
      filter: _selectedFilter,
      dateFrom: _dateFrom,
      dateTo: _dateTo,
    ).then((results) {
      setState(() {
        _searchResults = results;
        _isLoading = false;
      });
    });
  }
}
```

### 15.3 SearchFilterTabs ê²€ìƒ‰ í•„í„°

```dart
class SearchFilterTabs extends StatelessWidget {
  final String selectedFilter;
  final Function(String) onFilterChanged;
  
  const SearchFilterTabs({
    Key? key,
    required this.selectedFilter,
    required this.onFilterChanged,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Container(
      height: 48,
      padding: EdgeInsets.symmetric(horizontal: 16),
      child: Row(
        children: [
          Expanded(
            child: SingleChildScrollView(
              scrollDirection: Axis.horizontal,
              child: Row(
                children: [
                  SearchFilterChip(
                    label: 'ì „ì²´',
                    icon: Icons.all_inclusive,
                    isSelected: selectedFilter == 'all',
                    onTap: () => onFilterChanged('all'),
                  ),
                  SizedBox(width: 8),
                  SearchFilterChip(
                    label: 'ìŒì„±',
                    icon: Icons.mic,
                    isSelected: selectedFilter == 'recordings',
                    onTap: () => onFilterChanged('recordings'),
                  ),
                  SizedBox(width: 8),
                  SearchFilterChip(
                    label: 'í…ìŠ¤íŠ¸',
                    icon: Icons.text_fields,
                    isSelected: selectedFilter == 'writings',
                    onTap: () => onFilterChanged('writings'),
                  ),
                  SizedBox(width: 8),
                  SearchFilterChip(
                    label: 'í•„ê¸°',
                    icon: Icons.draw,
                    isSelected: selectedFilter == 'handwritings',
                    onTap: () => onFilterChanged('handwritings'),
                  ),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }
}
```

### 15.4 SearchResultCard ê²€ìƒ‰ ê²°ê³¼ ì¹´ë“œ

```dart
class SearchResultCard extends StatelessWidget {
  final SearchResult result;
  final String searchQuery;
  final VoidCallback onTap;
  
  const SearchResultCard({
    Key? key,
    required this.result,
    required this.searchQuery,
    required this.onTap,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Card(
      margin: EdgeInsets.only(bottom: 12),
      child: InkWell(
        onTap: onTap,
        borderRadius: BorderRadius.circular(12),
        child: Padding(
          padding: EdgeInsets.all(16),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              // ì œëª©ê³¼ íƒ€ì…
              Row(
                children: [
                  _buildTypeIcon(),
                  SizedBox(width: 8),
                  Expanded(
                    child: Text(
                      result.title,
                      style: TextStyle(fontSize: 16, fontWeight: FontWeight.w600),
                      maxLines: 1,
                      overflow: TextOverflow.ellipsis,
                    ),
                  ),
                  Text(
                    _formatDate(result.createdAt),
                    style: TextStyle(fontSize: 12, color: Colors.grey.shade600),
                  ),
                ],
              ),
              
              SizedBox(height: 8),
              
              // ë§¤ì¹­ëœ ì½˜í…ì¸  ë¯¸ë¦¬ë³´ê¸°
              if (result.snippet.isNotEmpty)
                HighlightedText(
                  text: result.snippet,
                  highlight: searchQuery,
                  maxLines: 3,
                  style: TextStyle(fontSize: 14, height: 1.4),
                ),
              
              SizedBox(height: 12),
              
              // ë©”íƒ€ ì •ë³´
              Row(
                children: [
                  if (result.noteTitle != result.title) ...[
                    Icon(Icons.folder_outlined, size: 14, color: Colors.grey.shade600),
                    SizedBox(width: 4),
                    Text(
                      result.noteTitle,
                      style: TextStyle(fontSize: 12, color: Colors.grey.shade600),
                    ),
                    SizedBox(width: 16),
                  ],
                  Icon(Icons.access_time, size: 14, color: Colors.grey.shade600),
                  SizedBox(width: 4),
                  Text(
                    _formatDuration(result.duration),
                    style: TextStyle(fontSize: 12, color: Colors.grey.shade600),
                  ),
                  Spacer(),
                  if (result.matchCount > 1)
                    Container(
                      padding: EdgeInsets.symmetric(horizontal: 8, vertical: 2),
                      decoration: BoxDecoration(
                        color: Theme.of(context).primaryColor.withOpacity(0.1),
                        borderRadius: BorderRadius.circular(12),
                      ),
                      child: Text(
                        '${result.matchCount}ê°œ ì¼ì¹˜',
                        style: TextStyle(
                          fontSize: 10,
                          color: Theme.of(context).primaryColor,
                          fontWeight: FontWeight.w500,
                        ),
                      ),
                    ),
                ],
              ),
            ],
          ),
        ),
      ),
    );
  }
  
  Widget _buildTypeIcon() {
    IconData icon;
    Color color;
    
    switch (result.type) {
      case SearchResultType.recording:
        icon = Icons.mic;
        color = Colors.red;
        break;
      case SearchResultType.writing:
        icon = Icons.text_fields;
        color = Colors.blue;
        break;
      case SearchResultType.handwriting:
        icon = Icons.draw;
        color = Colors.green;
        break;
      default:
        icon = Icons.description;
        color = Colors.grey;
    }
    
    return Icon(icon, size: 20, color: color);
  }
}
```

### 15.5 OnboardingScreen ì˜¨ë³´ë”© í™”ë©´

```dart
class OnboardingScreen extends StatefulWidget {
  @override
  _OnboardingScreenState createState() => _OnboardingScreenState();
}

class _OnboardingScreenState extends State<OnboardingScreen> {
  final PageController _pageController = PageController();
  int _currentPage = 0;
  
  final List<OnboardingPage> _pages = [
    OnboardingPage(
      title: 'ë¦¬íŠ¼ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!',
      subtitle: 'ìŒì„±, í…ìŠ¤íŠ¸, í•„ê¸°ë¥¼ í•˜ë‚˜ë¡œ í†µí•©í•˜ëŠ”\nìƒˆë¡œìš´ ë…¸íŠ¸ ê²½í—˜ì„ ì‹œì‘í•˜ì„¸ìš”',
      imagePath: 'assets/onboarding/welcome.png',
      backgroundColor: Color(0xFF6366F1),
    ),
    OnboardingPage(
      title: 'ìŒì„±ìœ¼ë¡œ ì‰½ê²Œ ê¸°ë¡í•˜ì„¸ìš”',
      subtitle: 'íšŒì˜, ê°•ì˜, ì¸í„°ë·°ë¥¼ ë“£ê¸°í•˜ê³ \nìë™ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ë©ë‹ˆë‹¤',
      imagePath: 'assets/onboarding/recording.png',
      backgroundColor: Color(0xFF06B6D4),
    ),
    OnboardingPage(
      title: 'ììœ ë¡­ê²Œ ê¸€ì„ ì¨ë³´ì„¸ìš”',
      subtitle: 'ë§ˆí¬ë‹¤ìš´ ì§€ì›ìœ¼ë¡œ ì²´ê³„ì ì¸\ní…ìŠ¤íŠ¸ ë¬¸ì„œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤',
      imagePath: 'assets/onboarding/writing.png',
      backgroundColor: Color(0xFF10B981),
    ),
    OnboardingPage(
      title: 'ì†ìœ¼ë¡œ ì§ì ‘ ê·¸ë ¤ë³´ì„¸ìš”',
      subtitle: 'ë‹¤ì–‘í•œ ë„êµ¬ë¡œ ììœ ë¡­ê²Œ ê·¸ë¦¬ê³ \në¬¸ì„œì— ì£¼ì„ì„ ì¶”ê°€í•˜ì„¸ìš”',
      imagePath: 'assets/onboarding/handwriting.png',
      backgroundColor: Color(0xFFF59E0B),
    ),
    OnboardingPage(
      title: 'ëª¨ë“  ê²ƒì„ í•˜ë‚˜ë¡œ',
      subtitle: 'ë¦¬íŠ¼ ê³µê°„ì—ì„œ ìŒì„±, í…ìŠ¤íŠ¸, í•„ê¸°ê°€\nì™„ë²½í•˜ê²Œ ì—°ê²°ë©ë‹ˆë‹¤',
      imagePath: 'assets/onboarding/integration.png',
      backgroundColor: Color(0xFFEF4444),
    ),
  ];

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Stack(
        children: [
          // í˜ì´ì§€ë·°
          PageView.builder(
            controller: _pageController,
            onPageChanged: (index) => setState(() => _currentPage = index),
            itemCount: _pages.length,
            itemBuilder: (context, index) {
              return OnboardingPageWidget(page: _pages[index]);
            },
          ),
          
          // ìƒë‹¨ ê±´ë„ˆë›°ê¸° ë²„íŠ¼
          Positioned(
            top: MediaQuery.of(context).padding.top + 16,
            right: 16,
            child: TextButton(
              onPressed: _skipOnboarding,
              child: Text(
                'ê±´ë„ˆë›°ê¸°',
                style: TextStyle(
                  color: Colors.white,
                  fontSize: 16,
                  fontWeight: FontWeight.w500,
                ),
              ),
            ),
          ),
          
          // í•˜ë‹¨ ì»¨íŠ¸ë¡¤
          Positioned(
            bottom: MediaQuery.of(context).padding.bottom + 24,
            left: 0,
            right: 0,
            child: Padding(
              padding: EdgeInsets.symmetric(horizontal: 24),
              child: Column(
                children: [
                  // í˜ì´ì§€ ì¸ë””ì¼€ì´í„°
                  Row(
                    mainAxisAlignment: MainAxisAlignment.center,
                    children: List.generate(
                      _pages.length,
                      (index) => OnboardingDot(
                        isActive: index == _currentPage,
                        color: Colors.white,
                      ),
                    ),
                  ),
                  
                  SizedBox(height: 32),
                  
                  // ë‹¤ìŒ/ì‹œì‘ ë²„íŠ¼
                  SizedBox(
                    width: double.infinity,
                    height: 52,
                    child: ElevatedButton(
                      onPressed: _handleNextButton,
                      style: ElevatedButton.styleFrom(
                        backgroundColor: Colors.white,
                        foregroundColor: _pages[_currentPage].backgroundColor,
                        shape: RoundedRectangleBorder(
                          borderRadius: BorderRadius.circular(26),
                        ),
                      ),
                      child: Text(
                        _currentPage == _pages.length - 1 ? 'ì‹œì‘í•˜ê¸°' : 'ë‹¤ìŒ',
                        style: TextStyle(
                          fontSize: 16,
                          fontWeight: FontWeight.w600,
                        ),
                      ),
                    ),
                  ),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }
  
  void _handleNextButton() {
    if (_currentPage == _pages.length - 1) {
      _completeOnboarding();
    } else {
      _pageController.nextPage(
        duration: Duration(milliseconds: 300),
        curve: Curves.easeInOut,
      );
    }
  }
  
  void _skipOnboarding() {
    _completeOnboarding();
  }
  
  void _completeOnboarding() {
    Navigator.pushReplacement(
      context,
      MaterialPageRoute(builder: (context) => LanguageSelectionScreen()),
    );
  }
}
```

### 15.6 OnboardingPageWidget ì˜¨ë³´ë”© í˜ì´ì§€

```dart
class OnboardingPageWidget extends StatelessWidget {
  final OnboardingPage page;
  
  const OnboardingPageWidget({Key? key, required this.page}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Container(
      decoration: BoxDecoration(
        gradient: LinearGradient(
          begin: Alignment.topCenter,
          end: Alignment.bottomCenter,
          colors: [
            page.backgroundColor,
            page.backgroundColor.withOpacity(0.8),
          ],
        ),
      ),
      child: SafeArea(
        child: Padding(
          padding: EdgeInsets.symmetric(horizontal: 32),
          child: Column(
            children: [
              SizedBox(height: 60),
              
              // ì´ë¯¸ì§€
              Expanded(
                flex: 3,
                child: Center(
                  child: Image.asset(
                    page.imagePath,
                    width: MediaQuery.of(context).size.width * 0.7,
                    fit: BoxFit.contain,
                  ),
                ),
              ),
              
              // í…ìŠ¤íŠ¸ ì½˜í…ì¸ 
              Expanded(
                flex: 2,
                child: Column(
                  mainAxisAlignment: MainAxisAlignment.center,
                  children: [
                    Text(
                      page.title,
                      style: TextStyle(
                        fontSize: 28,
                        fontWeight: FontWeight.bold,
                        color: Colors.white,
                        height: 1.2,
                      ),
                      textAlign: TextAlign.center,
                    ),
                    
                    SizedBox(height: 16),
                    
                    Text(
                      page.subtitle,
                      style: TextStyle(
                        fontSize: 16,
                        color: Colors.white.withOpacity(0.9),
                        height: 1.5,
                      ),
                      textAlign: TextAlign.center,
                    ),
                  ],
                ),
              ),
              
              SizedBox(height: 120), // í•˜ë‹¨ ë²„íŠ¼ ê³µê°„
            ],
          ),
        ),
      ),
    );
  }
}
```

### 15.7 WelcomeScreen í™˜ì˜ í™”ë©´ (ì‹œìŠ¤í…œ ì–¸ì–´/í…Œë§ˆ ìë™ ê°ì§€)

```dart
class WelcomeScreen extends StatefulWidget {
  @override
  _WelcomeScreenState createState() => _WelcomeScreenState();
}

class _WelcomeScreenState extends State<WelcomeScreen> 
    with SingleTickerProviderStateMixin {
  late AnimationController _animationController;
  late Animation<double> _fadeAnimation;
  late Animation<Offset> _slideAnimation;

  @override
  void initState() {
    super.initState();
    _animationController = AnimationController(
      duration: Duration(milliseconds: 1500),
      vsync: this,
    );
    
    _fadeAnimation = Tween<double>(begin: 0.0, end: 1.0).animate(
      CurvedAnimation(parent: _animationController, curve: Curves.easeIn),
    );
    
    _slideAnimation = Tween<Offset>(
      begin: Offset(0, 0.3),
      end: Offset.zero,
    ).animate(CurvedAnimation(
      parent: _animationController,
      curve: Curves.easeOutBack,
    ));
    
    _animationController.forward();
    
    // ì²« ì‹¤í–‰ ì‹œ ì‹œìŠ¤í…œ ì–¸ì–´ ë° í…Œë§ˆ ìë™ ê°ì§€ ë° ì„¤ì •
    if (PreferencesService.isFirstLaunch()) {
      _initializeFirstLaunchSettings();
    }
    
    // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ í™”ë©´ìœ¼ë¡œ
    Timer(Duration(seconds: 3), () {
      if (mounted) {
        _navigateToNext();
      }
    });
  }

  // ì²« ì‹¤í–‰ ì‹œ ì‹œìŠ¤í…œ ì„¤ì • ìë™ ê°ì§€
  void _initializeFirstLaunchSettings() async {
    // 1. UUID ìƒì„± ë° ì„œë²„ ë“±ë¡
    final appId = await AppIdService.generateAndRegisterAppId();
    
    // 2. ì‹œìŠ¤í…œ ì–¸ì–´ ê°ì§€ ë° ì„¤ì •
    final systemLocale = Localizations.localeOf(context);
    final detectedLanguage = _detectSupportedLanguage(systemLocale);
    await PreferencesService.setLanguage(detectedLanguage);
    
    // 3. êµ­ê°€ë³„ ì„ í˜¸ í…Œë§ˆ ìë™ ì„¤ì •
    final preferredTheme = _getPreferredThemeByCountry(systemLocale.countryCode);
    await PreferencesService.setTheme(preferredTheme);
    
    print('Generated App ID: $appId');
    print('Auto-detected language: $detectedLanguage');
    print('Auto-selected theme: $preferredTheme');
  }
  
  // ì§€ì› ì–¸ì–´ ê°ì§€
  String _detectSupportedLanguage(Locale locale) {
    const supportedLanguages = {
      'ko': 'korean',     // í•œêµ­ì–´
      'en': 'english',    // ì˜ì–´
      'ja': 'japanese',   // ì¼ë³¸ì–´
      'zh': 'chinese',    // ì¤‘êµ­ì–´
      'es': 'spanish',    // ìŠ¤í˜ì¸ì–´
      'fr': 'french',     // í”„ë‘ìŠ¤ì–´
      'de': 'german',     // ë…ì¼ì–´
      'it': 'italian',    // ì´íƒˆë¦¬ì•„ì–´
      'pt': 'portuguese', // í¬ë¥´íˆ¬ê°ˆì–´
      'ru': 'russian',    // ëŸ¬ì‹œì•„ì–´
      'ar': 'arabic',     // ì•„ëì–´
      'hi': 'hindi',      // íŒë””ì–´
      'th': 'thai',       // íƒœêµ­ì–´
      'id': 'indonesian', // ì¸ë„ë„¤ì‹œì•„ì–´
    };
    
    // ìš°ì„  ì–¸ì–´ ì½”ë“œë¡œ ë§¤ì¹­
    if (supportedLanguages.containsKey(locale.languageCode)) {
      return supportedLanguages[locale.languageCode]!;
    }
    
    // ê¸°ë³¸ê°’: ì˜ì–´
    return 'english';
  }
  
  // êµ­ê°€ë³„ ì„ í˜¸ í…Œë§ˆ ë§¤í•‘
  String _getPreferredThemeByCountry(String? countryCode) {
    const countryThemeMapping = {
      // ì•„ì‹œì•„ - í´ë˜ì‹ ë¸”ë£¨ ì„ í˜¸
      'KR': 'classic_blue',    // í•œêµ­
      'JP': 'classic_blue',    // ì¼ë³¸
      'CN': 'classic_blue',    // ì¤‘êµ­
      'TW': 'classic_blue',    // ëŒ€ë§Œ
      'SG': 'classic_blue',    // ì‹±ê°€í¬ë¥´
      'TH': 'classic_blue',    // íƒœêµ­
      'ID': 'classic_blue',    // ì¸ë„ë„¤ì‹œì•„
      'MY': 'classic_blue',    // ë§ë ˆì´ì‹œì•„
      'VN': 'classic_blue',    // ë² íŠ¸ë‚¨
      'IN': 'classic_blue',    // ì¸ë„
      
      // ìœ ëŸ½ - ëª¨ë…¸í¬ë¡¬ ê·¸ë ˆì´ ì„ í˜¸
      'DE': 'monochrome_grey', // ë…ì¼
      'FR': 'monochrome_grey', // í”„ë‘ìŠ¤
      'IT': 'monochrome_grey', // ì´íƒˆë¦¬ì•„
      'ES': 'monochrome_grey', // ìŠ¤í˜ì¸
      'PT': 'monochrome_grey', // í¬ë¥´íˆ¬ê°ˆ
      'NL': 'monochrome_grey', // ë„¤ëœë€ë“œ
      'SE': 'monochrome_grey', // ìŠ¤ì›¨ë´
      'NO': 'monochrome_grey', // ë…¸ë¥´ì›¨ì´
      'DK': 'monochrome_grey', // ë´ë§ˆí¬
      'CH': 'monochrome_grey', // ìŠ¤ìœ„ìŠ¤
      'AT': 'monochrome_grey', // ì˜¤ìŠ¤íŠ¸ë¦¬ì•„
      'BE': 'monochrome_grey', // ë²¨ê¸°ì—
      
      // ë¶ë¯¸ - ë‹¤í¬ ëª¨ë“œ ì„ í˜¸
      'US': 'dark_mode',       // ë¯¸êµ­
      'CA': 'dark_mode',       // ìºë‚˜ë‹¤
      
      // ì¤‘ë™/ì•„í”„ë¦¬ì¹´ - ì„ ì…‹ ì˜¤ë Œì§€ ì„ í˜¸
      'AE': 'sunset_orange',   // UAE
      'SA': 'sunset_orange',   // ì‚¬ìš°ë””ì•„ë¼ë¹„ì•„
      'EG': 'sunset_orange',   // ì´ì§‘íŠ¸
      'ZA': 'sunset_orange',   // ë‚¨ì•„í”„ë¦¬ì¹´ê³µí™”êµ­
      'MA': 'sunset_orange',   // ëª¨ë¡œì½”
      'IL': 'sunset_orange',   // ì´ìŠ¤ë¼ì—˜
      'TR': 'sunset_orange',   // í„°í‚¤
      
      // ë‚¨ë¯¸/ì˜¤ì„¸ì•„ë‹ˆì•„ - ë„¤ì´ì²˜ ê·¸ë¦° ì„ í˜¸
      'BR': 'nature_green',    // ë¸Œë¼ì§ˆ
      'AR': 'nature_green',    // ì•„ë¥´í—¨í‹°ë‚˜
      'CL': 'nature_green',    // ì¹ ë ˆ
      'CO': 'nature_green',    // ì½œë¡¬ë¹„ì•„
      'PE': 'nature_green',    // í˜ë£¨
      'AU': 'nature_green',    // í˜¸ì£¼
      'NZ': 'nature_green',    // ë‰´ì§ˆëœë“œ
      
      // ë™ìœ ëŸ½/ëŸ¬ì‹œì•„ - í´ë˜ì‹ ë¸”ë£¨ ì„ í˜¸
      'RU': 'classic_blue',    // ëŸ¬ì‹œì•„
      'PL': 'classic_blue',    // í´ë€ë“œ
      'CZ': 'classic_blue',    // ì²´ì½”
      'HU': 'classic_blue',    // í—ê°€ë¦¬
      'UA': 'classic_blue',    // ìš°í¬ë¼ì´ë‚˜
    };
    
    if (countryCode != null && countryThemeMapping.containsKey(countryCode)) {
      return countryThemeMapping[countryCode]!;
    }
    
    // ê¸°ë³¸ê°’: í´ë˜ì‹ ë¸”ë£¨
    return 'classic_blue';
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Theme.of(context).primaryColor,
      body: AnimatedBuilder(
        animation: _animationController,
        builder: (context, child) {
          return FadeTransition(
            opacity: _fadeAnimation,
            child: SlideTransition(
              position: _slideAnimation,
              child: Center(
                child: Column(
                  mainAxisAlignment: MainAxisAlignment.center,
                  children: [
                    // ë¡œê³ 
                    Container(
                      width: 120,
                      height: 120,
                      decoration: BoxDecoration(
                        color: Colors.white,
                        borderRadius: BorderRadius.circular(24),
                        boxShadow: [
                          BoxShadow(
                            color: Colors.black.withOpacity(0.1),
                            blurRadius: 20,
                            offset: Offset(0, 10),
                          ),
                        ],
                      ),
                      child: Center(
                        child: Text(
                          'L',
                          style: TextStyle(
                            fontSize: 48,
                            fontWeight: FontWeight.bold,
                            color: Theme.of(context).primaryColor,
                          ),
                        ),
                      ),
                    ),
                    
                    SizedBox(height: 32),
                    
                    // ì•± ì´ë¦„
                    Text(
                      'Liten',
                      style: TextStyle(
                        fontSize: 32,
                        fontWeight: FontWeight.bold,
                        color: Colors.white,
                        letterSpacing: 2,
                      ),
                    ),
                    
                    SizedBox(height: 8),
                    
                    // ìŠ¬ë¡œê±´
                    Text(
                      'Listen, Write, Draw',
                      style: TextStyle(
                        fontSize: 16,
                        color: Colors.white.withOpacity(0.8),
                        letterSpacing: 1,
                      ),
                    ),
                    
                    SizedBox(height: 60),
                    
                    // ë¡œë”© ì¸ë””ì¼€ì´í„°
                    SizedBox(
                      width: 32,
                      height: 32,
                      child: CircularProgressIndicator(
                        valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
                        strokeWidth: 2,
                      ),
                    ),
                    
                    SizedBox(height: 16),
                    
                    // ì²« ì‹¤í–‰ ì‹œ ìë™ ì„¤ì • ë©”ì‹œì§€
                    if (PreferencesService.isFirstLaunch())
                      Text(
                        'ì‹œìŠ¤í…œ ì–¸ì–´ ë° í…Œë§ˆ ê°ì§€ ì¤‘...',
                        style: TextStyle(
                          fontSize: 12,
                          color: Colors.white.withOpacity(0.7),
                        ),
                      ),
                  ],
                ),
              ),
            ),
          );
        },
      ),
    );
  }
  
  void _navigateToNext() {
    if (PreferencesService.isFirstLaunch()) {
      Navigator.pushReplacement(
        context,
        MaterialPageRoute(builder: (context) => OnboardingScreen()),
      );
    } else {
      Navigator.pushReplacement(
        context,
        MaterialPageRoute(builder: (context) => MainScreen()),
      );
    }
  }
  
  @override
  void dispose() {
    _animationController.dispose();
    super.dispose();
  }
}
```

### 15.8 ë°ì´í„° ëª¨ë¸ ë° ì„œë¹„ìŠ¤

```dart
// ê²€ìƒ‰ ê²°ê³¼ ëª¨ë¸
class SearchResult {
  final String id;
  final String title;
  final String snippet;
  final SearchResultType type;
  final String noteTitle;
  final DateTime createdAt;
  final Duration? duration;
  final int matchCount;
  final Map<String, dynamic> metadata;
  
  SearchResult({
    required this.id,
    required this.title,
    required this.snippet,
    required this.type,
    required this.noteTitle,
    required this.createdAt,
    this.duration,
    this.matchCount = 1,
    this.metadata = const {},
  });
}

enum SearchResultType { recording, writing, handwriting, note }

// ì˜¨ë³´ë”© í˜ì´ì§€ ëª¨ë¸
class OnboardingPage {
  final String title;
  final String subtitle;
  final String imagePath;
  final Color backgroundColor;
  
  OnboardingPage({
    required this.title,
    required this.subtitle,
    required this.imagePath,
    required this.backgroundColor,
  });
}

// ê²€ìƒ‰ ì„œë¹„ìŠ¤
class SearchService {
  static Future<List<SearchResult>> searchAll({
    required String query,
    String filter = 'all',
    DateTime? dateFrom,
    DateTime? dateTo,
  }) async {
    // ì‹¤ì œ ê²€ìƒ‰ ë¡œì§ êµ¬í˜„
    // ElasticSearch ë˜ëŠ” ë¡œì»¬ ì¸ë±ì‹± ì‚¬ìš©
    return [];
  }
  
  static List<String> generateSuggestions(String query) {
    // ê²€ìƒ‰ ì œì•ˆ ìƒì„± ë¡œì§
    return [];
  }
}
```

ì´ì œ ê²€ìƒ‰ ë° ì˜¨ë³´ë”© UIê°€ ì™„ì „íˆ êµ¬ì„±ë˜ì–´ ì‚¬ìš©ì ê²½í—˜ì´ í¬ê²Œ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤!

================================================================================

## 16. ìƒë‹¨ í‘œì‹œì¤„ UI êµ¬ì„± ìš”ì†Œ (í˜„ì¬ í™œì„± ìƒíƒœ í‘œì‹œ)

### 16.1 TopStatusBar ìƒë‹¨ ìƒíƒœ í‘œì‹œì¤„

**ë¹„ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­ 3ë²ˆì§¸ ì ìš©:**
> "ìƒìœ„ì—ëŠ” í•­ìƒ ì„ íƒëœ ë¦¬íŠ¼ëª…ì´ë‚˜, í˜„ì¬ ë“£ê¸°ì´ë‚˜, ì“°ê¸°ë‚˜, í•„ê¸°ì¤‘ì¸ íŒŒì¼ëª…ì´ í‘œì‹œ"

```dart
class TopStatusBar extends StatelessWidget implements PreferredSizeWidget {
  final String? currentLitenName;
  final String? currentFileName;
  final String currentTabType; // 'home', 'recording', 'writing', 'handwriting', 'settings'
  final bool isRecording;
  final bool isEditing;
  final VoidCallback? onTitleTap;
  
  const TopStatusBar({
    Key? key,
    this.currentLitenName,
    this.currentFileName,
    required this.currentTabType,
    this.isRecording = false,
    this.isEditing = false,
    this.onTitleTap,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return AppBar(
      backgroundColor: Theme.of(context).scaffoldBackgroundColor,
      elevation: 1,
      centerTitle: true,
      title: GestureDetector(
        onTap: onTitleTap,
        child: Container(
          padding: EdgeInsets.symmetric(horizontal: 12, vertical: 6),
          decoration: BoxDecoration(
            color: _getStatusColor().withOpacity(0.1),
            borderRadius: BorderRadius.circular(16),
            border: Border.all(color: _getStatusColor().withOpacity(0.3)),
          ),
          child: Row(
            mainAxisSize: MainAxisSize.min,
            children: [
              _buildStatusIcon(),
              SizedBox(width: 8),
              Flexible(
                child: Column(
                  mainAxisSize: MainAxisSize.min,
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      _getDisplayTitle(),
                      style: TextStyle(
                        fontSize: 14,
                        fontWeight: FontWeight.w600,
                        color: _getStatusColor(),
                      ),
                      maxLines: 1,
                      overflow: TextOverflow.ellipsis,
                    ),
                    if (_getSubtitle().isNotEmpty)
                      Text(
                        _getSubtitle(),
                        style: TextStyle(
                          fontSize: 10,
                          color: _getStatusColor().withOpacity(0.7),
                        ),
                        maxLines: 1,
                        overflow: TextOverflow.ellipsis,
                      ),
                  ],
                ),
              ),
              if (isRecording || isEditing) ...[
                SizedBox(width: 8),
                _buildActivityIndicator(),
              ],
            ],
          ),
        ),
      ),
      actions: [
        if (currentTabType != 'home' && currentTabType != 'settings')
          IconButton(
            icon: Icon(Icons.more_vert),
            onPressed: () => _showFileContextMenu(context),
          ),
      ],
    );
  }
  
  Widget _buildStatusIcon() {
    IconData icon;
    switch (currentTabType) {
      case 'recording':
        icon = Icons.mic;
        break;
      case 'writing':
        icon = Icons.edit;
        break;
      case 'handwriting':
        icon = Icons.draw;
        break;
      case 'settings':
        icon = Icons.settings;
        break;
      default:
        icon = Icons.folder;
    }
    
    return Icon(
      icon,
      size: 16,
      color: _getStatusColor(),
    );
  }
  
  Widget _buildActivityIndicator() {
    if (isRecording) {
      return Container(
        width: 8,
        height: 8,
        decoration: BoxDecoration(
          color: Colors.red,
          shape: BoxShape.circle,
        ),
        child: _buildPulsingAnimation(),
      );
    } else if (isEditing) {
      return Container(
        width: 6,
        height: 6,
        decoration: BoxDecoration(
          color: Colors.orange,
          shape: BoxShape.circle,
        ),
      );
    }
    return SizedBox.shrink();
  }
  
  Widget _buildPulsingAnimation() {
    return TweenAnimationBuilder(
      duration: Duration(milliseconds: 1000),
      tween: Tween<double>(begin: 0.3, end: 1.0),
      builder: (context, double value, child) {
        return Container(
          decoration: BoxDecoration(
            color: Colors.red.withOpacity(value),
            shape: BoxShape.circle,
          ),
        );
      },
    );
  }
  
  String _getDisplayTitle() {
    switch (currentTabType) {
      case 'home':
        return currentLitenName ?? 'ë¦¬íŠ¼';
      case 'recording':
        return currentFileName ?? 'ìƒˆ ë…¹ìŒ';
      case 'writing':
        return currentFileName ?? 'ìƒˆ í…ìŠ¤íŠ¸';
      case 'handwriting':
        return currentFileName ?? 'ìƒˆ í•„ê¸°';
      case 'settings':
        return 'ì„¤ì •';
      default:
        return 'ë¦¬íŠ¼';
    }
  }
  
  String _getSubtitle() {
    switch (currentTabType) {
      case 'home':
        return ''; // í™ˆì—ì„œëŠ” ì„œë¸Œíƒ€ì´í‹€ ì—†ìŒ
      case 'recording':
        if (isRecording) return 'ë…¹ìŒ ì¤‘...';
        return currentLitenName ?? '';
      case 'writing':
        if (isEditing) return 'í¸ì§‘ ì¤‘...';
        return currentLitenName ?? '';
      case 'handwriting':
        if (isEditing) return 'í•„ê¸° ì¤‘...';
        return currentLitenName ?? '';
      case 'settings':
        return '';
      default:
        return '';
    }
  }
  
  Color _getStatusColor() {
    switch (currentTabType) {
      case 'recording':
        return Colors.red;
      case 'writing':
        return Colors.blue;
      case 'handwriting':
        return Colors.green;
      case 'settings':
        return Colors.grey;
      default:
        return Theme.of(context).primaryColor;
    }
  }
  
  void _showFileContextMenu(BuildContext context) {
    showModalBottomSheet(
      context: context,
      builder: (context) => FileContextMenu(
        fileName: currentFileName ?? '',
        littenName: currentLitenName ?? '',
        fileType: currentTabType,
      ),
    );
  }
  
  @override
  Size get preferredSize => Size.fromHeight(kToolbarHeight);
}
```

### 16.2 FileContextMenu íŒŒì¼ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´

```dart
class FileContextMenu extends StatelessWidget {
  final String fileName;
  final String littenName;
  final String fileType;
  
  const FileContextMenu({
    Key? key,
    required this.fileName,
    required this.littenName,
    required this.fileType,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: EdgeInsets.symmetric(vertical: 20),
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          // í—¤ë”
          Padding(
            padding: EdgeInsets.symmetric(horizontal: 20),
            child: Column(
              children: [
                Text(
                  fileName,
                  style: TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.w600,
                  ),
                  maxLines: 1,
                  overflow: TextOverflow.ellipsis,
                ),
                SizedBox(height: 4),
                Text(
                  'ë¦¬íŠ¼: $littenName',
                  style: TextStyle(
                    fontSize: 14,
                    color: Colors.grey.shade600,
                  ),
                ),
              ],
            ),
          ),
          
          SizedBox(height: 20),
          
          // ë©”ë‰´ í•­ëª©ë“¤
          _buildMenuItem(
            icon: Icons.edit,
            title: 'ì´ë¦„ ë³€ê²½',
            onTap: () => _renameFile(context),
          ),
          _buildMenuItem(
            icon: Icons.copy,
            title: 'ë³µì‚¬',
            onTap: () => _copyFile(context),
          ),
          _buildMenuItem(
            icon: Icons.share,
            title: 'ê³µìœ ',
            onTap: () => _shareFile(context),
          ),
          if (fileType != 'recording') // ë…¹ìŒ íŒŒì¼ì€ ë³€í™˜ ì œì™¸
            _buildMenuItem(
              icon: Icons.transform,
              title: 'ë³€í™˜',
              onTap: () => _convertFile(context),
            ),
          _buildMenuItem(
            icon: Icons.folder,
            title: 'ë‹¤ë¥¸ ë¦¬íŠ¼ìœ¼ë¡œ ì´ë™',
            onTap: () => _moveFile(context),
          ),
          Divider(),
          _buildMenuItem(
            icon: Icons.delete,
            title: 'ì‚­ì œ',
            color: Colors.red,
            onTap: () => _deleteFile(context),
          ),
        ],
      ),
    );
  }
  
  Widget _buildMenuItem({
    required IconData icon,
    required String title,
    required VoidCallback onTap,
    Color? color,
  }) {
    return ListTile(
      leading: Icon(icon, color: color),
      title: Text(
        title,
        style: TextStyle(color: color),
      ),
      onTap: onTap,
    );
  }
  
  void _renameFile(BuildContext context) {
    Navigator.pop(context);
    // ì´ë¦„ ë³€ê²½ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
  }
  
  void _copyFile(BuildContext context) {
    Navigator.pop(context);
    // íŒŒì¼ ë³µì‚¬ ë¡œì§
  }
  
  void _shareFile(BuildContext context) {
    Navigator.pop(context);
    // íŒŒì¼ ê³µìœ  ë¡œì§
  }
  
  void _convertFile(BuildContext context) {
    Navigator.pop(context);
    // íŒŒì¼ ë³€í™˜ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
  }
  
  void _moveFile(BuildContext context) {
    Navigator.pop(context);
    // ë¦¬íŠ¼ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
  }
  
  void _deleteFile(BuildContext context) {
    Navigator.pop(context);
    // ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
  }
}
```

### 16.3 TopStatusBarProvider ìƒíƒœ ê´€ë¦¬

```dart
class TopStatusBarProvider extends ChangeNotifier {
  String? _currentLitenName;
  String? _currentFileName;
  String _currentTabType = 'home';
  bool _isRecording = false;
  bool _isEditing = false;
  
  String? get currentLitenName => _currentLitenName;
  String? get currentFileName => _currentFileName;
  String get currentTabType => _currentTabType;
  bool get isRecording => _isRecording;
  bool get isEditing => _isEditing;
  
  // ë¦¬íŠ¼ ë³€ê²½
  void setCurrentLiten(String? littenName) {
    _currentLitenName = littenName;
    notifyListeners();
  }
  
  // íŒŒì¼ ë³€ê²½
  void setCurrentFile(String? fileName) {
    _currentFileName = fileName;
    notifyListeners();
  }
  
  // íƒ­ ë³€ê²½
  void setCurrentTab(String tabType) {
    _currentTabType = tabType;
    notifyListeners();
  }
  
  // ë…¹ìŒ ìƒíƒœ ë³€ê²½
  void setRecordingState(bool recording) {
    _isRecording = recording;
    notifyListeners();
  }
  
  // í¸ì§‘ ìƒíƒœ ë³€ê²½
  void setEditingState(bool editing) {
    _isEditing = editing;
    notifyListeners();
  }
  
  // ìƒíƒœ ì´ˆê¸°í™”
  void reset() {
    _currentLitenName = null;
    _currentFileName = null;
    _currentTabType = 'home';
    _isRecording = false;
    _isEditing = false;
    notifyListeners();
  }
}
```

### 16.4 MainScreenì—ì„œ TopStatusBar ì‚¬ìš©

```dart
class MainScreen extends StatefulWidget {
  @override
  _MainScreenState createState() => _MainScreenState();
}

class _MainScreenState extends State<MainScreen> {
  int _currentIndex = 0;
  final TopStatusBarProvider _statusBarProvider = TopStatusBarProvider();
  
  @override
  Widget build(BuildContext context) {
    return ChangeNotifierProvider.value(
      value: _statusBarProvider,
      child: Scaffold(
        appBar: Consumer<TopStatusBarProvider>(
          builder: (context, provider, child) {
            return TopStatusBar(
              currentLitenName: provider.currentLitenName,
              currentFileName: provider.currentFileName,
              currentTabType: provider.currentTabType,
              isRecording: provider.isRecording,
              isEditing: provider.isEditing,
              onTitleTap: () => _showLitenSelector(),
            );
          },
        ),
        body: Column(
          children: [
            // ë¬´ë£Œ ì‚¬ìš©ììš© ê´‘ê³  ë°°ë„ˆ
            if (UserSubscriptionService.isFreeUser())
              AdBanner(),
            
            // ë©”ì¸ ì½˜í…ì¸ 
            Expanded(
              child: IndexedStack(
                index: _currentIndex,
                children: [
                  HomeTab(onStatusChange: _updateStatus),
                  RecordingTab(onStatusChange: _updateStatus),
                  WritingTab(onStatusChange: _updateStatus),
                  HandwritingTab(onStatusChange: _updateStatus),
                  SettingsTab(onStatusChange: _updateStatus),
                ],
              ),
            ),
          ],
        ),
        bottomNavigationBar: BottomNavigationBar(
          currentIndex: _currentIndex,
          onTap: (index) {
            setState(() => _currentIndex = index);
            _updateTabType(index);
          },
          type: BottomNavigationBarType.fixed,
          items: [
            BottomNavigationBarItem(icon: Icon(Icons.home), label: 'í™ˆ'),
            BottomNavigationBarItem(icon: Icon(Icons.mic), label: 'ë“£ê¸°'),
            BottomNavigationBarItem(icon: Icon(Icons.edit), label: 'ì“°ê¸°'),
            BottomNavigationBarItem(icon: Icon(Icons.draw), label: 'í•„ê¸°'),
            BottomNavigationBarItem(icon: Icon(Icons.settings), label: 'ì„¤ì •'),
          ],
        ),
      ),
    );
  }
  
  void _updateStatus({
    String? littenName,
    String? fileName,
    bool? isRecording,
    bool? isEditing,
  }) {
    if (littenName != null) _statusBarProvider.setCurrentLiten(littenName);
    if (fileName != null) _statusBarProvider.setCurrentFile(fileName);
    if (isRecording != null) _statusBarProvider.setRecordingState(isRecording);
    if (isEditing != null) _statusBarProvider.setEditingState(isEditing);
  }
  
  void _updateTabType(int index) {
    const tabTypes = ['home', 'recording', 'writing', 'handwriting', 'settings'];
    _statusBarProvider.setCurrentTab(tabTypes[index]);
  }
  
  void _showLitenSelector() {
    // ë¦¬íŠ¼ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
    showDialog(
      context: context,
      builder: (context) => LitenSelectorDialog(
        currentLiten: _statusBarProvider.currentLitenName,
        onLitenSelected: (littenName) {
          _statusBarProvider.setCurrentLiten(littenName);
        },
      ),
    );
  }
}
```

ì´ì œ **ë¹„ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­ì˜ ì„¸ ê°€ì§€ ì‚¬í•­**ì´ ëª¨ë‘ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤:

1. âœ… **ì‹œìŠ¤í…œ ì–¸ì–´ ìë™ ê°ì§€** - WelcomeScreenì—ì„œ 31ê°œ ì§€ì› ì–¸ì–´ ìë™ ê°ì§€
2. âœ… **êµ­ê°€ë³„ í…Œë§ˆ ìë™ ì„ íƒ** - ì§€ì—­ë³„ ì„ í˜¸ í…Œë§ˆ ìë™ ë§¤í•‘ (5ê°€ì§€ í…Œë§ˆ)
3. âœ… **ìƒë‹¨ ìƒíƒœ í‘œì‹œ** - TopStatusBarë¡œ í˜„ì¬ ë¦¬íŠ¼ëª…/íŒŒì¼ëª… í•­ìƒ í‘œì‹œ
4. âœ… **UUID ìƒì„± ë° ì„œë²„ ë“±ë¡** - ì•± ì„¤ì¹˜ ì‹œ ê³ ìœ  ì•„ì´ë”” ìƒì„± í›„ ì„œë²„ ë“±ë¡

## ì—…ë°ì´íŠ¸ ì™„ë£Œ ì‚¬í•­

ì´ **14ê°€ì§€ ì£¼ìš” ì»´í¬ë„ŒíŠ¸**ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤:

### UI ê°œì„  ì‚¬í•­ (10ê°€ì§€)
1. âœ… **ê´‘ê³  í‘œì‹œ UI** - ë¬´ë£Œ ì‚¬ìš©ììš© AdBanner ì»´í¬ë„ŒíŠ¸
2. âœ… **ë¬´ë£Œ/ìœ ë£Œ ì°¨ë³„í™” UI** - í”„ë¦¬ë¯¸ì—„ ì—…ê·¸ë ˆì´ë“œ ë‹¤ì´ì–¼ë¡œê·¸
3. âœ… **5ê°€ì§€ í…Œë§ˆ ì‹œìŠ¤í…œ** - ì™„ì „í•œ í…Œë§ˆ ì„ íƒ ë° ê´€ë¦¬ UI
4. âœ… **ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° ë„êµ¬ë°”** - ë§ˆí¬ë‹¤ìš´ ì§€ì› ë„êµ¬ë°”
5. âœ… **ìŒì„± ë¶ë§ˆí¬ ê¸°ëŠ¥ UI** - íƒ€ì„ìŠ¤íƒ¬í”„ ë¶ë§ˆí¬ ì‹œìŠ¤í…œ
6. âœ… **30ê°œ ì–¸ì–´ êµ­ì œí™” UI** - ì–¸ì–´ ì„ íƒ ë° ì „í™˜ ì¸í„°í˜ì´ìŠ¤
7. âœ… **íŒŒì¼ ë³€í™˜ í”„ë¡œì„¸ìŠ¤ UI** - í¬ë§· ë³€í™˜ ì§„í–‰ ìƒí™© í‘œì‹œ
8. âœ… **ì™„ì „í•œ ì„¤ì • í™”ë©´** - ëª¨ë“ˆì‹ ì„¤ì • ì¹´ë“œ êµ¬ì¡°
9. âœ… **í•„ê¸° ë„êµ¬ ìƒì„¸ UI** - 9ê°€ì§€ ì „ë¬¸ í•„ê¸° ë„êµ¬
10. âœ… **ê²€ìƒ‰ ë° ì˜¨ë³´ë”© UI** - í†µí•© ê²€ìƒ‰ ì‹œìŠ¤í…œ ë° 5ë‹¨ê³„ ì˜¨ë³´ë”©

### ë¹„ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­ (4ê°€ì§€)
11. âœ… **ì‹œìŠ¤í…œ ì–¸ì–´ ìë™ ê°ì§€** - ì„¤ì¹˜ ì‹œ 30ê°œ ì–¸ì–´ ìë™ ë§¤í•‘
12. âœ… **êµ­ê°€ë³„ í…Œë§ˆ ìë™ ì„ íƒ** - ì§€ì—­ë³„ ì„ í˜¸ í…Œë§ˆ ìë™ ì„¤ì • 
13. âœ… **ìƒë‹¨ ìƒíƒœ í‘œì‹œ** - TopStatusBarë¡œ í˜„ì¬ ìƒíƒœ ì‹¤ì‹œê°„ í‘œì‹œ
14. âœ… **UUID ìƒì„± ë° ì„œë²„ ë“±ë¡** - ì•± ê³ ìœ  ì•„ì´ë”” ìƒì„± ì‹œìŠ¤í…œ
15. âœ… **ìŒì„±-ì“°ê¸° ë™ê¸°í™” ê¸°ëŠ¥** - í•„ê¸° ì‹œì ê³¼ ìŒì„± ì¬ìƒ ì‹œê°„ ì—°ê²° ì €ì¥

## ê²°ë¡ 

================================================================================

15. ìŒì„± ë…¹ìŒ/ì¬ìƒ ì„œë¹„ìŠ¤ (AudioService)

================================================================================

ìŒì„± ë…¹ìŒê³¼ ì¬ìƒì„ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

```dart
import 'dart:io';
import 'dart:async';
import 'package:flutter/foundation.dart';
import 'package:audioplayers/audioplayers.dart';
import 'package:record/record.dart';
import 'package:path_provider/path_provider.dart';
import 'package:permission_handler/permission_handler.dart';

class AudioService extends ChangeNotifier {
  // ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤
  static final AudioService _instance = AudioService._internal();
  factory AudioService() => _instance;
  AudioService._internal();

  // ì˜¤ë””ì˜¤ ê´€ë ¨ ì¸ìŠ¤í„´ìŠ¤
  final AudioRecorder _recorder = AudioRecorder();
  final AudioPlayer _player = AudioPlayer();
  
  // ë…¹ìŒ ìƒíƒœ
  bool _isRecording = false;
  bool _isRecordingPaused = false;
  Duration _recordingDuration = Duration.zero;
  Timer? _recordingTimer;
  String? _currentRecordingPath;
  
  // ì¬ìƒ ìƒíƒœ
  bool _isPlaying = false;
  bool _isPlayingPaused = false;
  Duration _playingDuration = Duration.zero;
  Duration _totalDuration = Duration.zero;
  double _playbackSpeed = 1.0;
  String? _currentPlayingPath;
  Timer? _playingTimer;
  
  // ë¶ë§ˆí¬ ê´€ë¦¬
  List<VoiceBookmark> _bookmarks = [];
  
  // ì„¤ì •
  String _audioQuality = 'high'; // high, medium, low
  int _maxRecordingMinutes = 60; // ê¸°ë³¸ 1ì‹œê°„
  int _autoSaveInterval = 60; // 60ì´ˆë§ˆë‹¤ ìë™ ì €ì¥
  
  // Getters - ë…¹ìŒ ê´€ë ¨
  bool get isRecording => _isRecording;
  bool get isRecordingPaused => _isRecordingPaused;
  Duration get recordingDuration => _recordingDuration;
  String? get currentRecordingPath => _currentRecordingPath;
  
  // Getters - ì¬ìƒ ê´€ë ¨
  bool get isPlaying => _isPlaying;
  bool get isPlayingPaused => _isPlayingPaused;
  Duration get playingDuration => _playingDuration;
  Duration get totalDuration => _totalDuration;
  double get playbackSpeed => _playbackSpeed;
  String? get currentPlayingPath => _currentPlayingPath;
  double get playingProgress => _totalDuration.inMilliseconds > 0 
      ? _playingDuration.inMilliseconds / _totalDuration.inMilliseconds 
      : 0.0;
  
  // Getters - ê¸°íƒ€
  List<VoiceBookmark> get bookmarks => List.unmodifiable(_bookmarks);
  String get audioQuality => _audioQuality;
  int get maxRecordingMinutes => _maxRecordingMinutes;
  
  /// ì´ˆê¸°í™” ë° ê¶Œí•œ í™•ì¸
  Future<bool> initialize() async {
    try {
      // ë§ˆì´í¬ ê¶Œí•œ ìš”ì²­
      final microphoneStatus = await Permission.microphone.request();
      if (microphoneStatus != PermissionStatus.granted) {
        return false;
      }
      
      // ì €ì¥ì†Œ ê¶Œí•œ ìš”ì²­ (Android)
      if (Platform.isAndroid) {
        final storageStatus = await Permission.storage.request();
        if (storageStatus != PermissionStatus.granted) {
          return false;
        }
      }
      
      // ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      _setupPlayerListeners();
      
      return true;
    } catch (e) {
      debugPrint('AudioService ì´ˆê¸°í™” ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
  void _setupPlayerListeners() {
    _player.onDurationChanged.listen((duration) {
      _totalDuration = duration;
      notifyListeners();
    });
    
    _player.onPositionChanged.listen((position) {
      _playingDuration = position;
      notifyListeners();
    });
    
    _player.onPlayerComplete.listen((_) {
      _stopPlaying();
    });
  }
  
  // ========================================
  // ë…¹ìŒ ê¸°ëŠ¥
  // ========================================
  
  /// ë…¹ìŒ ì‹œì‘
  Future<bool> startRecording({String? fileName}) async {
    try {
      if (_isRecording) return false;
      
      // íŒŒì¼ ê²½ë¡œ ìƒì„±
      final directory = await getApplicationDocumentsDirectory();
      final recordingsDir = Directory('${directory.path}/recordings');
      if (!await recordingsDir.exists()) {
        await recordingsDir.create(recursive: true);
      }
      
      final timestamp = DateTime.now().millisecondsSinceEpoch;
      final name = fileName ?? 'recording_$timestamp';
      _currentRecordingPath = '${recordingsDir.path}/$name.m4a';
      
      // ë…¹ìŒ ì„¤ì •
      final config = RecordConfig(
        encoder: _getAudioEncoder(),
        bitRate: _getAudioBitRate(),
        sampleRate: _getAudioSampleRate(),
      );
      
      // ë…¹ìŒ ì‹œì‘
      await _recorder.start(config, path: _currentRecordingPath!);
      
      _isRecording = true;
      _isRecordingPaused = false;
      _recordingDuration = Duration.zero;
      
      // ë…¹ìŒ ì‹œê°„ íƒ€ì´ë¨¸ ì‹œì‘
      _startRecordingTimer();
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ë…¹ìŒ ì‹œì‘ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ë…¹ìŒ ì¼ì‹œì •ì§€
  Future<bool> pauseRecording() async {
    try {
      if (!_isRecording || _isRecordingPaused) return false;
      
      await _recorder.pause();
      _isRecordingPaused = true;
      _recordingTimer?.cancel();
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ë…¹ìŒ ì¼ì‹œì •ì§€ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ë…¹ìŒ ì¬ê°œ
  Future<bool> resumeRecording() async {
    try {
      if (!_isRecording || !_isRecordingPaused) return false;
      
      await _recorder.resume();
      _isRecordingPaused = false;
      _startRecordingTimer();
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ë…¹ìŒ ì¬ê°œ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ë…¹ìŒ ì¤‘ì§€ ë° ì €ì¥
  Future<String?> stopRecording() async {
    try {
      if (!_isRecording) return null;
      
      final path = await _recorder.stop();
      
      _isRecording = false;
      _isRecordingPaused = false;
      _recordingTimer?.cancel();
      
      final savedPath = _currentRecordingPath;
      _currentRecordingPath = null;
      _recordingDuration = Duration.zero;
      
      notifyListeners();
      return savedPath;
    } catch (e) {
      debugPrint('ë…¹ìŒ ì¤‘ì§€ ì‹¤íŒ¨: $e');
      return null;
    }
  }
  
  /// ë…¹ìŒ ì·¨ì†Œ (íŒŒì¼ ì‚­ì œ)
  Future<bool> cancelRecording() async {
    try {
      if (!_isRecording) return false;
      
      await _recorder.stop();
      
      // ì„ì‹œ íŒŒì¼ ì‚­ì œ
      if (_currentRecordingPath != null) {
        final file = File(_currentRecordingPath!);
        if (await file.exists()) {
          await file.delete();
        }
      }
      
      _isRecording = false;
      _isRecordingPaused = false;
      _recordingTimer?.cancel();
      _currentRecordingPath = null;
      _recordingDuration = Duration.zero;
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ë…¹ìŒ ì·¨ì†Œ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ë…¹ìŒ ì‹œê°„ íƒ€ì´ë¨¸ ì‹œì‘
  void _startRecordingTimer() {
    _recordingTimer = Timer.periodic(Duration(seconds: 1), (timer) {
      _recordingDuration = Duration(seconds: _recordingDuration.inSeconds + 1);
      
      // ìµœëŒ€ ë…¹ìŒ ì‹œê°„ ì²´í¬
      if (_recordingDuration.inMinutes >= _maxRecordingMinutes) {
        stopRecording();
        return;
      }
      
      notifyListeners();
    });
  }
  
  // ========================================
  // ì¬ìƒ ê¸°ëŠ¥
  // ========================================
  
  /// ì˜¤ë””ì˜¤ íŒŒì¼ ì¬ìƒ
  Future<bool> playAudio(String filePath) async {
    try {
      // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ íŒŒì¼ì´ ìˆë‹¤ë©´ ì¤‘ì§€
      if (_isPlaying) {
        await stopPlaying();
      }
      
      await _player.play(DeviceFileSource(filePath));
      await _player.setPlaybackRate(_playbackSpeed);
      
      _isPlaying = true;
      _isPlayingPaused = false;
      _currentPlayingPath = filePath;
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ì¬ìƒ ì¼ì‹œì •ì§€
  Future<bool> pausePlaying() async {
    try {
      if (!_isPlaying || _isPlayingPaused) return false;
      
      await _player.pause();
      _isPlayingPaused = true;
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ì¬ìƒ ì¼ì‹œì •ì§€ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ì¬ìƒ ì¬ê°œ
  Future<bool> resumePlaying() async {
    try {
      if (!_isPlaying || !_isPlayingPaused) return false;
      
      await _player.resume();
      _isPlayingPaused = false;
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ì¬ìƒ ì¬ê°œ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ì¬ìƒ ì¤‘ì§€
  Future<bool> stopPlaying() async {
    try {
      await _player.stop();
      _stopPlaying();
      return true;
    } catch (e) {
      debugPrint('ì¬ìƒ ì¤‘ì§€ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  void _stopPlaying() {
    _isPlaying = false;
    _isPlayingPaused = false;
    _playingDuration = Duration.zero;
    _totalDuration = Duration.zero;
    _currentPlayingPath = null;
    notifyListeners();
  }
  
  /// ì¬ìƒ ìœ„ì¹˜ ë³€ê²½
  Future<bool> seekTo(Duration position) async {
    try {
      await _player.seek(position);
      _playingDuration = position;
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ì¬ìƒ ìœ„ì¹˜ ë³€ê²½ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ì¬ìƒ ì†ë„ ë³€ê²½
  Future<bool> setPlaybackSpeed(double speed) async {
    try {
      if (speed < 0.5 || speed > 2.0) return false;
      
      _playbackSpeed = speed;
      if (_isPlaying) {
        await _player.setPlaybackRate(speed);
      }
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ì¬ìƒ ì†ë„ ë³€ê²½ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  // ========================================
  // ë¶ë§ˆí¬ ê¸°ëŠ¥
  // ========================================
  
  /// ë¶ë§ˆí¬ ì¶”ê°€
  VoiceBookmark addBookmark({
    required String audioFileId,
    required Duration timestamp,
    String? label,
  }) {
    final bookmark = VoiceBookmark(
      id: DateTime.now().millisecondsSinceEpoch.toString(),
      audioFileId: audioFileId,
      timestamp: timestamp,
      label: label ?? 'ë¶ë§ˆí¬ ${_bookmarks.length + 1}',
      createdAt: DateTime.now(),
    );
    
    _bookmarks.add(bookmark);
    _bookmarks.sort((a, b) => a.timestamp.compareTo(b.timestamp));
    
    notifyListeners();
    return bookmark;
  }
  
  /// ë¶ë§ˆí¬ ì‚­ì œ
  bool removeBookmark(String bookmarkId) {
    final index = _bookmarks.indexWhere((b) => b.id == bookmarkId);
    if (index != -1) {
      _bookmarks.removeAt(index);
      notifyListeners();
      return true;
    }
    return false;
  }
  
  /// ë¶ë§ˆí¬ë¡œ ì´ë™
  Future<bool> jumpToBookmark(VoiceBookmark bookmark) async {
    try {
      if (_currentPlayingPath?.contains(bookmark.audioFileId) == true) {
        return await seekTo(bookmark.timestamp);
      } else {
        // í•´ë‹¹ ì˜¤ë””ì˜¤ íŒŒì¼ ì¬ìƒ í›„ ë¶ë§ˆí¬ ìœ„ì¹˜ë¡œ ì´ë™
        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” íŒŒì¼ ê²½ë¡œë¥¼ ì°¾ëŠ” ë¡œì§ í•„ìš”
        return false;
      }
    } catch (e) {
      debugPrint('ë¶ë§ˆí¬ ì´ë™ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// íŠ¹ì • ì˜¤ë””ì˜¤ íŒŒì¼ì˜ ë¶ë§ˆí¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
  List<VoiceBookmark> getBookmarksForAudio(String audioFileId) {
    return _bookmarks.where((b) => b.audioFileId == audioFileId).toList();
  }
  
  // ========================================
  // ì„¤ì • ê´€ë¦¬
  // ========================================
  
  /// ì˜¤ë””ì˜¤ í’ˆì§ˆ ì„¤ì •
  void setAudioQuality(String quality) {
    if (['high', 'medium', 'low'].contains(quality)) {
      _audioQuality = quality;
      notifyListeners();
    }
  }
  
  /// ìµœëŒ€ ë…¹ìŒ ì‹œê°„ ì„¤ì • (ë¶„)
  void setMaxRecordingMinutes(int minutes) {
    if (minutes > 0 && minutes <= 180) { // ìµœëŒ€ 3ì‹œê°„
      _maxRecordingMinutes = minutes;
      notifyListeners();
    }
  }
  
  /// ìë™ ì €ì¥ ê°„ê²© ì„¤ì • (ì´ˆ)
  void setAutoSaveInterval(int seconds) {
    if (seconds >= 10 && seconds <= 600) { // 10ì´ˆ~10ë¶„
      _autoSaveInterval = seconds;
      notifyListeners();
    }
  }
  
  // ========================================
  // í—¬í¼ ë©”ì„œë“œ
  // ========================================
  
  /// ì˜¤ë””ì˜¤ ì—”ì½”ë” ê°€ì ¸ì˜¤ê¸°
  AudioEncoder _getAudioEncoder() {
    switch (_audioQuality) {
      case 'high':
        return AudioEncoder.aacLc;
      case 'medium':
        return AudioEncoder.aacHe;
      case 'low':
        return AudioEncoder.opus;
      default:
        return AudioEncoder.aacLc;
    }
  }
  
  /// ì˜¤ë””ì˜¤ ë¹„íŠ¸ë ˆì´íŠ¸ ê°€ì ¸ì˜¤ê¸°
  int _getAudioBitRate() {
    switch (_audioQuality) {
      case 'high':
        return 192000; // 192 kbps
      case 'medium':
        return 128000; // 128 kbps
      case 'low':
        return 64000;  // 64 kbps
      default:
        return 128000;
    }
  }
  
  /// ì˜¤ë””ì˜¤ ìƒ˜í”Œë ˆì´íŠ¸ ê°€ì ¸ì˜¤ê¸°
  int _getAudioSampleRate() {
    switch (_audioQuality) {
      case 'high':
        return 48000; // 48 kHz
      case 'medium':
        return 44100; // 44.1 kHz
      case 'low':
        return 22050; // 22.05 kHz
      default:
        return 44100;
    }
  }
  
  /// ì‹œê°„ í¬ë§·íŒ…
  String formatDuration(Duration duration) {
    String twoDigits(int n) => n.toString().padLeft(2, '0');
    final hours = duration.inHours;
    final minutes = duration.inMinutes.remainder(60);
    final seconds = duration.inSeconds.remainder(60);
    
    if (hours > 0) {
      return '${twoDigits(hours)}:${twoDigits(minutes)}:${twoDigits(seconds)}';
    } else {
      return '${twoDigits(minutes)}:${twoDigits(seconds)}';
    }
  }
  
  /// ë¦¬ì†ŒìŠ¤ ì •ë¦¬
  @override
  void dispose() {
    _recordingTimer?.cancel();
    _playingTimer?.cancel();
    _recorder.dispose();
    _player.dispose();
    super.dispose();
  }
}

/// ìŒì„± ë¶ë§ˆí¬ ë°ì´í„° í´ë˜ìŠ¤
class VoiceBookmark {
  final String id;
  final String audioFileId;
  final Duration timestamp;
  final String label;
  final DateTime createdAt;

  VoiceBookmark({
    required this.id,
    required this.audioFileId,
    required this.timestamp,
    required this.label,
    required this.createdAt,
  });

  Map<String, dynamic> toJson() => {
    'id': id,
    'audioFileId': audioFileId,
    'timestamp': timestamp.inMilliseconds,
    'label': label,
    'createdAt': createdAt.toIso8601String(),
  };

  factory VoiceBookmark.fromJson(Map<String, dynamic> json) => VoiceBookmark(
    id: json['id'],
    audioFileId: json['audioFileId'],
    timestamp: Duration(milliseconds: json['timestamp']),
    label: json['label'],
    createdAt: DateTime.parse(json['createdAt']),
  );
}
```

================================================================================

16. í…ìŠ¤íŠ¸ ì—ë””í„° ì„œë¹„ìŠ¤ (TextEditorService)

================================================================================

í…ìŠ¤íŠ¸ í¸ì§‘, ë§ˆí¬ë‹¤ìš´ ì²˜ë¦¬, ìë™ì €ì¥ì„ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

```dart
import 'dart:io';
import 'dart:async';
import 'dart:convert';
import 'package:flutter/foundation.dart';
import 'package:flutter_quill/flutter_quill.dart';
import 'package:path_provider/path_provider.dart';
import 'package:shared_preferences/shared_preferences.dart';

class TextEditorService extends ChangeNotifier {
  // ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤
  static final TextEditorService _instance = TextEditorService._internal();
  factory TextEditorService() => _instance;
  TextEditorService._internal();

  // Quill ì—ë””í„° ì»¨íŠ¸ë¡¤ëŸ¬
  QuillController? _quillController;
  
  // í˜„ì¬ ë¬¸ì„œ ì •ë³´
  String? _currentDocumentId;
  String? _currentDocumentPath;
  String _currentTitle = '';
  bool _hasUnsavedChanges = false;
  DateTime? _lastSaved;
  
  // ìë™ì €ì¥ ê´€ë ¨
  Timer? _autoSaveTimer;
  int _autoSaveInterval = 60; // 60ì´ˆ ê¸°ë³¸ê°’
  bool _autoSaveEnabled = true;
  
  // í¸ì§‘ ì„¤ì •
  bool _markdownMode = false;
  String _defaultFont = 'Roboto';
  double _defaultFontSize = 16.0;
  int _maxUndoHistory = 100;
  
  // ê²€ìƒ‰ ë° êµì²´
  String _lastSearchTerm = '';
  List<int> _searchResults = [];
  int _currentSearchIndex = -1;
  
  // ë‹¨ì–´ ìˆ˜ ë° í†µê³„
  int _wordCount = 0;
  int _characterCount = 0;
  int _paragraphCount = 0;
  
  // Getters
  QuillController? get quillController => _quillController;
  String? get currentDocumentId => _currentDocumentId;
  String? get currentDocumentPath => _currentDocumentPath;
  String get currentTitle => _currentTitle;
  bool get hasUnsavedChanges => _hasUnsavedChanges;
  DateTime? get lastSaved => _lastSaved;
  bool get autoSaveEnabled => _autoSaveEnabled;
  int get autoSaveInterval => _autoSaveInterval;
  bool get markdownMode => _markdownMode;
  String get defaultFont => _defaultFont;
  double get defaultFontSize => _defaultFontSize;
  int get wordCount => _wordCount;
  int get characterCount => _characterCount;
  int get paragraphCount => _paragraphCount;
  List<int> get searchResults => _searchResults;
  int get currentSearchIndex => _currentSearchIndex;
  
  /// ì´ˆê¸°í™”
  Future<bool> initialize() async {
    try {
      // ì„¤ì • ë¡œë“œ
      await _loadSettings();
      
      // ê¸°ë³¸ Quill ì»¨íŠ¸ë¡¤ëŸ¬ ìƒì„±
      _quillController = QuillController.basic();
      _setupQuillListeners();
      
      return true;
    } catch (e) {
      debugPrint('TextEditorService ì´ˆê¸°í™” ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// Quill ì»¨íŠ¸ë¡¤ëŸ¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
  void _setupQuillListeners() {
    _quillController?.document.changes.listen((_) {
      _hasUnsavedChanges = true;
      _updateStatistics();
      notifyListeners();
      
      // ìë™ì €ì¥ íƒ€ì´ë¨¸ ì¬ì‹œì‘
      if (_autoSaveEnabled) {
        _restartAutoSaveTimer();
      }
    });
  }
  
  // ========================================
  // ë¬¸ì„œ ê´€ë¦¬
  // ========================================
  
  /// ìƒˆ ë¬¸ì„œ ìƒì„±
  Future<bool> createNewDocument({String? title}) async {
    try {
      // ê¸°ì¡´ ë¬¸ì„œ ì €ì¥ í™•ì¸
      if (_hasUnsavedChanges) {
        await saveCurrentDocument();
      }
      
      // ìƒˆ ë¬¸ì„œ ID ìƒì„±
      _currentDocumentId = DateTime.now().millisecondsSinceEpoch.toString();
      _currentTitle = title ?? 'ì œëª© ì—†ëŠ” ë¬¸ì„œ';
      
      // íŒŒì¼ ê²½ë¡œ ìƒì„±
      final directory = await getApplicationDocumentsDirectory();
      final documentsDir = Directory('${directory.path}/documents');
      if (!await documentsDir.exists()) {
        await documentsDir.create(recursive: true);
      }
      
      _currentDocumentPath = '${documentsDir.path}/$_currentDocumentId.json';
      
      // Quill ì»¨íŠ¸ë¡¤ëŸ¬ ì´ˆê¸°í™”
      _quillController?.dispose();
      _quillController = QuillController.basic();
      _setupQuillListeners();
      
      _hasUnsavedChanges = false;
      _lastSaved = null;
      _updateStatistics();
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ìƒˆ ë¬¸ì„œ ìƒì„± ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ë¬¸ì„œ ì—´ê¸°
  Future<bool> openDocument(String documentPath) async {
    try {
      // ê¸°ì¡´ ë¬¸ì„œ ì €ì¥ í™•ì¸
      if (_hasUnsavedChanges) {
        await saveCurrentDocument();
      }
      
      final file = File(documentPath);
      if (!await file.exists()) {
        return false;
      }
      
      // ë¬¸ì„œ ë°ì´í„° ì½ê¸°
      final jsonString = await file.readAsString();
      final documentData = jsonDecode(jsonString);
      
      // ë¬¸ì„œ ì •ë³´ ì„¤ì •
      _currentDocumentPath = documentPath;
      _currentDocumentId = documentData['id'];
      _currentTitle = documentData['title'] ?? 'ì œëª© ì—†ëŠ” ë¬¸ì„œ';
      
      // Quill ë¬¸ì„œ ë¡œë“œ
      final delta = Delta.fromJson(documentData['content']);
      _quillController?.dispose();
      _quillController = QuillController(
        document: Document.fromDelta(delta),
        selection: const TextSelection.collapsed(offset: 0),
      );
      _setupQuillListeners();
      
      _hasUnsavedChanges = false;
      _lastSaved = DateTime.parse(documentData['lastSaved']);
      _updateStatistics();
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ë¬¸ì„œ ì—´ê¸° ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// í˜„ì¬ ë¬¸ì„œ ì €ì¥
  Future<bool> saveCurrentDocument() async {
    try {
      if (_currentDocumentPath == null || _quillController == null) {
        return false;
      }
      
      final documentData = {
        'id': _currentDocumentId,
        'title': _currentTitle,
        'content': _quillController!.document.toDelta().toJson(),
        'lastSaved': DateTime.now().toIso8601String(),
        'wordCount': _wordCount,
        'characterCount': _characterCount,
        'paragraphCount': _paragraphCount,
      };
      
      final file = File(_currentDocumentPath!);
      await file.writeAsString(jsonEncode(documentData));
      
      _hasUnsavedChanges = false;
      _lastSaved = DateTime.now();
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ë¬¸ì„œ ì €ì¥ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥
  Future<bool> saveDocumentAs(String newTitle, {String? customPath}) async {
    try {
      final oldPath = _currentDocumentPath;
      final oldId = _currentDocumentId;
      
      // ìƒˆ ë¬¸ì„œ ì •ë³´ ì„¤ì •
      _currentDocumentId = DateTime.now().millisecondsSinceEpoch.toString();
      _currentTitle = newTitle;
      
      if (customPath != null) {
        _currentDocumentPath = customPath;
      } else {
        final directory = await getApplicationDocumentsDirectory();
        final documentsDir = Directory('${directory.path}/documents');
        _currentDocumentPath = '${documentsDir.path}/$_currentDocumentId.json';
      }
      
      // ìƒˆ ê²½ë¡œì— ì €ì¥
      final success = await saveCurrentDocument();
      
      if (!success) {
        // ì‹¤íŒ¨ ì‹œ ì›ë˜ ì •ë³´ ë³µì›
        _currentDocumentPath = oldPath;
        _currentDocumentId = oldId;
        return false;
      }
      
      return true;
    } catch (e) {
      debugPrint('ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  // ========================================
  // í…ìŠ¤íŠ¸ í¸ì§‘ ê¸°ëŠ¥
  // ========================================
  
  /// í…ìŠ¤íŠ¸ ì‚½ì…
  void insertText(String text, {int? position}) {
    if (_quillController == null) return;
    
    final insertPosition = position ?? _quillController!.selection.baseOffset;
    _quillController!.document.insert(insertPosition, text);
    
    // ì»¤ì„œ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    _quillController!.updateSelection(
      TextSelection.collapsed(offset: insertPosition + text.length),
      ChangeSource.LOCAL,
    );
  }
  
  /// ì„ íƒëœ í…ìŠ¤íŠ¸ ì„œì‹ ì ìš©
  void applyFormat(Attribute attribute) {
    if (_quillController == null) return;
    
    final selection = _quillController!.selection;
    if (selection.isValid) {
      _quillController!.formatSelection(attribute);
    }
  }
  
  /// ë³¼ë“œ í† ê¸€
  void toggleBold() {
    applyFormat(Attribute.bold);
  }
  
  /// ì´íƒ¤ë¦­ í† ê¸€
  void toggleItalic() {
    applyFormat(Attribute.italic);
  }
  
  /// ë°‘ì¤„ í† ê¸€
  void toggleUnderline() {
    applyFormat(Attribute.underline);
  }
  
  /// í•˜ì´ë¼ì´íŠ¸ ì ìš©
  void applyHighlight(String color) {
    final attribute = BackgroundAttribute(color);
    applyFormat(attribute);
  }
  
  /// ê¸€ê¼´ í¬ê¸° ë³€ê²½
  void changeFontSize(double size) {
    final attribute = SizeAttribute(size.toString());
    applyFormat(attribute);
  }
  
  /// ê¸€ê¼´ ë³€ê²½
  void changeFontFamily(String fontFamily) {
    final attribute = FontAttribute(fontFamily);
    applyFormat(attribute);
  }
  
  /// ì •ë ¬ ë³€ê²½
  void changeAlignment(Attribute alignment) {
    applyFormat(alignment);
  }
  
  // ========================================
  // ë§ˆí¬ë‹¤ìš´ ê¸°ëŠ¥
  // ========================================
  
  /// ë§ˆí¬ë‹¤ìš´ ëª¨ë“œ í† ê¸€
  void toggleMarkdownMode() {
    _markdownMode = !_markdownMode;
    notifyListeners();
  }
  
  /// ë§ˆí¬ë‹¤ìš´ì„ Quill í˜•ì‹ìœ¼ë¡œ ë³€í™˜
  Future<bool> convertMarkdownToQuill(String markdown) async {
    try {
      // ê°„ë‹¨í•œ ë§ˆí¬ë‹¤ìš´ íŒŒì‹± (ì‹¤ì œë¡œëŠ” ë” ë³µì¡í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©)
      final delta = Delta();
      
      final lines = markdown.split('\n');
      for (final line in lines) {
        if (line.startsWith('# ')) {
          delta.insert(line.substring(2));
          delta.retain(1, {'header': 1});
        } else if (line.startsWith('## ')) {
          delta.insert(line.substring(3));
          delta.retain(1, {'header': 2});
        } else if (line.startsWith('**') && line.endsWith('**')) {
          delta.insert(line.substring(2, line.length - 2));
          delta.retain(1, {'bold': true});
        } else {
          delta.insert(line);
        }
        delta.insert('\n');
      }
      
      _quillController?.compose(delta, TextSelection.collapsed(offset: 0), ChangeSource.LOCAL);
      return true;
    } catch (e) {
      debugPrint('ë§ˆí¬ë‹¤ìš´ ë³€í™˜ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// Quill í˜•ì‹ì„ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ë³€í™˜
  String convertQuillToMarkdown() {
    if (_quillController == null) return '';
    
    // ê°„ë‹¨í•œ ë³€í™˜ ë¡œì§ (ì‹¤ì œë¡œëŠ” ë” ë³µì¡í•œ êµ¬í˜„ í•„ìš”)
    return _quillController!.document.toPlainText();
  }
  
  // ========================================
  // ê²€ìƒ‰ ë° êµì²´
  // ========================================
  
  /// í…ìŠ¤íŠ¸ ê²€ìƒ‰
  List<int> searchText(String searchTerm, {bool caseSensitive = false}) {
    if (_quillController == null || searchTerm.isEmpty) {
      _searchResults.clear();
      _currentSearchIndex = -1;
      notifyListeners();
      return [];
    }
    
    final text = _quillController!.document.toPlainText();
    final term = caseSensitive ? searchTerm : searchTerm.toLowerCase();
    final content = caseSensitive ? text : text.toLowerCase();
    
    _searchResults.clear();
    int index = 0;
    
    while (index < content.length) {
      final foundIndex = content.indexOf(term, index);
      if (foundIndex == -1) break;
      
      _searchResults.add(foundIndex);
      index = foundIndex + 1;
    }
    
    _lastSearchTerm = searchTerm;
    _currentSearchIndex = _searchResults.isNotEmpty ? 0 : -1;
    
    if (_searchResults.isNotEmpty) {
      _goToSearchResult(0);
    }
    
    notifyListeners();
    return _searchResults;
  }
  
  /// ë‹¤ìŒ ê²€ìƒ‰ ê²°ê³¼ë¡œ ì´ë™
  void goToNextSearchResult() {
    if (_searchResults.isEmpty) return;
    
    _currentSearchIndex = (_currentSearchIndex + 1) % _searchResults.length;
    _goToSearchResult(_currentSearchIndex);
  }
  
  /// ì´ì „ ê²€ìƒ‰ ê²°ê³¼ë¡œ ì´ë™
  void goToPreviousSearchResult() {
    if (_searchResults.isEmpty) return;
    
    _currentSearchIndex = (_currentSearchIndex - 1 + _searchResults.length) % _searchResults.length;
    _goToSearchResult(_currentSearchIndex);
  }
  
  void _goToSearchResult(int index) {
    if (index < 0 || index >= _searchResults.length) return;
    
    final position = _searchResults[index];
    final selection = TextSelection(
      baseOffset: position,
      extentOffset: position + _lastSearchTerm.length,
    );
    
    _quillController?.updateSelection(selection, ChangeSource.LOCAL);
  }
  
  /// í…ìŠ¤íŠ¸ êµì²´
  bool replaceText(String searchTerm, String replaceTerm, {bool replaceAll = false}) {
    if (_quillController == null) return false;
    
    try {
      if (replaceAll) {
        // ëª¨ë“  í…ìŠ¤íŠ¸ êµì²´
        final text = _quillController!.document.toPlainText();
        final newText = text.replaceAll(searchTerm, replaceTerm);
        
        _quillController!.replaceText(0, text.length, newText, TextSelection.collapsed(offset: 0));
        return true;
      } else {
        // í˜„ì¬ ì„ íƒëœ í…ìŠ¤íŠ¸ë§Œ êµì²´
        final selection = _quillController!.selection;
        if (selection.isValid && selection.textInside(_quillController!.document.toPlainText()) == searchTerm) {
          _quillController!.replaceText(
            selection.baseOffset,
            selection.extentOffset - selection.baseOffset,
            replaceTerm,
            TextSelection.collapsed(offset: selection.baseOffset + replaceTerm.length),
          );
          return true;
        }
        return false;
      }
    } catch (e) {
      debugPrint('í…ìŠ¤íŠ¸ êµì²´ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  // ========================================
  // ìë™ì €ì¥ ê´€ë¦¬
  // ========================================
  
  /// ìë™ì €ì¥ íƒ€ì´ë¨¸ ì¬ì‹œì‘
  void _restartAutoSaveTimer() {
    _autoSaveTimer?.cancel();
    _autoSaveTimer = Timer(Duration(seconds: _autoSaveInterval), () {
      if (_hasUnsavedChanges) {
        saveCurrentDocument();
      }
    });
  }
  
  /// ìë™ì €ì¥ ì„¤ì • ë³€ê²½
  void setAutoSaveEnabled(bool enabled) {
    _autoSaveEnabled = enabled;
    if (!enabled) {
      _autoSaveTimer?.cancel();
    } else if (_hasUnsavedChanges) {
      _restartAutoSaveTimer();
    }
    notifyListeners();
  }
  
  /// ìë™ì €ì¥ ê°„ê²© ì„¤ì •
  void setAutoSaveInterval(int seconds) {
    if (seconds >= 10 && seconds <= 600) {
      _autoSaveInterval = seconds;
      if (_autoSaveEnabled && _hasUnsavedChanges) {
        _restartAutoSaveTimer();
      }
      notifyListeners();
    }
  }
  
  // ========================================
  // í†µê³„ ë° ì •ë³´
  // ========================================
  
  /// ë¬¸ì„œ í†µê³„ ì—…ë°ì´íŠ¸
  void _updateStatistics() {
    if (_quillController == null) return;
    
    final text = _quillController!.document.toPlainText();
    
    _characterCount = text.length;
    _wordCount = text.trim().isEmpty ? 0 : text.trim().split(RegExp(r'\s+')).length;
    _paragraphCount = text.split('\n').where((line) => line.trim().isNotEmpty).length;
    
    notifyListeners();
  }
  
  /// ì½ê¸° ì‹œê°„ ì¶”ì • (ë¶„)
  int getEstimatedReadingTime() {
    const wordsPerMinute = 250; // í‰ê·  ì½ê¸° ì†ë„
    return (_wordCount / wordsPerMinute).ceil();
  }
  
  // ========================================
  // ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥
  // ========================================
  
  /// í…ìŠ¤íŠ¸ë¡œ ë‚´ë³´ë‚´ê¸°
  String exportAsText() {
    return _quillController?.document.toPlainText() ?? '';
  }
  
  /// ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°
  String exportAsMarkdown() {
    return convertQuillToMarkdown();
  }
  
  /// HTMLë¡œ ë‚´ë³´ë‚´ê¸°
  String exportAsHtml() {
    // Quill Deltaë¥¼ HTMLë¡œ ë³€í™˜í•˜ëŠ” ë¡œì§
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” quill_html_editor íŒ¨í‚¤ì§€ ì‚¬ìš© ê¶Œì¥
    return _quillController?.document.toPlainText() ?? '';
  }
  
  // ========================================
  // ì„¤ì • ê´€ë¦¬
  // ========================================
  
  /// ì„¤ì • ë¡œë“œ
  Future<void> _loadSettings() async {
    try {
      final prefs = await SharedPreferences.getInstance();
      
      _autoSaveEnabled = prefs.getBool('text_editor_auto_save') ?? true;
      _autoSaveInterval = prefs.getInt('text_editor_auto_save_interval') ?? 60;
      _defaultFont = prefs.getString('text_editor_default_font') ?? 'Roboto';
      _defaultFontSize = prefs.getDouble('text_editor_default_font_size') ?? 16.0;
      _markdownMode = prefs.getBool('text_editor_markdown_mode') ?? false;
    } catch (e) {
      debugPrint('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨: $e');
    }
  }
  
  /// ì„¤ì • ì €ì¥
  Future<void> _saveSettings() async {
    try {
      final prefs = await SharedPreferences.getInstance();
      
      await prefs.setBool('text_editor_auto_save', _autoSaveEnabled);
      await prefs.setInt('text_editor_auto_save_interval', _autoSaveInterval);
      await prefs.setString('text_editor_default_font', _defaultFont);
      await prefs.setDouble('text_editor_default_font_size', _defaultFontSize);
      await prefs.setBool('text_editor_markdown_mode', _markdownMode);
    } catch (e) {
      debugPrint('ì„¤ì • ì €ì¥ ì‹¤íŒ¨: $e');
    }
  }
  
  /// ê¸°ë³¸ ê¸€ê¼´ ì„¤ì •
  void setDefaultFont(String fontFamily) {
    _defaultFont = fontFamily;
    _saveSettings();
    notifyListeners();
  }
  
  /// ê¸°ë³¸ ê¸€ê¼´ í¬ê¸° ì„¤ì •
  void setDefaultFontSize(double fontSize) {
    if (fontSize >= 10.0 && fontSize <= 72.0) {
      _defaultFontSize = fontSize;
      _saveSettings();
      notifyListeners();
    }
  }
  
  // ========================================
  // ì‹¤í–‰ ì·¨ì†Œ/ë‹¤ì‹œ ì‹¤í–‰
  // ========================================
  
  /// ì‹¤í–‰ ì·¨ì†Œ
  void undo() {
    _quillController?.undo();
  }
  
  /// ë‹¤ì‹œ ì‹¤í–‰
  void redo() {
    _quillController?.redo();
  }
  
  /// ì‹¤í–‰ ì·¨ì†Œ ê°€ëŠ¥ ì—¬ë¶€
  bool get canUndo => _quillController?.hasUndo ?? false;
  
  /// ë‹¤ì‹œ ì‹¤í–‰ ê°€ëŠ¥ ì—¬ë¶€
  bool get canRedo => _quillController?.hasRedo ?? false;
  
  // ========================================
  // ì œëª© ê´€ë¦¬
  // ========================================
  
  /// ë¬¸ì„œ ì œëª© ë³€ê²½
  void setTitle(String title) {
    _currentTitle = title;
    _hasUnsavedChanges = true;
    notifyListeners();
  }
  
  /// ì²« ì¤„ì—ì„œ ìë™ ì œëª© ìƒì„±
  String generateAutoTitle() {
    if (_quillController == null) return 'ì œëª© ì—†ëŠ” ë¬¸ì„œ';
    
    final text = _quillController!.document.toPlainText().trim();
    if (text.isEmpty) return 'ì œëª© ì—†ëŠ” ë¬¸ì„œ';
    
    final firstLine = text.split('\n').first.trim();
    if (firstLine.length > 50) {
      return '${firstLine.substring(0, 47)}...';
    }
    
    return firstLine.isEmpty ? 'ì œëª© ì—†ëŠ” ë¬¸ì„œ' : firstLine;
  }
  
  /// ë¦¬ì†ŒìŠ¤ ì •ë¦¬
  @override
  void dispose() {
    _autoSaveTimer?.cancel();
    _quillController?.dispose();
    super.dispose();
  }
}

/// í…ìŠ¤íŠ¸ ì—ë””í„° ì„¤ì • ë°ì´í„° í´ë˜ìŠ¤
class TextEditorSettings {
  final bool autoSaveEnabled;
  final int autoSaveInterval;
  final String defaultFont;
  final double defaultFontSize;
  final bool markdownMode;
  final int maxUndoHistory;

  TextEditorSettings({
    required this.autoSaveEnabled,
    required this.autoSaveInterval,
    required this.defaultFont,
    required this.defaultFontSize,
    required this.markdownMode,
    required this.maxUndoHistory,
  });

  Map<String, dynamic> toJson() => {
    'autoSaveEnabled': autoSaveEnabled,
    'autoSaveInterval': autoSaveInterval,
    'defaultFont': defaultFont,
    'defaultFontSize': defaultFontSize,
    'markdownMode': markdownMode,
    'maxUndoHistory': maxUndoHistory,
  };

  factory TextEditorSettings.fromJson(Map<String, dynamic> json) => TextEditorSettings(
    autoSaveEnabled: json['autoSaveEnabled'] ?? true,
    autoSaveInterval: json['autoSaveInterval'] ?? 60,
    defaultFont: json['defaultFont'] ?? 'Roboto',
    defaultFontSize: json['defaultFontSize']?.toDouble() ?? 16.0,
    markdownMode: json['markdownMode'] ?? false,
    maxUndoHistory: json['maxUndoHistory'] ?? 100,
  );
}
```

================================================================================

17. í•„ê¸°/ì£¼ì„ ì‹œìŠ¤í…œ (DrawingService)

================================================================================

Canvas ê¸°ë°˜ í•„ê¸°, ë“œë¡œì‰, PDF ì£¼ì„ì„ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

```dart
import 'dart:io';
import 'dart:async';
import 'dart:convert';
import 'dart:typed_data';
import 'dart:ui' as ui;
import 'package:flutter/material.dart';
import 'package:flutter/rendering.dart';
import 'package:path_provider/path_provider.dart';
import 'package:image/image.dart' as img;

class DrawingService extends ChangeNotifier {
  // ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤
  static final DrawingService _instance = DrawingService._internal();
  factory DrawingService() => _instance;
  DrawingService._internal();

  // Canvas ìƒíƒœ
  final GlobalKey canvasKey = GlobalKey();
  List<DrawingPath> _paths = [];
  List<DrawingPath> _undoStack = [];
  DrawingTool _currentTool = DrawingTool.pen;
  Color _currentColor = Colors.black;
  double _currentStrokeWidth = 2.0;
  bool _isDrawing = false;
  
  // ë°°ê²½ ì´ë¯¸ì§€/PDF
  ui.Image? _backgroundImage;
  String? _backgroundImagePath;
  double _canvasWidth = 0;
  double _canvasHeight = 0;
  double _scaleFactor = 1.0;
  Offset _panOffset = Offset.zero;
  
  // ì„ íƒ ë° í¸ì§‘
  DrawingPath? _selectedPath;
  bool _isSelectionMode = false;
  Rect? _selectionRect;
  
  // ë ˆì´ì–´ ê´€ë¦¬
  List<DrawingLayer> _layers = [];
  int _currentLayerIndex = 0;
  
  // ê·¸ë¦¬ë“œ ë° ê°€ì´ë“œë¼ì¸
  bool _showGrid = false;
  bool _snapToGrid = false;
  double _gridSize = 20.0;
  
  // í•„ê¸° ì¸ì‹
  bool _handwritingRecognitionEnabled = false;
  List<String> _recognizedText = [];
  
  // Getters
  List<DrawingPath> get paths => List.unmodifiable(_paths);
  List<DrawingPath> get undoStack => List.unmodifiable(_undoStack);
  DrawingTool get currentTool => _currentTool;
  Color get currentColor => _currentColor;
  double get currentStrokeWidth => _currentStrokeWidth;
  bool get isDrawing => _isDrawing;
  ui.Image? get backgroundImage => _backgroundImage;
  String? get backgroundImagePath => _backgroundImagePath;
  double get canvasWidth => _canvasWidth;
  double get canvasHeight => _canvasHeight;
  double get scaleFactor => _scaleFactor;
  Offset get panOffset => _panOffset;
  DrawingPath? get selectedPath => _selectedPath;
  bool get isSelectionMode => _isSelectionMode;
  bool get canUndo => _paths.isNotEmpty;
  bool get canRedo => _undoStack.isNotEmpty;
  List<DrawingLayer> get layers => List.unmodifiable(_layers);
  int get currentLayerIndex => _currentLayerIndex;
  bool get showGrid => _showGrid;
  bool get snapToGrid => _snapToGrid;
  double get gridSize => _gridSize;
  
  /// ì´ˆê¸°í™”
  Future<bool> initialize() async {
    try {
      // ê¸°ë³¸ ë ˆì´ì–´ ìƒì„±
      _layers.add(DrawingLayer(
        id: DateTime.now().millisecondsSinceEpoch.toString(),
        name: 'ë ˆì´ì–´ 1',
        isVisible: true,
        opacity: 1.0,
      ));
      
      return true;
    } catch (e) {
      debugPrint('DrawingService ì´ˆê¸°í™” ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  // ========================================
  // ê·¸ë¦¬ê¸° ë„êµ¬ ê´€ë¦¬
  // ========================================
  
  /// ê·¸ë¦¬ê¸° ë„êµ¬ ë³€ê²½
  void setDrawingTool(DrawingTool tool) {
    _currentTool = tool;
    _isSelectionMode = tool == DrawingTool.select;
    notifyListeners();
  }
  
  /// ìƒ‰ìƒ ë³€ê²½
  void setColor(Color color) {
    _currentColor = color;
    notifyListeners();
  }
  
  /// ì„  êµµê¸° ë³€ê²½
  void setStrokeWidth(double width) {
    if (width > 0 && width <= 50) {
      _currentStrokeWidth = width;
      notifyListeners();
    }
  }
  
  // ========================================
  // ê·¸ë¦¬ê¸° ì‘ì—…
  // ========================================
  
  /// ê·¸ë¦¬ê¸° ì‹œì‘
  void startDrawing(Offset point) {
    if (_isSelectionMode) {
      _startSelection(point);
      return;
    }
    
    _isDrawing = true;
    
    final adjustedPoint = _adjustPointToGrid(point);
    
    final newPath = DrawingPath(
      id: DateTime.now().millisecondsSinceEpoch.toString(),
      tool: _currentTool,
      color: _currentColor,
      strokeWidth: _currentStrokeWidth,
      points: [adjustedPoint],
      layerId: _layers[_currentLayerIndex].id,
      timestamp: DateTime.now(),
    );
    
    _paths.add(newPath);
    _undoStack.clear(); // ìƒˆë¡œìš´ ì•¡ì…˜ ì‹œ redo ìŠ¤íƒ í´ë¦¬ì–´
    
    notifyListeners();
  }
  
  /// ê·¸ë¦¬ê¸° ì§„í–‰
  void updateDrawing(Offset point) {
    if (!_isDrawing || _paths.isEmpty) return;
    
    if (_isSelectionMode) {
      _updateSelection(point);
      return;
    }
    
    final adjustedPoint = _adjustPointToGrid(point);
    final currentPath = _paths.last;
    
    // ë„êµ¬ë³„ ì²˜ë¦¬
    switch (_currentTool) {
      case DrawingTool.pen:
      case DrawingTool.pencil:
      case DrawingTool.marker:
      case DrawingTool.highlighter:
        currentPath.points.add(adjustedPoint);
        break;
      case DrawingTool.line:
        if (currentPath.points.length >= 2) {
          currentPath.points[1] = adjustedPoint;
        } else {
          currentPath.points.add(adjustedPoint);
        }
        break;
      case DrawingTool.rectangle:
      case DrawingTool.circle:
        _updateShapePath(currentPath, adjustedPoint);
        break;
      case DrawingTool.eraser:
        _performErase(adjustedPoint);
        break;
      default:
        break;
    }
    
    notifyListeners();
  }
  
  /// ê·¸ë¦¬ê¸° ë
  void endDrawing() {
    _isDrawing = false;
    
    if (_isSelectionMode) {
      _endSelection();
      return;
    }
    
    // ë¹ˆ ê²½ë¡œ ì œê±°
    if (_paths.isNotEmpty && _paths.last.points.isEmpty) {
      _paths.removeLast();
    }
    
    notifyListeners();
  }
  
  /// ê·¸ë¦¬ë“œì— ë§ì¶° ì¢Œí‘œ ì¡°ì •
  Offset _adjustPointToGrid(Offset point) {
    if (!_snapToGrid) return point;
    
    final gridX = (point.dx / _gridSize).round() * _gridSize;
    final gridY = (point.dy / _gridSize).round() * _gridSize;
    
    return Offset(gridX, gridY);
  }
  
  /// ë„í˜• ê²½ë¡œ ì—…ë°ì´íŠ¸
  void _updateShapePath(DrawingPath path, Offset endPoint) {
    if (path.points.isEmpty) return;
    
    final startPoint = path.points.first;
    
    switch (path.tool) {
      case DrawingTool.rectangle:
        path.points = _createRectanglePath(startPoint, endPoint);
        break;
      case DrawingTool.circle:
        path.points = _createCirclePath(startPoint, endPoint);
        break;
      default:
        break;
    }
  }
  
  /// ì‚¬ê°í˜• ê²½ë¡œ ìƒì„±
  List<Offset> _createRectanglePath(Offset start, Offset end) {
    return [
      start,
      Offset(end.dx, start.dy),
      end,
      Offset(start.dx, end.dy),
      start, // ë‹«ê¸°
    ];
  }
  
  /// ì› ê²½ë¡œ ìƒì„±
  List<Offset> _createCirclePath(Offset start, Offset end) {
    final center = Offset(
      (start.dx + end.dx) / 2,
      (start.dy + end.dy) / 2,
    );
    final radius = (end - start).distance / 2;
    
    final points = <Offset>[];
    const int segments = 64;
    
    for (int i = 0; i <= segments; i++) {
      final angle = (i / segments) * 2 * 3.14159;
      points.add(Offset(
        center.dx + radius * cos(angle),
        center.dy + radius * sin(angle),
      ));
    }
    
    return points;
  }
  
  // ========================================
  // ì§€ìš°ê°œ ê¸°ëŠ¥
  // ========================================
  
  /// ì§€ìš°ê¸° ìˆ˜í–‰
  void _performErase(Offset point) {
    final eraseRadius = _currentStrokeWidth * 2;
    
    _paths.removeWhere((path) {
      return path.points.any((pathPoint) {
        return (pathPoint - point).distance <= eraseRadius;
      });
    });
  }
  
  /// ì „ì²´ ì§€ìš°ê¸°
  void clearCanvas() {
    if (_paths.isNotEmpty) {
      _undoStack.clear();
      _paths.clear();
      notifyListeners();
    }
  }
  
  // ========================================
  // ì‹¤í–‰ ì·¨ì†Œ/ë‹¤ì‹œ ì‹¤í–‰
  // ========================================
  
  /// ì‹¤í–‰ ì·¨ì†Œ
  void undo() {
    if (_paths.isNotEmpty) {
      _undoStack.add(_paths.removeLast());
      notifyListeners();
    }
  }
  
  /// ë‹¤ì‹œ ì‹¤í–‰
  void redo() {
    if (_undoStack.isNotEmpty) {
      _paths.add(_undoStack.removeLast());
      notifyListeners();
    }
  }
  
  // ========================================
  // ì„ íƒ ë° í¸ì§‘
  // ========================================
  
  /// ì„ íƒ ì‹œì‘
  void _startSelection(Offset point) {
    _selectionRect = Rect.fromLTWH(point.dx, point.dy, 0, 0);
    _selectedPath = null;
  }
  
  /// ì„ íƒ ì—…ë°ì´íŠ¸
  void _updateSelection(Offset point) {
    if (_selectionRect == null) return;
    
    final startPoint = _selectionRect!.topLeft;
    _selectionRect = Rect.fromPoints(startPoint, point);
    notifyListeners();
  }
  
  /// ì„ íƒ ì¢…ë£Œ
  void _endSelection() {
    if (_selectionRect == null) return;
    
    // ì„ íƒ ì˜ì—­ì— ìˆëŠ” ê²½ë¡œ ì°¾ê¸°
    final selectedPaths = _paths.where((path) {
      return path.points.any((point) => _selectionRect!.contains(point));
    }).toList();
    
    if (selectedPaths.isNotEmpty) {
      _selectedPath = selectedPaths.first;
    }
    
    _selectionRect = null;
    notifyListeners();
  }
  
  /// ì„ íƒëœ ê²½ë¡œ ì‚­ì œ
  void deleteSelectedPath() {
    if (_selectedPath != null) {
      _paths.remove(_selectedPath);
      _selectedPath = null;
      notifyListeners();
    }
  }
  
  /// ì„ íƒëœ ê²½ë¡œ ë³µì‚¬
  void duplicateSelectedPath() {
    if (_selectedPath != null) {
      final newPath = DrawingPath(
        id: DateTime.now().millisecondsSinceEpoch.toString(),
        tool: _selectedPath!.tool,
        color: _selectedPath!.color,
        strokeWidth: _selectedPath!.strokeWidth,
        points: _selectedPath!.points.map((p) => p + Offset(10, 10)).toList(),
        layerId: _selectedPath!.layerId,
        timestamp: DateTime.now(),
      );
      
      _paths.add(newPath);
      _selectedPath = newPath;
      notifyListeners();
    }
  }
  
  // ========================================
  // ë°°ê²½ ì´ë¯¸ì§€/PDF ê´€ë¦¬
  // ========================================
  
  /// ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì •
  Future<bool> setBackgroundImage(String imagePath) async {
    try {
      final file = File(imagePath);
      if (!await file.exists()) return false;
      
      final bytes = await file.readAsBytes();
      final codec = await ui.instantiateImageCodec(bytes);
      final frame = await codec.getNextFrame();
      
      _backgroundImage = frame.image;
      _backgroundImagePath = imagePath;
      _canvasWidth = frame.image.width.toDouble();
      _canvasHeight = frame.image.height.toDouble();
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì • ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ë°°ê²½ ì´ë¯¸ì§€ ì œê±°
  void removeBackgroundImage() {
    _backgroundImage?.dispose();
    _backgroundImage = null;
    _backgroundImagePath = null;
    notifyListeners();
  }
  
  // ========================================
  // ìº”ë²„ìŠ¤ ë³€í™˜ (í™•ëŒ€/ì¶•ì†Œ/ì´ë™)
  // ========================================
  
  /// í™•ëŒ€/ì¶•ì†Œ
  void setScale(double scale) {
    if (scale >= 0.1 && scale <= 5.0) {
      _scaleFactor = scale;
      notifyListeners();
    }
  }
  
  /// ì´ë™
  void setPanOffset(Offset offset) {
    _panOffset = offset;
    notifyListeners();
  }
  
  /// í™•ëŒ€
  void zoomIn() {
    setScale(_scaleFactor * 1.2);
  }
  
  /// ì¶•ì†Œ
  void zoomOut() {
    setScale(_scaleFactor / 1.2);
  }
  
  /// ì›ë˜ í¬ê¸°ë¡œ
  void resetZoom() {
    _scaleFactor = 1.0;
    _panOffset = Offset.zero;
    notifyListeners();
  }
  
  // ========================================
  // ë ˆì´ì–´ ê´€ë¦¬
  // ========================================
  
  /// ìƒˆ ë ˆì´ì–´ ì¶”ê°€
  void addLayer({String? name}) {
    final layer = DrawingLayer(
      id: DateTime.now().millisecondsSinceEpoch.toString(),
      name: name ?? 'ë ˆì´ì–´ ${_layers.length + 1}',
      isVisible: true,
      opacity: 1.0,
    );
    
    _layers.add(layer);
    _currentLayerIndex = _layers.length - 1;
    notifyListeners();
  }
  
  /// ë ˆì´ì–´ ì‚­ì œ
  void deleteLayer(int index) {
    if (_layers.length <= 1 || index < 0 || index >= _layers.length) return;
    
    final layerId = _layers[index].id;
    
    // í•´ë‹¹ ë ˆì´ì–´ì˜ ëª¨ë“  ê²½ë¡œ ì‚­ì œ
    _paths.removeWhere((path) => path.layerId == layerId);
    
    _layers.removeAt(index);
    
    // í˜„ì¬ ë ˆì´ì–´ ì¸ë±ìŠ¤ ì¡°ì •
    if (_currentLayerIndex >= _layers.length) {
      _currentLayerIndex = _layers.length - 1;
    }
    
    notifyListeners();
  }
  
  /// í˜„ì¬ ë ˆì´ì–´ ë³€ê²½
  void setCurrentLayer(int index) {
    if (index >= 0 && index < _layers.length) {
      _currentLayerIndex = index;
      notifyListeners();
    }
  }
  
  /// ë ˆì´ì–´ ê°€ì‹œì„± í† ê¸€
  void toggleLayerVisibility(int index) {
    if (index >= 0 && index < _layers.length) {
      _layers[index].isVisible = !_layers[index].isVisible;
      notifyListeners();
    }
  }
  
  /// ë ˆì´ì–´ íˆ¬ëª…ë„ ì„¤ì •
  void setLayerOpacity(int index, double opacity) {
    if (index >= 0 && index < _layers.length && opacity >= 0.0 && opacity <= 1.0) {
      _layers[index].opacity = opacity;
      notifyListeners();
    }
  }
  
  // ========================================
  // ê·¸ë¦¬ë“œ ë° ê°€ì´ë“œë¼ì¸
  // ========================================
  
  /// ê·¸ë¦¬ë“œ í‘œì‹œ í† ê¸€
  void toggleGrid() {
    _showGrid = !_showGrid;
    notifyListeners();
  }
  
  /// ê·¸ë¦¬ë“œ ìŠ¤ëƒ… í† ê¸€
  void toggleGridSnap() {
    _snapToGrid = !_snapToGrid;
    notifyListeners();
  }
  
  /// ê·¸ë¦¬ë“œ í¬ê¸° ì„¤ì •
  void setGridSize(double size) {
    if (size >= 5.0 && size <= 100.0) {
      _gridSize = size;
      notifyListeners();
    }
  }
  
  // ========================================
  // ì €ì¥ ë° ë‚´ë³´ë‚´ê¸°
  // ========================================
  
  /// ë“œë¡œì‰ ë°ì´í„° ì €ì¥
  Future<bool> saveDrawing(String fileName) async {
    try {
      final directory = await getApplicationDocumentsDirectory();
      final drawingsDir = Directory('${directory.path}/drawings');
      if (!await drawingsDir.exists()) {
        await drawingsDir.create(recursive: true);
      }
      
      final file = File('${drawingsDir.path}/$fileName.json');
      
      final data = {
        'paths': _paths.map((p) => p.toJson()).toList(),
        'layers': _layers.map((l) => l.toJson()).toList(),
        'backgroundImagePath': _backgroundImagePath,
        'canvasWidth': _canvasWidth,
        'canvasHeight': _canvasHeight,
        'timestamp': DateTime.now().toIso8601String(),
      };
      
      await file.writeAsString(jsonEncode(data));
      return true;
    } catch (e) {
      debugPrint('ë“œë¡œì‰ ì €ì¥ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// ë“œë¡œì‰ ë°ì´í„° ë¡œë“œ
  Future<bool> loadDrawing(String filePath) async {
    try {
      final file = File(filePath);
      if (!await file.exists()) return false;
      
      final jsonString = await file.readAsString();
      final data = jsonDecode(jsonString);
      
      // ê²½ë¡œ ë°ì´í„° ë¡œë“œ
      _paths.clear();
      for (final pathData in data['paths']) {
        _paths.add(DrawingPath.fromJson(pathData));
      }
      
      // ë ˆì´ì–´ ë°ì´í„° ë¡œë“œ
      _layers.clear();
      for (final layerData in data['layers']) {
        _layers.add(DrawingLayer.fromJson(layerData));
      }
      
      // ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ
      if (data['backgroundImagePath'] != null) {
        await setBackgroundImage(data['backgroundImagePath']);
      }
      
      _canvasWidth = data['canvasWidth']?.toDouble() ?? 0;
      _canvasHeight = data['canvasHeight']?.toDouble() ?? 0;
      
      _undoStack.clear();
      _selectedPath = null;
      _currentLayerIndex = 0;
      
      notifyListeners();
      return true;
    } catch (e) {
      debugPrint('ë“œë¡œì‰ ë¡œë“œ ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  /// PNG ì´ë¯¸ì§€ë¡œ ë‚´ë³´ë‚´ê¸°
  Future<String?> exportToPNG() async {
    try {
      final recorder = ui.PictureRecorder();
      final canvas = Canvas(recorder);
      
      // ë°°ê²½ ê·¸ë¦¬ê¸°
      if (_backgroundImage != null) {
        canvas.drawImage(_backgroundImage!, Offset.zero, Paint());
      } else {
        canvas.drawRect(
          Rect.fromLTWH(0, 0, _canvasWidth, _canvasHeight),
          Paint()..color = Colors.white,
        );
      }
      
      // ë ˆì´ì–´ë³„ë¡œ ê²½ë¡œ ê·¸ë¦¬ê¸°
      for (final layer in _layers) {
        if (!layer.isVisible) continue;
        
        final layerPaths = _paths.where((p) => p.layerId == layer.id);
        for (final path in layerPaths) {
          _drawPathOnCanvas(canvas, path, layer.opacity);
        }
      }
      
      final picture = recorder.endRecording();
      final image = await picture.toImage(
        _canvasWidth.toInt(),
        _canvasHeight.toInt(),
      );
      
      final byteData = await image.toByteData(format: ui.ImageByteFormat.png);
      final bytes = byteData!.buffer.asUint8List();
      
      // íŒŒì¼ ì €ì¥
      final directory = await getApplicationDocumentsDirectory();
      final exportDir = Directory('${directory.path}/exports');
      if (!await exportDir.exists()) {
        await exportDir.create(recursive: true);
      }
      
      final timestamp = DateTime.now().millisecondsSinceEpoch;
      final file = File('${exportDir.path}/drawing_$timestamp.png');
      await file.writeAsBytes(bytes);
      
      return file.path;
    } catch (e) {
      debugPrint('PNG ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨: $e');
      return null;
    }
  }
  
  /// ìº”ë²„ìŠ¤ì— ê²½ë¡œ ê·¸ë¦¬ê¸°
  void _drawPathOnCanvas(Canvas canvas, DrawingPath path, double opacity) {
    if (path.points.isEmpty) return;
    
    final paint = Paint()
      ..color = path.color.withOpacity(path.color.opacity * opacity)
      ..strokeWidth = path.strokeWidth
      ..style = PaintingStyle.stroke
      ..strokeCap = StrokeCap.round
      ..strokeJoin = StrokeJoin.round;
    
    // ë„êµ¬ë³„ í˜ì¸íŠ¸ ì„¤ì •
    switch (path.tool) {
      case DrawingTool.highlighter:
        paint.blendMode = BlendMode.multiply;
        break;
      case DrawingTool.marker:
        paint.strokeCap = StrokeCap.square;
        break;
      default:
        break;
    }
    
    final pathObject = Path();
    pathObject.moveTo(path.points.first.dx, path.points.first.dy);
    
    for (int i = 1; i < path.points.length; i++) {
      pathObject.lineTo(path.points[i].dx, path.points[i].dy);
    }
    
    canvas.drawPath(pathObject, paint);
  }
  
  // ========================================
  // í•„ê¸° ì¸ì‹ (OCR)
  // ========================================
  
  /// í•„ê¸° ì¸ì‹ í™œì„±í™”/ë¹„í™œì„±í™”
  void setHandwritingRecognition(bool enabled) {
    _handwritingRecognitionEnabled = enabled;
    notifyListeners();
  }
  
  /// í•„ê¸° ì¸ì‹ ìˆ˜í–‰
  Future<List<String>> recognizeHandwriting() async {
    if (!_handwritingRecognitionEnabled) return [];
    
    try {
      // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ML Kit ë˜ëŠ” ë‹¤ë¥¸ OCR ì„œë¹„ìŠ¤ ì‚¬ìš©
      // ì—¬ê¸°ì„œëŠ” ë”ë¯¸ êµ¬í˜„
      _recognizedText = ['ì¸ì‹ëœ í…ìŠ¤íŠ¸ ì˜ˆì‹œ'];
      notifyListeners();
      return _recognizedText;
    } catch (e) {
      debugPrint('í•„ê¸° ì¸ì‹ ì‹¤íŒ¨: $e');
      return [];
    }
  }
  
  /// ë¦¬ì†ŒìŠ¤ ì •ë¦¬
  @override
  void dispose() {
    _backgroundImage?.dispose();
    super.dispose();
  }
}

/// ê·¸ë¦¬ê¸° ë„êµ¬ ì—´ê±°í˜•
enum DrawingTool {
  pen,
  pencil,
  marker,
  highlighter,
  eraser,
  line,
  rectangle,
  circle,
  select,
}

/// ê·¸ë¦¬ê¸° ê²½ë¡œ ë°ì´í„° í´ë˜ìŠ¤
class DrawingPath {
  final String id;
  final DrawingTool tool;
  final Color color;
  final double strokeWidth;
  final List<Offset> points;
  final String layerId;
  final DateTime timestamp;

  DrawingPath({
    required this.id,
    required this.tool,
    required this.color,
    required this.strokeWidth,
    required this.points,
    required this.layerId,
    required this.timestamp,
  });

  Map<String, dynamic> toJson() => {
    'id': id,
    'tool': tool.toString(),
    'color': color.value,
    'strokeWidth': strokeWidth,
    'points': points.map((p) => {'dx': p.dx, 'dy': p.dy}).toList(),
    'layerId': layerId,
    'timestamp': timestamp.toIso8601String(),
  };

  factory DrawingPath.fromJson(Map<String, dynamic> json) => DrawingPath(
    id: json['id'],
    tool: DrawingTool.values.firstWhere(
      (t) => t.toString() == json['tool'],
      orElse: () => DrawingTool.pen,
    ),
    color: Color(json['color']),
    strokeWidth: json['strokeWidth']?.toDouble() ?? 2.0,
    points: (json['points'] as List)
        .map((p) => Offset(p['dx']?.toDouble() ?? 0, p['dy']?.toDouble() ?? 0))
        .toList(),
    layerId: json['layerId'],
    timestamp: DateTime.parse(json['timestamp']),
  );
}

/// ê·¸ë¦¬ê¸° ë ˆì´ì–´ ë°ì´í„° í´ë˜ìŠ¤
class DrawingLayer {
  final String id;
  String name;
  bool isVisible;
  double opacity;

  DrawingLayer({
    required this.id,
    required this.name,
    required this.isVisible,
    required this.opacity,
  });

  Map<String, dynamic> toJson() => {
    'id': id,
    'name': name,
    'isVisible': isVisible,
    'opacity': opacity,
  };

  factory DrawingLayer.fromJson(Map<String, dynamic> json) => DrawingLayer(
    id: json['id'],
    name: json['name'],
    isVisible: json['isVisible'] ?? true,
    opacity: json['opacity']?.toDouble() ?? 1.0,
  );
}
```

================================================================================

18. íŒŒì¼ ë³€í™˜ ì„œë¹„ìŠ¤ (FileConversionService)

================================================================================

PDFâ†’JPEG ë³€í™˜ì„ í¬í•¨í•œ íŒŒì¼ ë³€í™˜ ì²˜ë¦¬ë¥¼ ê´€ë¦¬í•˜ëŠ” ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

```dart
import 'dart:io';
import 'dart:async';
import 'dart:typed_data';
import 'dart:ui' as ui;
import 'package:flutter/foundation.dart';
import 'package:flutter/material.dart';
import 'package:path_provider/path_provider.dart';
import 'package:path/path.dart' as path;
import 'package:pdf/pdf.dart';
import 'package:pdf/widgets.dart' as pw;
import 'package:printing/printing.dart';
import 'package:image/image.dart' as img;

class FileConversionService extends ChangeNotifier {
  // ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤
  static final FileConversionService _instance = FileConversionService._internal();
  factory FileConversionService() => _instance;
  FileConversionService._internal();

  // ë³€í™˜ ìƒíƒœ
  bool _isConverting = false;
  double _conversionProgress = 0.0;
  String _currentTask = '';
  List<ConversionHistoryItem> _conversionHistory = [];
  
  // ë³€í™˜ ì„¤ì •
  int _jpegQuality = 85; // 0-100
  double _imageResolution = 300.0; // DPI
  bool _maintainAspectRatio = true;
  int _maxImageWidth = 2048;
  int _maxImageHeight = 2048;
  
  // ì§€ì› íŒŒì¼ í˜•ì‹
  static const List<String> supportedInputFormats = [
    'pdf', 'doc', 'docx', 'ppt', 'pptx', 'txt', 'rtf', 'odt'
  ];
  
  static const List<String> supportedOutputFormats = [
    'jpeg', 'jpg', 'png', 'pdf'
  ];
  
  // Getters
  bool get isConverting => _isConverting;
  double get conversionProgress => _conversionProgress;
  String get currentTask => _currentTask;
  List<ConversionHistoryItem> get conversionHistory => List.unmodifiable(_conversionHistory);
  int get jpegQuality => _jpegQuality;
  double get imageResolution => _imageResolution;
  bool get maintainAspectRatio => _maintainAspectRatio;
  int get maxImageWidth => _maxImageWidth;
  int get maxImageHeight => _maxImageHeight;
  
  /// ì´ˆê¸°í™”
  Future<bool> initialize() async {
    try {
      await _loadConversionHistory();
      return true;
    } catch (e) {
      debugPrint('FileConversionService ì´ˆê¸°í™” ì‹¤íŒ¨: $e');
      return false;
    }
  }
  
  // ========================================
  // PDF â†’ JPEG ë³€í™˜ (ë©”ì¸ ê¸°ëŠ¥)
  // ========================================
  
  /// PDF íŒŒì¼ì„ JPEG ì´ë¯¸ì§€ë¡œ ë³€í™˜
  Future<List<String>?> convertPdfToJpeg(
    String pdfPath, 
    String outputDirectory,
    {String? customFileName}
  ) async {
    try {
      if (_isConverting) {
        throw Exception('ë‹¤ë¥¸ ë³€í™˜ ì‘ì—…ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.');
      }
      
      _startConversion('PDF â†’ JPEG ë³€í™˜ ì¤‘...');
      
      // PDF íŒŒì¼ ê²€ì¦
      final pdfFile = File(pdfPath);
      if (!await pdfFile.exists()) {
        throw Exception('PDF íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
      
      // ì¶œë ¥ ë””ë ‰í† ë¦¬ ìƒì„±
      final outputDir = Directory(outputDirectory);
      if (!await outputDir.exists()) {
        await outputDir.create(recursive: true);
      }
      
      // PDF ë¬¸ì„œ ë¡œë“œ
      final pdfBytes = await pdfFile.readAsBytes();
      final document = await PdfDocument.openData(pdfBytes);
      
      final pageCount = document.pagesCount;
      final outputPaths = <String>[];
      
      // ê° í˜ì´ì§€ë¥¼ JPEGë¡œ ë³€í™˜
      for (int pageIndex = 0; pageIndex < pageCount; pageIndex++) {
        _updateProgress(
          (pageIndex / pageCount),
          'PDF í˜ì´ì§€ ${pageIndex + 1}/$pageCount ë³€í™˜ ì¤‘...'
        );
        
        // PDF í˜ì´ì§€ë¥¼ ì´ë¯¸ì§€ë¡œ ë Œë”ë§
        final page = await document.getPage(pageIndex + 1);
        final pageImage = await page.render(
          width: (_imageResolution * 8.27).toInt(), // A4 ê¸°ì¤€
          height: (_imageResolution * 11.69).toInt(),
          format: PdfPageImageFormat.jpeg,
        );
        
        if (pageImage != null) {
          // ì´ë¯¸ì§€ ì²˜ë¦¬ ë° ìµœì í™”
          final processedBytes = await _processImage(
            pageImage.bytes,
            pageImage.width,
            pageImage.height,
          );
          
          // íŒŒì¼ëª… ìƒì„±
          final baseName = customFileName ?? 
              path.basenameWithoutExtension(pdfPath);
          final fileName = pageCount > 1 
              ? '${baseName}_page_${pageIndex + 1}.jpg'
              : '$baseName.jpg';
          
          // JPEG íŒŒì¼ ì €ì¥
          final outputPath = path.join(outputDirectory, fileName);
          final outputFile = File(outputPath);
          await outputFile.writeAsBytes(processedBytes);
          
          outputPaths.add(outputPath);
        }
        
        page.close();
      }
      
      document.close();
      
      // ë³€í™˜ ê¸°ë¡ ì €ì¥
      await _addConversionHistory(ConversionHistoryItem(
        id: DateTime.now().millisecondsSinceEpoch.toString(),
        sourceFile: pdfPath,
        outputFiles: outputPaths,
        sourceFormat: 'PDF',
        targetFormat: 'JPEG',
        timestamp: DateTime.now(),
        success: true,
        pageCount: pageCount,
      ));
      
      _completeConversion();
      return outputPaths;
      
    } catch (e) {
      _failConversion('PDF ë³€í™˜ ì‹¤íŒ¨: $e');
      return null;
    }
  }
  
  // ========================================
  // ì´ë¯¸ì§€ ì²˜ë¦¬ ë° ìµœì í™”
  // ========================================
  
  /// ì´ë¯¸ì§€ ì²˜ë¦¬ ë° ìµœì í™”
  Future<Uint8List> _processImage(
    Uint8List imageBytes, 
    int originalWidth, 
    int originalHeight
  ) async {
    try {
      // ì´ë¯¸ì§€ ë””ì½”ë”©
      final image = img.decodeImage(imageBytes);
      if (image == null) {
        throw Exception('ì´ë¯¸ì§€ ë””ì½”ë”© ì‹¤íŒ¨');
      }
      
      // í¬ê¸° ì¡°ì • ê³„ì‚°
      int targetWidth = originalWidth;
      int targetHeight = originalHeight;
      
      if (_maintainAspectRatio) {
        if (originalWidth > _maxImageWidth || originalHeight > _maxImageHeight) {
          final widthRatio = _maxImageWidth / originalWidth;
          final heightRatio = _maxImageHeight / originalHeight;
          final ratio = math.min(widthRatio, heightRatio);
          
          targetWidth = (originalWidth * ratio).round();
          targetHeight = (originalHeight * ratio).round();
        }
      } else {
        targetWidth = math.min(originalWidth, _maxImageWidth);
        targetHeight = math.min(originalHeight, _maxImageHeight);
      }
      
      // ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ
      final resizedImage = img.copyResize(
        image,
        width: targetWidth,
        height: targetHeight,
        interpolation: img.Interpolation.cubic,
      );
      
      // JPEG ì¸ì½”ë”©
      final jpegBytes = img.encodeJpg(resizedImage, quality: _jpegQuality);
      
      return Uint8List.fromList(jpegBytes);
    } catch (e) {
      debugPrint('ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹¤íŒ¨: $e');
      return imageBytes; // ì›ë³¸ ë°˜í™˜
    }
  }
  
  // ========================================
  // ê¸°íƒ€ íŒŒì¼ í˜•ì‹ ë³€í™˜
  // ========================================
  
  /// ë¬¸ì„œ íŒŒì¼ì„ ì´ë¯¸ì§€ë¡œ ë³€í™˜ (DOC, PPT ë“±)
  Future<List<String>?> convertDocumentToImage(
    String documentPath,
    String outputDirectory,
    {String targetFormat = 'jpeg'}
  ) async {
    try {
      if (_isConverting) {
        throw Exception('ë‹¤ë¥¸ ë³€í™˜ ì‘ì—…ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.');
      }
      
      final extension = path.extension(documentPath).toLowerCase();
      
      switch (extension) {
        case '.doc':
        case '.docx':
          return await _convertWordToImage(documentPath, outputDirectory, targetFormat);
        case '.ppt':
        case '.pptx':
          return await _convertPowerPointToImage(documentPath, outputDirectory, targetFormat);
        case '.txt':
          return await _convertTextToImage(documentPath, outputDirectory, targetFormat);
        default:
          throw Exception('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹: $extension');
      }
    } catch (e) {
      _failConversion('ë¬¸ì„œ ë³€í™˜ ì‹¤íŒ¨: $e');
      return null;
    }
  }
  
  /// Word ë¬¸ì„œë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜
  Future<List<String>?> _convertWordToImage(
    String docPath,
    String outputDirectory,
    String targetFormat
  ) async {
    _startConversion('Word ë¬¸ì„œ ë³€í™˜ ì¤‘...');
    
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” flutter_document_reader ë˜ëŠ”
    // ë„¤ì´í‹°ë¸Œ í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„
    // ì—¬ê¸°ì„œëŠ” ë”ë¯¸ êµ¬í˜„
    
    _updateProgress(0.5, 'Word ë¬¸ì„œ ì²˜ë¦¬ ì¤‘...');
    
    // ì„ì‹œ PDF ìƒì„± í›„ JPEG ë³€í™˜
    final tempPdfPath = await _convertWordToPdf(docPath);
    if (tempPdfPath != null) {
      final result = await convertPdfToJpeg(tempPdfPath, outputDirectory);
      
      // ì„ì‹œ PDF íŒŒì¼ ì‚­ì œ
      await File(tempPdfPath).delete();
      
      return result;
    }
    
    return null;
  }
  
  /// PowerPointë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜
  Future<List<String>?> _convertPowerPointToImage(
    String pptPath,
    String outputDirectory,
    String targetFormat
  ) async {
    _startConversion('PowerPoint ë³€í™˜ ì¤‘...');
    
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” í”Œë«í¼ë³„ ë„¤ì´í‹°ë¸Œ ë³€í™˜ ì‚¬ìš©
    // ì—¬ê¸°ì„œëŠ” ë”ë¯¸ êµ¬í˜„
    
    _updateProgress(0.5, 'PowerPoint ì²˜ë¦¬ ì¤‘...');
    
    final tempPdfPath = await _convertPowerPointToPdf(pptPath);
    if (tempPdfPath != null) {
      final result = await convertPdfToJpeg(tempPdfPath, outputDirectory);
      await File(tempPdfPath).delete();
      return result;
    }
    
    return null;
  }
  
  /// í…ìŠ¤íŠ¸ íŒŒì¼ì„ ì´ë¯¸ì§€ë¡œ ë³€í™˜
  Future<List<String>?> _convertTextToImage(
    String textPath,
    String outputDirectory,
    String targetFormat
  ) async {
    try {
      _startConversion('í…ìŠ¤íŠ¸ íŒŒì¼ ë³€í™˜ ì¤‘...');
      
      // í…ìŠ¤íŠ¸ íŒŒì¼ ì½ê¸°
      final textFile = File(textPath);
      final content = await textFile.readAsString();
      
      _updateProgress(0.3, 'í…ìŠ¤íŠ¸ ë Œë”ë§ ì¤‘...');
      
      // í…ìŠ¤íŠ¸ë¥¼ PDFë¡œ ë³€í™˜
      final pdfPath = await _convertTextToPdf(content, textPath);
      
      _updateProgress(0.6, 'PDF â†’ JPEG ë³€í™˜ ì¤‘...');
      
      // PDFë¥¼ JPEGë¡œ ë³€í™˜
      final result = await convertPdfToJpeg(pdfPath, outputDirectory);
      
      // ì„ì‹œ PDF ì‚­ì œ
      await File(pdfPath).delete();
      
      return result;
    } catch (e) {
      _failConversion('í…ìŠ¤íŠ¸ ë³€í™˜ ì‹¤íŒ¨: $e');
      return null;
    }
  }
  
  /// í…ìŠ¤íŠ¸ë¥¼ PDFë¡œ ë³€í™˜
  Future<String> _convertTextToPdf(String content, String originalPath) async {
    final pdf = pw.Document();
    
    // í˜ì´ì§€ ì„¤ì •
    const pageFormat = PdfPageFormat.a4;
    const margin = pw.EdgeInsets.all(40);
    
    // í…ìŠ¤íŠ¸ë¥¼ í˜ì´ì§€ë³„ë¡œ ë¶„í• 
    final lines = content.split('\n');
    const linesPerPage = 40; // A4 ê¸°ì¤€ ëŒ€ëµì ì¸ ì¤„ ìˆ˜
    
    for (int i = 0; i < lines.length; i += linesPerPage) {
      final pageLines = lines.skip(i).take(linesPerPage).join('\n');
      
      pdf.addPage(
        pw.Page(
          pageFormat: pageFormat,
          margin: margin,
          build: (pw.Context context) {
            return pw.Column(
              crossAxisAlignment: pw.CrossAxisAlignment.start,
              children: [
                pw.Text(
                  pageLines,
                  style: pw.TextStyle(
                    fontSize: 12,
                    lineSpacing: 1.2,
                  ),
                ),
              ],
            );
          },
        ),
      );
    }
    
    // PDF ì €ì¥
    final directory = await getTemporaryDirectory();
    final baseName = path.basenameWithoutExtension(originalPath);
    final pdfPath = path.join(directory.path, '${baseName}_temp.pdf');
    
    final file = File(pdfPath);
    await file.writeAsBytes(await pdf.save());
    
    return pdfPath;
  }
  
  /// Wordë¥¼ PDFë¡œ ë³€í™˜ (ë”ë¯¸ êµ¬í˜„)
  Future<String?> _convertWordToPdf(String docPath) async {
    // ì‹¤ì œë¡œëŠ” ë„¤ì´í‹°ë¸Œ í”ŒëŸ¬ê·¸ì¸ì´ë‚˜ ì„œë²„ API ì‚¬ìš©
    // ì—¬ê¸°ì„œëŠ” ë”ë¯¸ êµ¬í˜„
    return null;
  }
  
  /// PowerPointë¥¼ PDFë¡œ ë³€í™˜ (ë”ë¯¸ êµ¬í˜„)
  Future<String?> _convertPowerPointToPdf(String pptPath) async {
    // ì‹¤ì œë¡œëŠ” ë„¤ì´í‹°ë¸Œ í”ŒëŸ¬ê·¸ì¸ì´ë‚˜ ì„œë²„ API ì‚¬ìš©
    // ì—¬ê¸°ì„œëŠ” ë”ë¯¸ êµ¬í˜„
    return null;
  }
  
  // ========================================
  // ë¦¬íŠ¼ ë””ë ‰í† ë¦¬ í†µí•© ì²˜ë¦¬
  // ========================================
  
  /// íŒŒì¼ì„ ë¦¬íŠ¼ ë””ë ‰í† ë¦¬ë¡œ ë³€í™˜ ë° ì´ë™
  Future<List<String>?> convertAndMoveToLiten(
    String sourceFilePath,
    String littenDirectoryId,
    {String? customFileName}
  ) async {
    try {
      // ë¦¬íŠ¼ ë””ë ‰í† ë¦¬ ê²½ë¡œ ìƒì„±
      final directory = await getApplicationDocumentsDirectory();
      final littenDir = Directory('${directory.path}/littens/$littenDirectoryId');
      if (!await littenDir.exists()) {
        await littenDir.create(recursive: true);
      }
      
      final extension = path.extension(sourceFilePath).toLowerCase();
      
      // íŒŒì¼ í˜•ì‹ì— ë”°ë¥¸ ë³€í™˜ ì²˜ë¦¬
      if (extension == '.pdf') {
        return await convertPdfToJpeg(
          sourceFilePath,
          littenDir.path,
          customFileName: customFileName,
        );
      } else if (supportedInputFormats.contains(extension.substring(1))) {
        return await convertDocumentToImage(
          sourceFilePath,
          littenDir.path,
          targetFormat: 'jpeg',
        );
      } else if (['.jpg', '.jpeg', '.png'].contains(extension)) {
        // ì´ë¯¸ì§€ íŒŒì¼ì€ ì§ì ‘ ë³µì‚¬
        final fileName = customFileName ?? path.basename(sourceFilePath);
        final targetPath = path.join(littenDir.path, fileName);
        await File(sourceFilePath).copy(targetPath);
        return [targetPath];
      } else {
        throw Exception('ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹: $extension');
      }
    } catch (e) {
      debugPrint('ë¦¬íŠ¼ ë””ë ‰í† ë¦¬ ë³€í™˜ ì‹¤íŒ¨: $e');
      return null;
    }
  }
  
  // ========================================
  // ë³€í™˜ ìƒíƒœ ê´€ë¦¬
  // ========================================
  
  /// ë³€í™˜ ì‹œì‘
  void _startConversion(String task) {
    _isConverting = true;
    _conversionProgress = 0.0;
    _currentTask = task;
    notifyListeners();
  }
  
  /// ë³€í™˜ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
  void _updateProgress(double progress, String task) {
    _conversionProgress = progress.clamp(0.0, 1.0);
    _currentTask = task;
    notifyListeners();
  }
  
  /// ë³€í™˜ ì™„ë£Œ
  void _completeConversion() {
    _isConverting = false;
    _conversionProgress = 1.0;
    _currentTask = 'ë³€í™˜ ì™„ë£Œ';
    notifyListeners();
  }
  
  /// ë³€í™˜ ì‹¤íŒ¨
  void _failConversion(String error) {
    _isConverting = false;
    _conversionProgress = 0.0;
    _currentTask = error;
    notifyListeners();
    
    debugPrint('ë³€í™˜ ì‹¤íŒ¨: $error');
  }
  
  /// ë³€í™˜ ì·¨ì†Œ
  void cancelConversion() {
    if (_isConverting) {
      _isConverting = false;
      _conversionProgress = 0.0;
      _currentTask = 'ë³€í™˜ ì·¨ì†Œë¨';
      notifyListeners();
    }
  }
  
  // ========================================
  // ì„¤ì • ê´€ë¦¬
  // ========================================
  
  /// JPEG í’ˆì§ˆ ì„¤ì •
  void setJpegQuality(int quality) {
    if (quality >= 10 && quality <= 100) {
      _jpegQuality = quality;
      notifyListeners();
    }
  }
  
  /// ì´ë¯¸ì§€ í•´ìƒë„ ì„¤ì •
  void setImageResolution(double dpi) {
    if (dpi >= 72 && dpi <= 600) {
      _imageResolution = dpi;
      notifyListeners();
    }
  }
  
  /// ìµœëŒ€ ì´ë¯¸ì§€ í¬ê¸° ì„¤ì •
  void setMaxImageSize(int width, int height) {
    if (width > 0 && height > 0) {
      _maxImageWidth = width;
      _maxImageHeight = height;
      notifyListeners();
    }
  }
  
  /// ì¢…íš¡ë¹„ ìœ ì§€ ì„¤ì •
  void setMaintainAspectRatio(bool maintain) {
    _maintainAspectRatio = maintain;
    notifyListeners();
  }
  
  // ========================================
  // ë³€í™˜ ê¸°ë¡ ê´€ë¦¬
  // ========================================
  
  /// ë³€í™˜ ê¸°ë¡ ì¶”ê°€
  Future<void> _addConversionHistory(ConversionHistoryItem item) async {
    _conversionHistory.insert(0, item); // ìµœì‹  í•­ëª©ì„ ë§¨ ì•ì—
    
    // ìµœëŒ€ 100ê°œ í•­ëª©ë§Œ ìœ ì§€
    if (_conversionHistory.length > 100) {
      _conversionHistory = _conversionHistory.take(100).toList();
    }
    
    await _saveConversionHistory();
    notifyListeners();
  }
  
  /// ë³€í™˜ ê¸°ë¡ ë¡œë“œ
  Future<void> _loadConversionHistory() async {
    try {
      // SharedPreferencesë‚˜ íŒŒì¼ì—ì„œ ë¡œë“œí•˜ëŠ” ë¡œì§
      // ì—¬ê¸°ì„œëŠ” ë”ë¯¸ êµ¬í˜„
      _conversionHistory = [];
    } catch (e) {
      debugPrint('ë³€í™˜ ê¸°ë¡ ë¡œë“œ ì‹¤íŒ¨: $e');
    }
  }
  
  /// ë³€í™˜ ê¸°ë¡ ì €ì¥
  Future<void> _saveConversionHistory() async {
    try {
      // SharedPreferencesë‚˜ íŒŒì¼ì— ì €ì¥í•˜ëŠ” ë¡œì§
      // ì—¬ê¸°ì„œëŠ” ë”ë¯¸ êµ¬í˜„
    } catch (e) {
      debugPrint('ë³€í™˜ ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨: $e');
    }
  }
  
  /// ë³€í™˜ ê¸°ë¡ ì‚­ì œ
  void clearConversionHistory() {
    _conversionHistory.clear();
    _saveConversionHistory();
    notifyListeners();
  }
  
  /// íŠ¹ì • ë³€í™˜ ê¸°ë¡ ì‚­ì œ
  void removeConversionHistory(String id) {
    _conversionHistory.removeWhere((item) => item.id == id);
    _saveConversionHistory();
    notifyListeners();
  }
  
  // ========================================
  // ìœ í‹¸ë¦¬í‹° ë©”ì„œë“œ
  // ========================================
  
  /// íŒŒì¼ í¬ê¸° í¬ë§·íŒ…
  String formatFileSize(int bytes) {
    if (bytes < 1024) return '$bytes B';
    if (bytes < 1024 * 1024) return '${(bytes / 1024).toStringAsFixed(1)} KB';
    if (bytes < 1024 * 1024 * 1024) return '${(bytes / (1024 * 1024)).toStringAsFixed(1)} MB';
    return '${(bytes / (1024 * 1024 * 1024)).toStringAsFixed(1)} GB';
  }
  
  /// íŒŒì¼ í˜•ì‹ ì§€ì› ì—¬ë¶€ í™•ì¸
  bool isFileFormatSupported(String filePath) {
    final extension = path.extension(filePath).toLowerCase().substring(1);
    return supportedInputFormats.contains(extension);
  }
  
  /// ì˜ˆìƒ ë³€í™˜ ì‹œê°„ ê³„ì‚° (ì´ˆ)
  int estimateConversionTime(String filePath) {
    final file = File(filePath);
    if (!file.existsSync()) return 0;
    
    final sizeInMB = file.lengthSync() / (1024 * 1024);
    final extension = path.extension(filePath).toLowerCase();
    
    // íŒŒì¼ í˜•ì‹ê³¼ í¬ê¸°ì— ë”°ë¥¸ ëŒ€ëµì ì¸ ë³€í™˜ ì‹œê°„
    switch (extension) {
      case '.pdf':
        return (sizeInMB * 2).round(); // PDF: 2ì´ˆ/MB
      case '.doc':
      case '.docx':
        return (sizeInMB * 5).round(); // Word: 5ì´ˆ/MB
      case '.ppt':
      case '.pptx':
        return (sizeInMB * 8).round(); // PowerPoint: 8ì´ˆ/MB
      case '.txt':
        return (sizeInMB * 1).round(); // Text: 1ì´ˆ/MB
      default:
        return (sizeInMB * 3).round(); // ê¸°íƒ€: 3ì´ˆ/MB
    }
  }
}

/// ë³€í™˜ ê¸°ë¡ í•­ëª© ë°ì´í„° í´ë˜ìŠ¤
class ConversionHistoryItem {
  final String id;
  final String sourceFile;
  final List<String> outputFiles;
  final String sourceFormat;
  final String targetFormat;
  final DateTime timestamp;
  final bool success;
  final int? pageCount;
  final String? errorMessage;

  ConversionHistoryItem({
    required this.id,
    required this.sourceFile,
    required this.outputFiles,
    required this.sourceFormat,
    required this.targetFormat,
    required this.timestamp,
    required this.success,
    this.pageCount,
    this.errorMessage,
  });

  Map<String, dynamic> toJson() => {
    'id': id,
    'sourceFile': sourceFile,
    'outputFiles': outputFiles,
    'sourceFormat': sourceFormat,
    'targetFormat': targetFormat,
    'timestamp': timestamp.toIso8601String(),
    'success': success,
    'pageCount': pageCount,
    'errorMessage': errorMessage,
  };

  factory ConversionHistoryItem.fromJson(Map<String, dynamic> json) => ConversionHistoryItem(
    id: json['id'],
    sourceFile: json['sourceFile'],
    outputFiles: List<String>.from(json['outputFiles']),
    sourceFormat: json['sourceFormat'],
    targetFormat: json['targetFormat'],
    timestamp: DateTime.parse(json['timestamp']),
    success: json['success'],
    pageCount: json['pageCount'],
    errorMessage: json['errorMessage'],
  );
}
```

================================================================================

ë¦¬íŠ¼(litten) í¬ë¡œìŠ¤í”Œë«í¼ ë…¸íŠ¸ ì•±ì˜ **Flutter í”„ë¡ íŠ¸ì—”ë“œ ì„¤ê³„**ê°€ ì™„ì „íˆ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. 

- **ê¸°ì¡´ ê¸°ëŠ¥**: ìŒì„±/í…ìŠ¤íŠ¸/í•„ê¸° í†µí•© ë…¸íŠ¸ ì‹œìŠ¤í…œ
- **ì¶”ê°€ëœ ê¸°ëŠ¥**: ê´‘ê³  ì‹œìŠ¤í…œ, 3ë‹¨ê³„ ì‚¬ìš©ëŸ‰ ì œí•œ ì‹œìŠ¤í…œ, í…Œë§ˆ ì‹œìŠ¤í…œ, êµ­ì œí™”, ë™ê¸°í™” ë“±
- **3ë‹¨ê³„ êµ¬ë… ì‹œìŠ¤í…œ**:
  * ë¬´ë£Œ(Free): ë¦¬íŠ¼ ìµœëŒ€ 5ê°œ, ë“£ê¸° íŒŒì¼ 2ê°œ, ì“°ê¸° í…ìŠ¤íŠ¸ 1ê°œ, í•„ê¸° 1ê°œ ì œí•œ
  * ìŠ¤íƒ ë‹¤ë“œ(Standard): íŒŒì¼ ìˆ˜ ì œí•œ ì—†ìŒ, ê´‘ê³  ì œê±°
  * í”„ë¦¬ë¯¸ì—„(Premium): ë¡œê·¸ì¸ ë° íŒŒì¼ ì„œë²„ ë³´ê´€, ì›¹ì—ì„œ í¸ì§‘ ê°€ëŠ¥
- **ì„œë¹„ìŠ¤ ë ˆì´ì–´**: AudioService, TextEditorService, DrawingService, FileConversionService ì™„ì„±
- **ì‚¬ìš©ì ê²½í—˜**: ì™„ì „í•œ ì˜¨ë³´ë”©ë¶€í„° ê³ ê¸‰ í¸ì§‘ ë„êµ¬ê¹Œì§€
- **ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸**: 3ë‹¨ê³„ êµ¬ë… ëª¨ë¸ë¡œ ì‚¬ìš©ìë³„ ë§ì¶¤ ì„œë¹„ìŠ¤ ì œê³µ

ëª¨ë“  ìš”êµ¬ì‚¬í•­ì´ ì²´ê³„ì ìœ¼ë¡œ ë°˜ì˜ë˜ì–´ ì‹¤ì œ ê°œë°œ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€ì˜ ì™„ì„±ë„ ë†’ì€ ì„¤ê³„ì„œì…ë‹ˆë‹¤.